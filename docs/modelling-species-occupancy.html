<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 7 Modelling Species Occupancy | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</title>
  <meta name="description" content="Section 7 Modelling Species Occupancy | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 7 Modelling Species Occupancy | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="pratikunterwegs/eBirdOccupancy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 7 Modelling Species Occupancy | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  
  
  

<meta name="author" content="Vijay Ramesh" />
<meta name="author" content="Pratik R. Gupte" />
<meta name="author" content="Morgan W. Tingley" />
<meta name="author" content="VV Robin" />
<meta name="author" content="Ruth DeFries" />


<meta name="date" content="2020-12-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="adding-covariates-to-checklist-data.html"/>
<link rel="next" href="visualizing-occupancy-predictor-effects.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#attribution"><i class="fa fa-check"></i><b>1.1</b> Attribution</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-access"><i class="fa fa-check"></i><b>1.2</b> Data access</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.3</b> Data processing</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#main-text-figure-1"><i class="fa fa-check"></i><b>1.4</b> Main Text Figure 1</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html"><i class="fa fa-check"></i><b>2</b> Preparing eBird Data</a><ul>
<li class="chapter" data-level="2.1" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#prepare-libraries-and-data-sources"><i class="fa fa-check"></i><b>2.1</b> Prepare libraries and data sources</a></li>
<li class="chapter" data-level="2.2" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#filter-data"><i class="fa fa-check"></i><b>2.2</b> Filter data</a></li>
<li class="chapter" data-level="2.3" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#process-filtered-data"><i class="fa fa-check"></i><b>2.3</b> Process filtered data</a></li>
<li class="chapter" data-level="2.4" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#spatial-filter"><i class="fa fa-check"></i><b>2.4</b> Spatial filter</a></li>
<li class="chapter" data-level="2.5" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#handle-presence-data"><i class="fa fa-check"></i><b>2.5</b> Handle presence data</a></li>
<li class="chapter" data-level="2.6" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#add-decimal-time"><i class="fa fa-check"></i><b>2.6</b> Add decimal time</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html"><i class="fa fa-check"></i><b>3</b> Preparing Environmental Predictors</a><ul>
<li class="chapter" data-level="3.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-libraries"><i class="fa fa-check"></i><b>3.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="3.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-spatial-extent"><i class="fa fa-check"></i><b>3.2</b> Prepare spatial extent</a></li>
<li class="chapter" data-level="3.3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-terrain-rasters"><i class="fa fa-check"></i><b>3.3</b> Prepare terrain rasters</a></li>
<li class="chapter" data-level="3.4" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-chelsa-rasters"><i class="fa fa-check"></i><b>3.4</b> Prepare CHELSA rasters</a></li>
<li class="chapter" data-level="3.5" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#resample-landcover-from-10m-to-1km"><i class="fa fa-check"></i><b>3.5</b> Resample landcover from 10m to 1km</a></li>
<li class="chapter" data-level="3.6" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#resample-other-rasters-to-1km"><i class="fa fa-check"></i><b>3.6</b> Resample other rasters to 1km</a><ul>
<li class="chapter" data-level="3.6.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#read-in-resampled-landcover"><i class="fa fa-check"></i><b>3.6.1</b> Read in resampled landcover</a></li>
<li class="chapter" data-level="3.6.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#reproject-environmental-data-using-landcover-as-a-template"><i class="fa fa-check"></i><b>3.6.2</b> Reproject environmental data using landcover as a template</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#temperature-and-rainfall-in-relation-to-elevation"><i class="fa fa-check"></i><b>3.7</b> Temperature and rainfall in relation to elevation</a><ul>
<li class="chapter" data-level="3.7.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-libraries-and-ci-function"><i class="fa fa-check"></i><b>3.7.1</b> Prepare libraries and CI function</a></li>
<li class="chapter" data-level="3.7.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#load-resampled-environmental-rasters"><i class="fa fa-check"></i><b>3.7.2</b> Load resampled environmental rasters</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#land-cover-type-in-relation-to-elevation"><i class="fa fa-check"></i><b>3.8</b> Land cover type in relation to elevation</a></li>
<li class="chapter" data-level="3.9" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#main-text-figure-2"><i class="fa fa-check"></i><b>3.9</b> Main Text Figure 2</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html"><i class="fa fa-check"></i><b>4</b> Preparing Observer Expertise Scores</a><ul>
<li class="chapter" data-level="4.1" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-libraries-1"><i class="fa fa-check"></i><b>4.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="4.2" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-data"><i class="fa fa-check"></i><b>4.2</b> Prepare data</a></li>
<li class="chapter" data-level="4.3" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#spatially-explicit-filter-on-checklists"><i class="fa fa-check"></i><b>4.3</b> Spatially explicit filter on checklists</a></li>
<li class="chapter" data-level="4.4" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-species-of-interest"><i class="fa fa-check"></i><b>4.4</b> Prepare species of interest</a></li>
<li class="chapter" data-level="4.5" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-checklists-for-observer-score"><i class="fa fa-check"></i><b>4.5</b> Prepare checklists for observer score</a></li>
<li class="chapter" data-level="4.6" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#get-landcover"><i class="fa fa-check"></i><b>4.6</b> Get landcover</a></li>
<li class="chapter" data-level="4.7" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#filter-checklist-data"><i class="fa fa-check"></i><b>4.7</b> Filter checklist data</a></li>
<li class="chapter" data-level="4.8" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#model-observer-expertise"><i class="fa fa-check"></i><b>4.8</b> Model observer expertise</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html"><i class="fa fa-check"></i><b>5</b> Examining Spatial Sampling Bias</a><ul>
<li class="chapter" data-level="5.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-libraries-2"><i class="fa fa-check"></i><b>5.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="5.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-data-for-processing"><i class="fa fa-check"></i><b>5.2</b> Prepare data for processing</a><ul>
<li class="chapter" data-level="5.2.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#python-functions-and-distance-calculations"><i class="fa fa-check"></i><b>5.2.1</b> Python functions and distance calculations</a></li>
<li class="chapter" data-level="5.2.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#spatially-explicit-filter-on-checklists-1"><i class="fa fa-check"></i><b>5.2.2</b> Spatially explicit filter on checklists</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#main-text-figure-3"><i class="fa fa-check"></i><b>5.3</b> Main Text Figure 3</a><ul>
<li class="chapter" data-level="5.3.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-histogram-of-distance-to-roads"><i class="fa fa-check"></i><b>5.3.1</b> Prepare histogram of distance to roads</a></li>
<li class="chapter" data-level="5.3.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#table-distance-to-roads"><i class="fa fa-check"></i><b>5.3.2</b> Table: Distance to roads</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#distance-to-nearest-neighbouring-site"><i class="fa fa-check"></i><b>5.4</b> Distance to nearest neighbouring site</a></li>
<li class="chapter" data-level="5.5" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#main-text-figure-3-1"><i class="fa fa-check"></i><b>5.5</b> Main Text Figure 3</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html"><i class="fa fa-check"></i><b>6</b> Adding Covariates to Checklist Data</a><ul>
<li class="chapter" data-level="6.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#prepare-libraries-and-data"><i class="fa fa-check"></i><b>6.1</b> Prepare libraries and data</a></li>
<li class="chapter" data-level="6.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-subsampling"><i class="fa fa-check"></i><b>6.2</b> Spatial subsampling</a></li>
<li class="chapter" data-level="6.3" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#temporal-subsampling"><i class="fa fa-check"></i><b>6.3</b> Temporal subsampling</a></li>
<li class="chapter" data-level="6.4" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#add-checklist-calibration-index"><i class="fa fa-check"></i><b>6.4</b> Add checklist calibration index</a></li>
<li class="chapter" data-level="6.5" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#add-climatic-and-landscape-covariates"><i class="fa fa-check"></i><b>6.5</b> Add climatic and landscape covariates</a></li>
<li class="chapter" data-level="6.6" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-buffers-around-selected-checklists"><i class="fa fa-check"></i><b>6.6</b> Spatial buffers around selected checklists</a></li>
<li class="chapter" data-level="6.7" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-buffer-wide-covariates"><i class="fa fa-check"></i><b>6.7</b> Spatial buffer-wide covariates</a><ul>
<li class="chapter" data-level="6.7.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#mean-climatic-covariates"><i class="fa fa-check"></i><b>6.7.1</b> Mean climatic covariates</a></li>
<li class="chapter" data-level="6.7.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#proportions-of-land-cover-type"><i class="fa fa-check"></i><b>6.7.2</b> Proportions of land cover type</a></li>
<li class="chapter" data-level="6.7.3" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#link-environmental-covariates-to-checklists"><i class="fa fa-check"></i><b>6.7.3</b> Link environmental covariates to checklists</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html"><i class="fa fa-check"></i><b>7</b> Modelling Species Occupancy</a><ul>
<li class="chapter" data-level="7.0.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#load-necessary-libraries"><i class="fa fa-check"></i><b>7.0.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="7.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#load-dataframe-and-scale-covariates"><i class="fa fa-check"></i><b>7.1</b> Load dataframe and scale covariates</a></li>
<li class="chapter" data-level="7.2" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#running-a-null-model"><i class="fa fa-check"></i><b>7.2</b> Running a null model</a></li>
<li class="chapter" data-level="7.3" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#identifying-covariates-necessary-to-model-the-detection-process"><i class="fa fa-check"></i><b>7.3</b> Identifying covariates necessary to model the detection process</a></li>
<li class="chapter" data-level="7.4" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#land-cover-and-climate"><i class="fa fa-check"></i><b>7.4</b> Land Cover and Climate</a></li>
<li class="chapter" data-level="7.5" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#goodness-of-fit-tests"><i class="fa fa-check"></i><b>7.5</b> Goodness-of-fit tests</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html"><i class="fa fa-check"></i><b>8</b> Visualizing Occupancy Predictor Effects</a><ul>
<li class="chapter" data-level="8.1" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-libraries-3"><i class="fa fa-check"></i><b>8.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="8.2" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#load-species-list"><i class="fa fa-check"></i><b>8.2</b> Load species list</a></li>
<li class="chapter" data-level="8.3" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#show-aic-weight-importance"><i class="fa fa-check"></i><b>8.3</b> Show AIC weight importance</a><ul>
<li class="chapter" data-level="8.3.1" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#read-in-aic-weight-data"><i class="fa fa-check"></i><b>8.3.1</b> Read in AIC weight data</a></li>
<li class="chapter" data-level="8.3.2" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-cumulative-aic-weight-data"><i class="fa fa-check"></i><b>8.3.2</b> Prepare cumulative AIC weight data</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-model-coefficient-data"><i class="fa fa-check"></i><b>8.4</b> Prepare model coefficient data</a></li>
<li class="chapter" data-level="8.5" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#get-predictor-effects"><i class="fa fa-check"></i><b>8.5</b> Get predictor effects</a></li>
<li class="chapter" data-level="8.6" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#main-text-figure-4"><i class="fa fa-check"></i><b>8.6</b> Main Text Figure 4</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>9</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Source code for <em>Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modelling-species-occupancy" class="section level1">
<h1><span class="header-section-number">Section 7</span> Modelling Species Occupancy</h1>
<div id="load-necessary-libraries" class="section level3">
<h3><span class="header-section-number">7.0.1</span> Load necessary libraries</h3>
<div class="sourceCode" id="cb56"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1"><span class="co"># Load libraries</span></a>
<a class="sourceLine" id="cb56-2" title="2"><span class="kw">library</span>(auk)</a>
<a class="sourceLine" id="cb56-3" title="3"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb56-4" title="4"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb56-5" title="5"><span class="kw">library</span>(unmarked)</a>
<a class="sourceLine" id="cb56-6" title="6"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb56-7" title="7"><span class="kw">library</span>(ebirdst)</a>
<a class="sourceLine" id="cb56-8" title="8"><span class="kw">library</span>(MuMIn)</a>
<a class="sourceLine" id="cb56-9" title="9"><span class="kw">library</span>(AICcmodavg)</a>
<a class="sourceLine" id="cb56-10" title="10"><span class="kw">library</span>(fields)</a>
<a class="sourceLine" id="cb56-11" title="11"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb56-12" title="12"><span class="kw">library</span>(doParallel)</a>
<a class="sourceLine" id="cb56-13" title="13"><span class="kw">library</span>(snow)</a>
<a class="sourceLine" id="cb56-14" title="14"><span class="kw">library</span>(openxlsx)</a>
<a class="sourceLine" id="cb56-15" title="15"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb56-16" title="16"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb56-17" title="17"><span class="kw">library</span>(ecodist)</a>
<a class="sourceLine" id="cb56-18" title="18"></a>
<a class="sourceLine" id="cb56-19" title="19"><span class="co"># Source necessary functions</span></a>
<a class="sourceLine" id="cb56-20" title="20"><span class="kw">source</span>(<span class="st">&quot;code/fun_screen_cor.R&quot;</span>)</a>
<a class="sourceLine" id="cb56-21" title="21"><span class="kw">source</span>(<span class="st">&quot;code/fun_model_estimate_collection.r&quot;</span>)</a></code></pre></div>
</div>
<div id="load-dataframe-and-scale-covariates" class="section level2">
<h2><span class="header-section-number">7.1</span> Load dataframe and scale covariates</h2>
<p>Here, we load the required dataframe that contains 10 random visits to a site and environmental covariates that were prepared at a spatial scale of 2.5 sq.km. We also scaled all covariates (mean around 0 and standard deviation of 1). Next, we ensured that only Traveling and Stationary checklists were considered. Even though stationary counts have no distance traveled, we defaulted all stationary accounts to an effective distance of 100m, which we consider the average maximum detection radius for most bird species in our area. Following this, we excluded predictors with a Pearson coefficient &gt; 0.5 which resulted in the removal of grasslands as it was highly negatively correlated with forests (r = -0.77).</p>
<p>Please note that species-specific plots of probabilities of occupancy as a function of environmental data can be accessed in Section 10 of the Supplementary Material.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1"><span class="co"># Load in the prepared dataframe that contains 10 random visits to each site</span></a>
<a class="sourceLine" id="cb57-2" title="2">dat &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/04_data-covars-2.5km.csv&quot;</span>, <span class="dt">header =</span> T)</a>
<a class="sourceLine" id="cb57-3" title="3"><span class="kw">setDF</span>(dat)</a>
<a class="sourceLine" id="cb57-4" title="4"><span class="kw">head</span>(dat)</a>
<a class="sourceLine" id="cb57-5" title="5"></a>
<a class="sourceLine" id="cb57-6" title="6"><span class="co"># Some more pre-processing to get the right data structures</span></a>
<a class="sourceLine" id="cb57-7" title="7"></a>
<a class="sourceLine" id="cb57-8" title="8"><span class="co"># Ensuring that only Traveling and Stationary checklists were considered</span></a>
<a class="sourceLine" id="cb57-9" title="9"><span class="kw">names</span>(dat)</a>
<a class="sourceLine" id="cb57-10" title="10">dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(protocol_type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Traveling&quot;</span>, <span class="st">&quot;Stationary&quot;</span>))</a>
<a class="sourceLine" id="cb57-11" title="11"></a>
<a class="sourceLine" id="cb57-12" title="12"><span class="co"># We take all stationary counts and give them a distance of 100 m (so 0.1 km),</span></a>
<a class="sourceLine" id="cb57-13" title="13"><span class="co"># as that&#39;s approximately the max normal hearing distance for people doing point counts.</span></a>
<a class="sourceLine" id="cb57-14" title="14">dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb57-15" title="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">effort_distance_km =</span> <span class="kw">replace</span>(</a>
<a class="sourceLine" id="cb57-16" title="16">    effort_distance_km,</a>
<a class="sourceLine" id="cb57-17" title="17">    <span class="kw">which</span>(effort_distance_km <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb57-18" title="18"><span class="st">      </span>protocol_type <span class="op">==</span><span class="st"> &quot;Stationary&quot;</span>),</a>
<a class="sourceLine" id="cb57-19" title="19">    <span class="fl">0.1</span></a>
<a class="sourceLine" id="cb57-20" title="20">  ))</a>
<a class="sourceLine" id="cb57-21" title="21"></a>
<a class="sourceLine" id="cb57-22" title="22"><span class="co"># Converting time observations started to numeric and adding it as a new column</span></a>
<a class="sourceLine" id="cb57-23" title="23"><span class="co"># This new column will be minute_observations_started</span></a>
<a class="sourceLine" id="cb57-24" title="24">dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb57-25" title="25"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">min_obs_started =</span> <span class="kw">strtoi</span>(<span class="kw">as.difftime</span>(time_observations_started,</a>
<a class="sourceLine" id="cb57-26" title="26">    <span class="dt">format =</span> <span class="st">&quot;%H:%M:%S&quot;</span>, <span class="dt">units =</span> <span class="st">&quot;mins&quot;</span></a>
<a class="sourceLine" id="cb57-27" title="27">  )))</a>
<a class="sourceLine" id="cb57-28" title="28"></a>
<a class="sourceLine" id="cb57-29" title="29"><span class="co"># Adding the julian date to the dataframe</span></a>
<a class="sourceLine" id="cb57-30" title="30">dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">julian_date =</span> lubridate<span class="op">::</span><span class="kw">yday</span>(dat<span class="op">$</span>observation_date))</a>
<a class="sourceLine" id="cb57-31" title="31"></a>
<a class="sourceLine" id="cb57-32" title="32"><span class="co"># Removing other unnecessary columns from the dataframe and creating a clean one without the rest</span></a>
<a class="sourceLine" id="cb57-33" title="33"><span class="kw">names</span>(dat)</a>
<a class="sourceLine" id="cb57-34" title="34">dat &lt;-<span class="st"> </span>dat[, <span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">16</span>, <span class="dv">18</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">24</span>, <span class="dv">25</span>, <span class="dv">26</span>, <span class="dv">28</span><span class="op">:</span><span class="dv">37</span>, <span class="dv">39</span><span class="op">:</span><span class="dv">45</span>, <span class="dv">47</span>)]</a>
<a class="sourceLine" id="cb57-35" title="35"></a>
<a class="sourceLine" id="cb57-36" title="36"><span class="co"># Rename column names:</span></a>
<a class="sourceLine" id="cb57-37" title="37"><span class="kw">names</span>(dat) &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb57-38" title="38">  <span class="st">&quot;duration_minutes&quot;</span>, <span class="st">&quot;effort_distance_km&quot;</span>, <span class="st">&quot;locality&quot;</span>,</a>
<a class="sourceLine" id="cb57-39" title="39">  <span class="st">&quot;locality_type&quot;</span>, <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;observer_id&quot;</span>,</a>
<a class="sourceLine" id="cb57-40" title="40">  <span class="st">&quot;observation_date&quot;</span>, <span class="st">&quot;scientific_name&quot;</span>, <span class="st">&quot;observation_count&quot;</span>,</a>
<a class="sourceLine" id="cb57-41" title="41">  <span class="st">&quot;protocol_type&quot;</span>, <span class="st">&quot;number_observers&quot;</span>, <span class="st">&quot;pres_abs&quot;</span>, <span class="st">&quot;tot_effort&quot;</span>,</a>
<a class="sourceLine" id="cb57-42" title="42">  <span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>, <span class="st">&quot;expertise&quot;</span>, <span class="st">&quot;bio_1.y&quot;</span>, <span class="st">&quot;bio_12.y&quot;</span>,</a>
<a class="sourceLine" id="cb57-43" title="43">  <span class="st">&quot;lc_02.y&quot;</span>, <span class="st">&quot;lc_06.y&quot;</span>, <span class="st">&quot;lc_01.y&quot;</span>, <span class="st">&quot;lc_07.y&quot;</span>, <span class="st">&quot;lc_04.y&quot;</span>,</a>
<a class="sourceLine" id="cb57-44" title="44">  <span class="st">&quot;lc_05.y&quot;</span>, <span class="st">&quot;min_obs_started&quot;</span>, <span class="st">&quot;julian_date&quot;</span></a>
<a class="sourceLine" id="cb57-45" title="45">)</a>
<a class="sourceLine" id="cb57-46" title="46"></a>
<a class="sourceLine" id="cb57-47" title="47">dat<span class="fl">.1</span> &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb57-48" title="48"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb57-49" title="49">    <span class="dt">year =</span> <span class="kw">year</span>(observation_date),</a>
<a class="sourceLine" id="cb57-50" title="50">    <span class="dt">pres_abs =</span> <span class="kw">as.integer</span>(pres_abs)</a>
<a class="sourceLine" id="cb57-51" title="51">  ) <span class="co"># occupancy modeling requires an integer response</span></a>
<a class="sourceLine" id="cb57-52" title="52"></a>
<a class="sourceLine" id="cb57-53" title="53"><span class="co"># Dividing Annual Mean Temperature by 10 to arrive at accurate values of temperature</span></a>
<a class="sourceLine" id="cb57-54" title="54">dat<span class="fl">.1</span><span class="op">$</span>bio_<span class="fl">1.</span>y &lt;-<span class="st"> </span>dat<span class="fl">.1</span><span class="op">$</span>bio_<span class="fl">1.</span>y <span class="op">/</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb57-55" title="55"></a>
<a class="sourceLine" id="cb57-56" title="56"><span class="co"># Scaling detection and occupancy covariates</span></a>
<a class="sourceLine" id="cb57-57" title="57">dat.scaled &lt;-<span class="st"> </span>dat<span class="fl">.1</span></a>
<a class="sourceLine" id="cb57-58" title="58">dat.scaled[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">11</span>, <span class="dv">16</span><span class="op">:</span><span class="dv">25</span>)] &lt;-<span class="st"> </span><span class="kw">scale</span>(dat.scaled[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">11</span>, <span class="dv">16</span><span class="op">:</span><span class="dv">25</span>)]) <span class="co"># Scaling and standardizing detection and site-level covariates</span></a>
<a class="sourceLine" id="cb57-59" title="59"><span class="kw">fwrite</span>(dat.scaled, <span class="dt">file =</span> <span class="st">&quot;data/05_scaled-covars-2.5km.csv&quot;</span>)</a>
<a class="sourceLine" id="cb57-60" title="60"></a>
<a class="sourceLine" id="cb57-61" title="61"><span class="co"># Reload the scaled covariate data</span></a>
<a class="sourceLine" id="cb57-62" title="62">dat.scaled &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/05_scaled-covars-2.5km.csv&quot;</span>, <span class="dt">header =</span> T)</a>
<a class="sourceLine" id="cb57-63" title="63"><span class="kw">setDF</span>(dat.scaled)</a>
<a class="sourceLine" id="cb57-64" title="64"><span class="kw">head</span>(dat.scaled)</a>
<a class="sourceLine" id="cb57-65" title="65"></a>
<a class="sourceLine" id="cb57-66" title="66"><span class="co"># Ensure observation_date column is in the right format</span></a>
<a class="sourceLine" id="cb57-67" title="67">dat.scaled<span class="op">$</span>observation_date &lt;-<span class="st"> </span><span class="kw">format</span>(</a>
<a class="sourceLine" id="cb57-68" title="68">  <span class="kw">as.Date</span>(</a>
<a class="sourceLine" id="cb57-69" title="69">    dat.scaled<span class="op">$</span>observation_date,</a>
<a class="sourceLine" id="cb57-70" title="70">    <span class="st">&quot;%m/%d/%Y&quot;</span></a>
<a class="sourceLine" id="cb57-71" title="71">  ),</a>
<a class="sourceLine" id="cb57-72" title="72">  <span class="st">&quot;%Y-%m-%d&quot;</span></a>
<a class="sourceLine" id="cb57-73" title="73">)</a>
<a class="sourceLine" id="cb57-74" title="74"></a>
<a class="sourceLine" id="cb57-75" title="75"><span class="co"># Testing for correlations before running further analyses</span></a>
<a class="sourceLine" id="cb57-76" title="76"><span class="co"># Most are uncorrelated since we decided to keep only 2 climatic and 6 land cover predictors</span></a>
<a class="sourceLine" id="cb57-77" title="77"><span class="kw">source</span>(<span class="st">&quot;code/screen_cor.R&quot;</span>)</a>
<a class="sourceLine" id="cb57-78" title="78"><span class="kw">names</span>(dat.scaled)</a>
<a class="sourceLine" id="cb57-79" title="79"><span class="kw">screen.cor</span>(dat.scaled[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">11</span>, <span class="dv">16</span><span class="op">:</span><span class="dv">25</span>)], <span class="dt">threshold =</span> <span class="fl">0.5</span>)</a></code></pre></div>
</div>
<div id="running-a-null-model" class="section level2">
<h2><span class="header-section-number">7.2</span> Running a null model</h2>
<div class="sourceCode" id="cb58"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1"><span class="co"># All null models are stored in lists below</span></a>
<a class="sourceLine" id="cb58-2" title="2">all_null &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb58-3" title="3"></a>
<a class="sourceLine" id="cb58-4" title="4"><span class="co"># Add a progress bar for the loop</span></a>
<a class="sourceLine" id="cb58-5" title="5">pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(</a>
<a class="sourceLine" id="cb58-6" title="6">  <span class="dt">min =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb58-7" title="7">  <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)),</a>
<a class="sourceLine" id="cb58-8" title="8">  <span class="dt">style =</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb58-9" title="9">) <span class="co"># text based bar</span></a>
<a class="sourceLine" id="cb58-10" title="10"></a>
<a class="sourceLine" id="cb58-11" title="11"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</a>
<a class="sourceLine" id="cb58-12" title="12">  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb58-13" title="13"><span class="st">  </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i])</a>
<a class="sourceLine" id="cb58-14" title="14"></a>
<a class="sourceLine" id="cb58-15" title="15">  <span class="co"># Preparing data for the unmarked model</span></a>
<a class="sourceLine" id="cb58-16" title="16">  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</a>
<a class="sourceLine" id="cb58-17" title="17">    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb58-18" title="18">    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb58-19" title="19">    <span class="dt">n_days =</span> <span class="dv">2600</span>, <span class="co"># 7 years is considered a period of closure</span></a>
<a class="sourceLine" id="cb58-20" title="20">    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</a>
<a class="sourceLine" id="cb58-21" title="21">    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</a>
<a class="sourceLine" id="cb58-22" title="22">  )</a>
<a class="sourceLine" id="cb58-23" title="23"></a>
<a class="sourceLine" id="cb58-24" title="24">  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb58-25" title="25">    <span class="st">&quot;min_obs_started&quot;</span>,</a>
<a class="sourceLine" id="cb58-26" title="26">    <span class="st">&quot;duration_minutes&quot;</span>,</a>
<a class="sourceLine" id="cb58-27" title="27">    <span class="st">&quot;effort_distance_km&quot;</span>,</a>
<a class="sourceLine" id="cb58-28" title="28">    <span class="st">&quot;number_observers&quot;</span>,</a>
<a class="sourceLine" id="cb58-29" title="29">    <span class="st">&quot;protocol_type&quot;</span>,</a>
<a class="sourceLine" id="cb58-30" title="30">    <span class="st">&quot;expertise&quot;</span>,</a>
<a class="sourceLine" id="cb58-31" title="31">    <span class="st">&quot;julian_date&quot;</span></a>
<a class="sourceLine" id="cb58-32" title="32">  )</a>
<a class="sourceLine" id="cb58-33" title="33"></a>
<a class="sourceLine" id="cb58-34" title="34">  <span class="co"># format for unmarked</span></a>
<a class="sourceLine" id="cb58-35" title="35">  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</a>
<a class="sourceLine" id="cb58-36" title="36">    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</a>
<a class="sourceLine" id="cb58-37" title="37">    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</a>
<a class="sourceLine" id="cb58-38" title="38">    <span class="dt">site_covs =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01.y&quot;</span>, <span class="st">&quot;lc_02.y&quot;</span>, <span class="st">&quot;lc_04.y&quot;</span>, </a>
<a class="sourceLine" id="cb58-39" title="39">    <span class="st">&quot;lc_05.y&quot;</span>, <span class="st">&quot;lc_06.y&quot;</span>, <span class="st">&quot;lc_07.y&quot;</span>, <span class="st">&quot;bio_1.y&quot;</span>, <span class="st">&quot;bio_12.y&quot;</span>),</a>
<a class="sourceLine" id="cb58-40" title="40">    <span class="dt">obs_covs =</span> obs_covs</a>
<a class="sourceLine" id="cb58-41" title="41">  )</a>
<a class="sourceLine" id="cb58-42" title="42"></a>
<a class="sourceLine" id="cb58-43" title="43">  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></a>
<a class="sourceLine" id="cb58-44" title="44">  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</a>
<a class="sourceLine" id="cb58-45" title="45"></a>
<a class="sourceLine" id="cb58-46" title="46">  <span class="co"># Set up the model</span></a>
<a class="sourceLine" id="cb58-47" title="47">  all_null[[i]] &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> occ_um)</a>
<a class="sourceLine" id="cb58-48" title="48">  <span class="kw">names</span>(all_null)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb58-49" title="49">  <span class="kw">setTxtProgressBar</span>(pb, i)</a>
<a class="sourceLine" id="cb58-50" title="50">}</a>
<a class="sourceLine" id="cb58-51" title="51"><span class="kw">close</span>(pb)</a>
<a class="sourceLine" id="cb58-52" title="52"></a>
<a class="sourceLine" id="cb58-53" title="53"><span class="co"># Store all the  model outputs for each species</span></a>
<a class="sourceLine" id="cb58-54" title="54"><span class="kw">capture.output</span>(all_null, <span class="dt">file =</span> <span class="st">&quot;data</span><span class="ch">\r</span><span class="st">esults</span><span class="ch">\n</span><span class="st">ull_models.csv&quot;</span>)</a></code></pre></div>
</div>
<div id="identifying-covariates-necessary-to-model-the-detection-process" class="section level2">
<h2><span class="header-section-number">7.3</span> Identifying covariates necessary to model the detection process</h2>
<p>Here, we use the <code>unmarked</code> package in R <span class="citation">(Fiske and Chandler <a href="#ref-fiske2011">2011</a>)</span> to identify detection level covariates that are important for each species. We use AIC criteria to select top models <span class="citation">(Burnham, Anderson, and Huyvaert <a href="#ref-burnham2011">2011</a>)</span>.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1"></a>
<a class="sourceLine" id="cb59-2" title="2"><span class="co"># All models are stored in lists below</span></a>
<a class="sourceLine" id="cb59-3" title="3">det_dred &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb59-4" title="4"></a>
<a class="sourceLine" id="cb59-5" title="5"><span class="co"># Subsetting those models whose deltaAIC&lt;2 (Burnham et al., 2011)</span></a>
<a class="sourceLine" id="cb59-6" title="6">top_det &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb59-7" title="7"></a>
<a class="sourceLine" id="cb59-8" title="8"><span class="co"># Getting model averaged coefficients and relative importance scores</span></a>
<a class="sourceLine" id="cb59-9" title="9">det_avg &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb59-10" title="10">det_imp &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb59-11" title="11"></a>
<a class="sourceLine" id="cb59-12" title="12"><span class="co"># Getting model estimates</span></a>
<a class="sourceLine" id="cb59-13" title="13">det_modelEst &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb59-14" title="14"></a>
<a class="sourceLine" id="cb59-15" title="15"><span class="co"># Add a progress bar for the loop</span></a>
<a class="sourceLine" id="cb59-16" title="16">pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(<span class="dt">min =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb59-17" title="17">  <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)), <span class="dt">style =</span> <span class="dv">3</span>) <span class="co"># text based bar</span></a>
<a class="sourceLine" id="cb59-18" title="18"></a>
<a class="sourceLine" id="cb59-19" title="19"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</a>
<a class="sourceLine" id="cb59-20" title="20">  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb59-21" title="21"><span class="st">    </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i])</a>
<a class="sourceLine" id="cb59-22" title="22"></a>
<a class="sourceLine" id="cb59-23" title="23">  <span class="co"># Preparing data for the unmarked model</span></a>
<a class="sourceLine" id="cb59-24" title="24">  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</a>
<a class="sourceLine" id="cb59-25" title="25">    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb59-26" title="26">    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb59-27" title="27">    <span class="dt">n_days =</span> <span class="dv">2600</span>, <span class="co"># 6 years is considered a period of closure</span></a>
<a class="sourceLine" id="cb59-28" title="28">    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</a>
<a class="sourceLine" id="cb59-29" title="29">    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</a>
<a class="sourceLine" id="cb59-30" title="30">  )</a>
<a class="sourceLine" id="cb59-31" title="31"></a>
<a class="sourceLine" id="cb59-32" title="32">  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb59-33" title="33">    <span class="st">&quot;min_obs_started&quot;</span>,</a>
<a class="sourceLine" id="cb59-34" title="34">    <span class="st">&quot;duration_minutes&quot;</span>,</a>
<a class="sourceLine" id="cb59-35" title="35">    <span class="st">&quot;effort_distance_km&quot;</span>,</a>
<a class="sourceLine" id="cb59-36" title="36">    <span class="st">&quot;number_observers&quot;</span>,</a>
<a class="sourceLine" id="cb59-37" title="37">    <span class="st">&quot;protocol_type&quot;</span>,</a>
<a class="sourceLine" id="cb59-38" title="38">    <span class="st">&quot;expertise&quot;</span>,</a>
<a class="sourceLine" id="cb59-39" title="39">    <span class="st">&quot;julian_date&quot;</span></a>
<a class="sourceLine" id="cb59-40" title="40">  )</a>
<a class="sourceLine" id="cb59-41" title="41"></a>
<a class="sourceLine" id="cb59-42" title="42">  <span class="co"># format for unmarked</span></a>
<a class="sourceLine" id="cb59-43" title="43">  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</a>
<a class="sourceLine" id="cb59-44" title="44">    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</a>
<a class="sourceLine" id="cb59-45" title="45">    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</a>
<a class="sourceLine" id="cb59-46" title="46">    <span class="dt">site_covs =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01.y&quot;</span>, <span class="st">&quot;lc_02.y&quot;</span>, <span class="st">&quot;lc_04.y&quot;</span>, </a>
<a class="sourceLine" id="cb59-47" title="47">      <span class="st">&quot;lc_05.y&quot;</span>, <span class="st">&quot;lc_06.y&quot;</span>, <span class="st">&quot;lc_07.y&quot;</span>, <span class="st">&quot;bio_1.y&quot;</span>, <span class="st">&quot;bio_12.y&quot;</span>), </a>
<a class="sourceLine" id="cb59-48" title="48">      <span class="dt">obs_covs =</span> obs_covs</a>
<a class="sourceLine" id="cb59-49" title="49">  )</a>
<a class="sourceLine" id="cb59-50" title="50"></a>
<a class="sourceLine" id="cb59-51" title="51">  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></a>
<a class="sourceLine" id="cb59-52" title="52">  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</a>
<a class="sourceLine" id="cb59-53" title="53"></a>
<a class="sourceLine" id="cb59-54" title="54">  <span class="co"># Fit a global model with all detection level covariates</span></a>
<a class="sourceLine" id="cb59-55" title="55">  global_mod &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>min_obs_started <span class="op">+</span></a>
<a class="sourceLine" id="cb59-56" title="56"><span class="st">    </span>julian_date <span class="op">+</span></a>
<a class="sourceLine" id="cb59-57" title="57"><span class="st">    </span>duration_minutes <span class="op">+</span></a>
<a class="sourceLine" id="cb59-58" title="58"><span class="st">    </span>effort_distance_km <span class="op">+</span></a>
<a class="sourceLine" id="cb59-59" title="59"><span class="st">    </span>number_observers <span class="op">+</span></a>
<a class="sourceLine" id="cb59-60" title="60"><span class="st">    </span>protocol_type <span class="op">+</span></a>
<a class="sourceLine" id="cb59-61" title="61"><span class="st">    </span>expertise <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> occ_um)</a>
<a class="sourceLine" id="cb59-62" title="62"></a>
<a class="sourceLine" id="cb59-63" title="63">  <span class="co"># Set up the cluster</span></a>
<a class="sourceLine" id="cb59-64" title="64">  clusterType &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">find.package</span>(<span class="st">&quot;snow&quot;</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>))) <span class="st">&quot;SOCK&quot;</span> <span class="cf">else</span> <span class="st">&quot;PSOCK&quot;</span></a>
<a class="sourceLine" id="cb59-65" title="65">  clust &lt;-<span class="st"> </span><span class="kw">try</span>(<span class="kw">makeCluster</span>(<span class="kw">getOption</span>(<span class="st">&quot;cl.cores&quot;</span>, <span class="dv">6</span>), <span class="dt">type =</span> clusterType))</a>
<a class="sourceLine" id="cb59-66" title="66"></a>
<a class="sourceLine" id="cb59-67" title="67">  <span class="kw">clusterEvalQ</span>(clust, <span class="kw">library</span>(unmarked))</a>
<a class="sourceLine" id="cb59-68" title="68">  <span class="kw">clusterExport</span>(clust, <span class="st">&quot;occ_um&quot;</span>)</a>
<a class="sourceLine" id="cb59-69" title="69"></a>
<a class="sourceLine" id="cb59-70" title="70">  det_dred[[i]] &lt;-<span class="st"> </span><span class="kw">pdredge</span>(global_mod, clust)</a>
<a class="sourceLine" id="cb59-71" title="71">  <span class="kw">names</span>(det_dred)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb59-72" title="72"></a>
<a class="sourceLine" id="cb59-73" title="73">  <span class="co"># Get the top models, which we&#39;ll define as those with deltaAICc &lt; 2</span></a>
<a class="sourceLine" id="cb59-74" title="74">  top_det[[i]] &lt;-<span class="st"> </span><span class="kw">get.models</span>(det_dred[[i]], <span class="dt">subset =</span> delta <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">cluster =</span> clust)</a>
<a class="sourceLine" id="cb59-75" title="75">  <span class="kw">names</span>(top_det)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb59-76" title="76"></a>
<a class="sourceLine" id="cb59-77" title="77">  <span class="co"># Obtaining model averaged coefficients</span></a>
<a class="sourceLine" id="cb59-78" title="78">  <span class="cf">if</span> (<span class="kw">length</span>(top_det[[i]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb59-79" title="79">    a &lt;-<span class="st"> </span><span class="kw">model.avg</span>(top_det[[i]], <span class="dt">fit =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb59-80" title="80">    det_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(a<span class="op">$</span>coefficients)</a>
<a class="sourceLine" id="cb59-81" title="81">    <span class="kw">names</span>(det_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb59-82" title="82"></a>
<a class="sourceLine" id="cb59-83" title="83">    det_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb59-84" title="84">      <span class="dt">Coefficient =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb59-85" title="85">      <span class="dt">SE =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb59-86" title="86">      <span class="dt">lowerCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb59-87" title="87">      <span class="dt">upperCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb59-88" title="88">      <span class="dt">z_value =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">3</span>],</a>
<a class="sourceLine" id="cb59-89" title="89">      <span class="dt">Pr_z =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">4</span>]</a>
<a class="sourceLine" id="cb59-90" title="90">    )</a>
<a class="sourceLine" id="cb59-91" title="91"></a>
<a class="sourceLine" id="cb59-92" title="92">    <span class="kw">names</span>(det_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb59-93" title="93"></a>
<a class="sourceLine" id="cb59-94" title="94">    det_imp[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(MuMIn<span class="op">::</span><span class="kw">importance</span>(a))</a>
<a class="sourceLine" id="cb59-95" title="95">    <span class="kw">names</span>(det_imp)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb59-96" title="96">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb59-97" title="97">    det_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(unmarked<span class="op">::</span><span class="kw">coef</span>(top_det[[i]][[<span class="dv">1</span>]]))</a>
<a class="sourceLine" id="cb59-98" title="98">    <span class="kw">names</span>(det_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb59-99" title="99"></a>
<a class="sourceLine" id="cb59-100" title="100">    lowDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lowerCI =</span> <span class="kw">confint</span>(top_det[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb59-101" title="101">    upDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">upperCI =</span> <span class="kw">confint</span>(top_det[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">2</span>])</a>
<a class="sourceLine" id="cb59-102" title="102">    zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">summary</span>(top_det[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">3</span>])</a>
<a class="sourceLine" id="cb59-103" title="103">    Pr_zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">summary</span>(top_det[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">4</span>])</a>
<a class="sourceLine" id="cb59-104" title="104"></a>
<a class="sourceLine" id="cb59-105" title="105">    Coefficient &lt;-<span class="st"> </span><span class="kw">coefTable</span>(top_det[[i]][[<span class="dv">1</span>]])[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb59-106" title="106">    SE &lt;-<span class="st"> </span><span class="kw">coefTable</span>(top_det[[i]][[<span class="dv">1</span>]])[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb59-107" title="107"></a>
<a class="sourceLine" id="cb59-108" title="108">    det_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb59-109" title="109">      <span class="dt">Coefficient =</span> Coefficient[<span class="dv">2</span><span class="op">:</span><span class="dv">9</span>],</a>
<a class="sourceLine" id="cb59-110" title="110">      <span class="dt">SE =</span> SE[<span class="dv">2</span><span class="op">:</span><span class="dv">9</span>],</a>
<a class="sourceLine" id="cb59-111" title="111">      <span class="dt">lowerCI =</span> lowDet,</a>
<a class="sourceLine" id="cb59-112" title="112">      <span class="dt">upperCI =</span> upDet,</a>
<a class="sourceLine" id="cb59-113" title="113">      <span class="dt">z_value =</span> zDet,</a>
<a class="sourceLine" id="cb59-114" title="114">      <span class="dt">Pr_z =</span> Pr_zDet</a>
<a class="sourceLine" id="cb59-115" title="115">    )</a>
<a class="sourceLine" id="cb59-116" title="116"></a>
<a class="sourceLine" id="cb59-117" title="117">    <span class="kw">names</span>(det_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb59-118" title="118">  }</a>
<a class="sourceLine" id="cb59-119" title="119">  <span class="kw">setTxtProgressBar</span>(pb, i)</a>
<a class="sourceLine" id="cb59-120" title="120">  <span class="kw">stopCluster</span>(clust)</a>
<a class="sourceLine" id="cb59-121" title="121">}</a>
<a class="sourceLine" id="cb59-122" title="122"><span class="kw">close</span>(pb)</a>
<a class="sourceLine" id="cb59-123" title="123"></a>
<a class="sourceLine" id="cb59-124" title="124"><span class="co">## Storing output from the above models in excel sheets</span></a>
<a class="sourceLine" id="cb59-125" title="125"></a>
<a class="sourceLine" id="cb59-126" title="126"><span class="co"># 1. Store all the model outputs for each species (variable: det_dred() - see above)</span></a>
<a class="sourceLine" id="cb59-127" title="127"><span class="kw">write.xlsx</span>(det_dred, <span class="dt">file =</span> <span class="st">&quot;data</span><span class="ch">\r</span><span class="st">esults\det-dred.xlsx&quot;</span>)</a>
<a class="sourceLine" id="cb59-128" title="128"></a>
<a class="sourceLine" id="cb59-129" title="129"><span class="co"># 2. Store all the model averaged outputs for each species and the relative importance score</span></a>
<a class="sourceLine" id="cb59-130" title="130"><span class="kw">write.xlsx</span>(det_avg, <span class="dt">file =</span> <span class="st">&quot;data</span><span class="ch">\r</span><span class="st">esults\det-avg.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</a>
<a class="sourceLine" id="cb59-131" title="131"><span class="kw">write.xlsx</span>(det_imp, <span class="dt">file =</span> <span class="st">&quot;data</span><span class="ch">\r</span><span class="st">esults\det-imp.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</a>
<a class="sourceLine" id="cb59-132" title="132"></a>
<a class="sourceLine" id="cb59-133" title="133"><span class="kw">write.xlsx</span>(det_modelEst, <span class="dt">file =</span> <span class="st">&quot;data</span><span class="ch">\r</span><span class="st">esults\det-modelEst.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</a></code></pre></div>
</div>
<div id="land-cover-and-climate" class="section level2">
<h2><span class="header-section-number">7.4</span> Land Cover and Climate</h2>
<p>Occupancy models estimate the probability of occurrence of a given species while controlling for the probability of detection and allow us to model the factors affecting occurrence and detection independently <span class="citation">(Johnston et al. <a href="#ref-johnston2018">2018</a>; MacKenzie et al. <a href="#ref-mackenzie2002">2002</a>)</span>. The flexible eBird observation process contributes to the largest source of variation in the likelihood of detecting a particular species <span class="citation">(Johnston et al. <a href="#ref-johnston2019a">2019</a>)</span>; hence, we included seven covariates that influence the probability of detection for each checklist: ordinal day of year, duration of observation, distance travelled, protocol type, time observations started, number of observers and the checklist calibration index (CCI).</p>
<p>Using a multi-model information-theoretic approach, we tested how strongly our occurrence data fit our candidate set of environmental covariates <span class="citation">(Burnham and Anderson <a href="#ref-burnham2002a">2002</a>)</span>. We fitted single-species occupancy models for each species, to simultaneously estimate a probability of detection (p) and a probability of occupancy (<span class="math inline">\(\psi\)</span>) <span class="citation">(Fiske and Chandler <a href="#ref-fiske2011">2011</a>; MacKenzie et al. <a href="#ref-mackenzie2002">2002</a>)</span>. For each species, we fit 256 models, each with a unique combination of the eight (climate and land cover) occupancy covariates and all seven detection covariates (Appendix S5).</p>
<p>Across the 256 models tested for each species, the model with highest support was determined using AICc scores. However, across the majority of the species, no single model had overwhelming support. Hence, for each species, we examined those models which had <span class="math inline">\(\Delta\)</span>AICc &lt; 2, as these top models were considered to explain a large proportion of the association between the species-specific probability of occupancy and environmental drivers <span class="citation">(Burnham, Anderson, and Huyvaert <a href="#ref-burnham2011">2011</a>; Elsen et al. <a href="#ref-elsen2017">2017</a>)</span>. Using these restricted model sets for each species; we created a model-averaged coefficient estimate for each predictor and assessed its direction and significance <span class="citation">(Bartoń <a href="#ref-MuMIn">2020</a>)</span>. We considered a predictor to be significantly associated with occupancy if the range of the 95% confidence interval around the model-averaged coefficient did not contain zero. Next, we obtained a measure of relative importance of climatic and landscape predictors by calculating cumulative variable importance scores. These scores were calculated by obtaining the sum of model weights (AIC weights) across all models (including the top models) for each predictor across all species.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1"><span class="co"># All models are stored in lists below</span></a>
<a class="sourceLine" id="cb60-2" title="2">lc_clim &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb60-3" title="3"></a>
<a class="sourceLine" id="cb60-4" title="4"><span class="co"># Subsetting those models whose deltaAIC&lt;2 (Burnham et al., 2011)</span></a>
<a class="sourceLine" id="cb60-5" title="5">top_lc_clim &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb60-6" title="6"></a>
<a class="sourceLine" id="cb60-7" title="7"><span class="co"># Getting model averaged coefficients and relative importance scores</span></a>
<a class="sourceLine" id="cb60-8" title="8">lc_clim_avg &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb60-9" title="9">lc_clim_imp &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb60-10" title="10"></a>
<a class="sourceLine" id="cb60-11" title="11"><span class="co"># Storing Model estimates</span></a>
<a class="sourceLine" id="cb60-12" title="12">lc_clim_modelEst &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb60-13" title="13"></a>
<a class="sourceLine" id="cb60-14" title="14"><span class="co"># Add a progress bar for the loop</span></a>
<a class="sourceLine" id="cb60-15" title="15">pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(<span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)), <span class="dt">style =</span> <span class="dv">3</span>) <span class="co"># text based bar</span></a>
<a class="sourceLine" id="cb60-16" title="16"></a>
<a class="sourceLine" id="cb60-17" title="17"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</a>
<a class="sourceLine" id="cb60-18" title="18">  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb60-19" title="19"></a>
<a class="sourceLine" id="cb60-20" title="20">  <span class="co"># Preparing data for the unmarked model</span></a>
<a class="sourceLine" id="cb60-21" title="21">  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</a>
<a class="sourceLine" id="cb60-22" title="22">    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb60-23" title="23">    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb60-24" title="24">    <span class="dt">n_days =</span> <span class="dv">2600</span>, <span class="co"># 6 years is considered a period of closure</span></a>
<a class="sourceLine" id="cb60-25" title="25">    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</a>
<a class="sourceLine" id="cb60-26" title="26">    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</a>
<a class="sourceLine" id="cb60-27" title="27">  )</a>
<a class="sourceLine" id="cb60-28" title="28"></a>
<a class="sourceLine" id="cb60-29" title="29">  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb60-30" title="30">    <span class="st">&quot;min_obs_started&quot;</span>,</a>
<a class="sourceLine" id="cb60-31" title="31">    <span class="st">&quot;duration_minutes&quot;</span>,</a>
<a class="sourceLine" id="cb60-32" title="32">    <span class="st">&quot;effort_distance_km&quot;</span>,</a>
<a class="sourceLine" id="cb60-33" title="33">    <span class="st">&quot;number_observers&quot;</span>,</a>
<a class="sourceLine" id="cb60-34" title="34">    <span class="st">&quot;protocol_type&quot;</span>,</a>
<a class="sourceLine" id="cb60-35" title="35">    <span class="st">&quot;expertise&quot;</span>,</a>
<a class="sourceLine" id="cb60-36" title="36">    <span class="st">&quot;julian_date&quot;</span></a>
<a class="sourceLine" id="cb60-37" title="37">  )</a>
<a class="sourceLine" id="cb60-38" title="38"></a>
<a class="sourceLine" id="cb60-39" title="39">  <span class="co"># format for unmarked</span></a>
<a class="sourceLine" id="cb60-40" title="40">  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</a>
<a class="sourceLine" id="cb60-41" title="41">    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</a>
<a class="sourceLine" id="cb60-42" title="42">    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</a>
<a class="sourceLine" id="cb60-43" title="43">    <span class="dt">site_covs =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01.y&quot;</span>, <span class="st">&quot;lc_02.y&quot;</span>, <span class="st">&quot;lc_04.y&quot;</span>, <span class="st">&quot;lc_05.y&quot;</span>, </a>
<a class="sourceLine" id="cb60-44" title="44">      <span class="st">&quot;lc_06.y&quot;</span>, <span class="st">&quot;lc_07.y&quot;</span>, <span class="st">&quot;bio_1.y&quot;</span>, <span class="st">&quot;bio_12.y&quot;</span>),</a>
<a class="sourceLine" id="cb60-45" title="45">    <span class="dt">obs_covs =</span> obs_covs</a>
<a class="sourceLine" id="cb60-46" title="46">  )</a>
<a class="sourceLine" id="cb60-47" title="47"></a>
<a class="sourceLine" id="cb60-48" title="48">  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></a>
<a class="sourceLine" id="cb60-49" title="49">  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</a>
<a class="sourceLine" id="cb60-50" title="50"></a>
<a class="sourceLine" id="cb60-51" title="51">  model_lc_clim &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>min_obs_started <span class="op">+</span></a>
<a class="sourceLine" id="cb60-52" title="52"><span class="st">    </span>julian_date <span class="op">+</span></a>
<a class="sourceLine" id="cb60-53" title="53"><span class="st">    </span>duration_minutes <span class="op">+</span></a>
<a class="sourceLine" id="cb60-54" title="54"><span class="st">    </span>effort_distance_km <span class="op">+</span></a>
<a class="sourceLine" id="cb60-55" title="55"><span class="st">    </span>number_observers <span class="op">+</span></a>
<a class="sourceLine" id="cb60-56" title="56"><span class="st">    </span>protocol_type <span class="op">+</span></a>
<a class="sourceLine" id="cb60-57" title="57"><span class="st">    </span>expertise <span class="op">~</span><span class="st"> </span>lc_<span class="fl">01.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">02.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">04.</span>y <span class="op">+</span></a>
<a class="sourceLine" id="cb60-58" title="58"><span class="st">    </span>lc_<span class="fl">05.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">06.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">07.</span>y <span class="op">+</span><span class="st"> </span>bio_<span class="fl">1.</span>y <span class="op">+</span><span class="st"> </span>bio_<span class="fl">12.</span>y, <span class="dt">data =</span> occ_um)</a>
<a class="sourceLine" id="cb60-59" title="59"></a>
<a class="sourceLine" id="cb60-60" title="60">  <span class="co"># Set up the cluster</span></a>
<a class="sourceLine" id="cb60-61" title="61">  clusterType &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">find.package</span>(<span class="st">&quot;snow&quot;</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>))) <span class="st">&quot;SOCK&quot;</span> <span class="cf">else</span> <span class="st">&quot;PSOCK&quot;</span></a>
<a class="sourceLine" id="cb60-62" title="62">  clust &lt;-<span class="st"> </span><span class="kw">try</span>(<span class="kw">makeCluster</span>(<span class="kw">getOption</span>(<span class="st">&quot;cl.cores&quot;</span>, <span class="dv">6</span>), <span class="dt">type =</span> clusterType))</a>
<a class="sourceLine" id="cb60-63" title="63"></a>
<a class="sourceLine" id="cb60-64" title="64">  <span class="kw">clusterEvalQ</span>(clust, <span class="kw">library</span>(unmarked))</a>
<a class="sourceLine" id="cb60-65" title="65">  <span class="kw">clusterExport</span>(clust, <span class="st">&quot;occ_um&quot;</span>)</a>
<a class="sourceLine" id="cb60-66" title="66"></a>
<a class="sourceLine" id="cb60-67" title="67">  <span class="co"># Detection terms are fixed</span></a>
<a class="sourceLine" id="cb60-68" title="68">  det_terms &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb60-69" title="69">    <span class="st">&quot;p(duration_minutes)&quot;</span>, <span class="st">&quot;p(effort_distance_km)&quot;</span>, <span class="st">&quot;p(expertise)&quot;</span>, </a>
<a class="sourceLine" id="cb60-70" title="70">    <span class="st">&quot;p(julian_date)&quot;</span>, <span class="st">&quot;p(min_obs_started)&quot;</span>,</a>
<a class="sourceLine" id="cb60-71" title="71">    <span class="st">&quot;p(number_observers)&quot;</span>, <span class="st">&quot;p(protocol_type)&quot;</span></a>
<a class="sourceLine" id="cb60-72" title="72">  )</a>
<a class="sourceLine" id="cb60-73" title="73"></a>
<a class="sourceLine" id="cb60-74" title="74">  lc_clim[[i]] &lt;-<span class="st"> </span><span class="kw">pdredge</span>(model_lc_clim, clust, <span class="dt">fixed =</span> det_terms)</a>
<a class="sourceLine" id="cb60-75" title="75">  <span class="kw">names</span>(lc_clim)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb60-76" title="76"></a>
<a class="sourceLine" id="cb60-77" title="77">  <span class="co"># Identiying top subset of models based on deltaAIC scores being less than 2 (Burnham et al., 2011)</span></a>
<a class="sourceLine" id="cb60-78" title="78">  top_lc_clim[[i]] &lt;-<span class="st"> </span><span class="kw">get.models</span>(lc_clim[[i]], <span class="dt">subset =</span> delta <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">cluster =</span> clust)</a>
<a class="sourceLine" id="cb60-79" title="79"></a>
<a class="sourceLine" id="cb60-80" title="80">  <span class="kw">names</span>(top_lc_clim)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb60-81" title="81"></a>
<a class="sourceLine" id="cb60-82" title="82">  <span class="co"># Obtaining model averaged coefficients for both candidate model subsets</span></a>
<a class="sourceLine" id="cb60-83" title="83">  <span class="cf">if</span> (<span class="kw">length</span>(top_lc_clim[[i]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb60-84" title="84">    a &lt;-<span class="st"> </span><span class="kw">model.avg</span>(top_lc_clim[[i]], <span class="dt">fit =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb60-85" title="85">    lc_clim_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(a<span class="op">$</span>coefficients)</a>
<a class="sourceLine" id="cb60-86" title="86">    <span class="kw">names</span>(lc_clim_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb60-87" title="87"></a>
<a class="sourceLine" id="cb60-88" title="88">    lc_clim_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb60-89" title="89">      <span class="dt">Coefficient =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb60-90" title="90">      <span class="dt">SE =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb60-91" title="91">      <span class="dt">lowerCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb60-92" title="92">      <span class="dt">upperCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb60-93" title="93">      <span class="dt">z_value =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">3</span>],</a>
<a class="sourceLine" id="cb60-94" title="94">      <span class="dt">Pr_z =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">4</span>]</a>
<a class="sourceLine" id="cb60-95" title="95">    )</a>
<a class="sourceLine" id="cb60-96" title="96"></a>
<a class="sourceLine" id="cb60-97" title="97">    <span class="kw">names</span>(lc_clim_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb60-98" title="98"></a>
<a class="sourceLine" id="cb60-99" title="99">    lc_clim_imp[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(MuMIn<span class="op">::</span><span class="kw">importance</span>(a))</a>
<a class="sourceLine" id="cb60-100" title="100">    <span class="kw">names</span>(lc_clim_imp)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb60-101" title="101">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb60-102" title="102">    lc_clim_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(unmarked<span class="op">::</span><span class="kw">coef</span>(top_lc_clim[[i]][[<span class="dv">1</span>]]))</a>
<a class="sourceLine" id="cb60-103" title="103">    <span class="kw">names</span>(lc_clim_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb60-104" title="104"></a>
<a class="sourceLine" id="cb60-105" title="105">    lowSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lowerCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;state&quot;</span>)[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb60-106" title="106">    lowDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lowerCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb60-107" title="107">    upSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">upperCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;state&quot;</span>)[, <span class="dv">2</span>])</a>
<a class="sourceLine" id="cb60-108" title="108">    upDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">upperCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">2</span>])</a>
<a class="sourceLine" id="cb60-109" title="109">    zSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">z_value =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>state[, <span class="dv">3</span>])</a>
<a class="sourceLine" id="cb60-110" title="110">    zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">z_value =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">3</span>])</a>
<a class="sourceLine" id="cb60-111" title="111">    Pr_zSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Pr_z =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>state[, <span class="dv">4</span>])</a>
<a class="sourceLine" id="cb60-112" title="112">    Pr_zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Pr_z =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">4</span>])</a>
<a class="sourceLine" id="cb60-113" title="113"></a>
<a class="sourceLine" id="cb60-114" title="114">    lc_clim_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb60-115" title="115">      <span class="dt">Coefficient =</span> <span class="kw">coefTable</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])[, <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb60-116" title="116">      <span class="dt">SE =</span> <span class="kw">coefTable</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])[, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb60-117" title="117">      <span class="dt">lowerCI =</span> <span class="kw">rbind</span>(lowSt, lowDet),</a>
<a class="sourceLine" id="cb60-118" title="118">      <span class="dt">upperCI =</span> <span class="kw">rbind</span>(upSt, upDet),</a>
<a class="sourceLine" id="cb60-119" title="119">      <span class="dt">z_value =</span> <span class="kw">rbind</span>(zSt, zDet),</a>
<a class="sourceLine" id="cb60-120" title="120">      <span class="dt">Pr_z =</span> <span class="kw">rbind</span>(Pr_zSt, Pr_zDet)</a>
<a class="sourceLine" id="cb60-121" title="121">    )</a>
<a class="sourceLine" id="cb60-122" title="122"></a>
<a class="sourceLine" id="cb60-123" title="123">    <span class="kw">names</span>(lc_clim_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb60-124" title="124">  }</a>
<a class="sourceLine" id="cb60-125" title="125">  <span class="kw">setTxtProgressBar</span>(pb, i)</a>
<a class="sourceLine" id="cb60-126" title="126">  <span class="kw">stopCluster</span>(clust)</a>
<a class="sourceLine" id="cb60-127" title="127">}</a>
<a class="sourceLine" id="cb60-128" title="128"><span class="kw">close</span>(pb)</a>
<a class="sourceLine" id="cb60-129" title="129"></a>
<a class="sourceLine" id="cb60-130" title="130"><span class="co"># 1. Store all the model outputs for each species (for both landcover and climate)</span></a>
<a class="sourceLine" id="cb60-131" title="131"><span class="kw">write.xlsx</span>(lc_clim, <span class="dt">file =</span> <span class="st">&quot;data</span><span class="ch">\r</span><span class="st">esults\lc-clim.xlsx&quot;</span>)</a>
<a class="sourceLine" id="cb60-132" title="132"></a>
<a class="sourceLine" id="cb60-133" title="133"><span class="co"># 2. Store all the model averaged outputs for each species and relative importance scores</span></a>
<a class="sourceLine" id="cb60-134" title="134"><span class="kw">write.xlsx</span>(lc_clim_avg, <span class="dt">file =</span> <span class="st">&quot;data</span><span class="ch">\r</span><span class="st">esults\lc-clim-avg.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</a>
<a class="sourceLine" id="cb60-135" title="135"><span class="kw">write.xlsx</span>(lc_clim_imp, <span class="dt">file =</span> <span class="st">&quot;data</span><span class="ch">\r</span><span class="st">esults\lc-clim-imp.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</a>
<a class="sourceLine" id="cb60-136" title="136"></a>
<a class="sourceLine" id="cb60-137" title="137"><span class="co"># 3. Store all model estimates</span></a>
<a class="sourceLine" id="cb60-138" title="138"><span class="kw">write.xlsx</span>(lc_clim_modelEst, <span class="dt">file =</span> <span class="st">&quot;data</span><span class="ch">\r</span><span class="st">esults\lc-clim-modelEst.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</a></code></pre></div>
</div>
<div id="goodness-of-fit-tests" class="section level2">
<h2><span class="header-section-number">7.5</span> Goodness-of-fit tests</h2>
<p>Adequate model fit was assessed using a chi-square goodness-of-fit test using 5000 parametric bootstrap simulations on a global model that included all occupancy and detection covariates (MacKenzie &amp; Bailey, 2004).</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1">goodness_of_fit &lt;-<span class="st"> </span><span class="kw">data.frame</span>()</a>
<a class="sourceLine" id="cb61-2" title="2"></a>
<a class="sourceLine" id="cb61-3" title="3"><span class="co"># Add a progress bar for the loop</span></a>
<a class="sourceLine" id="cb61-4" title="4">pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(<span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)), <span class="dt">style =</span> <span class="dv">3</span>) <span class="co"># text based bar</span></a>
<a class="sourceLine" id="cb61-5" title="5"></a>
<a class="sourceLine" id="cb61-6" title="6"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</a>
<a class="sourceLine" id="cb61-7" title="7">  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i])</a>
<a class="sourceLine" id="cb61-8" title="8"></a>
<a class="sourceLine" id="cb61-9" title="9">  <span class="co"># Preparing data for the unmarked model</span></a>
<a class="sourceLine" id="cb61-10" title="10">  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</a>
<a class="sourceLine" id="cb61-11" title="11">    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb61-12" title="12">    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb61-13" title="13">    <span class="dt">n_days =</span> <span class="dv">2600</span>, <span class="co"># 6 years is considered a period of closure</span></a>
<a class="sourceLine" id="cb61-14" title="14">    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</a>
<a class="sourceLine" id="cb61-15" title="15">    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</a>
<a class="sourceLine" id="cb61-16" title="16">  )</a>
<a class="sourceLine" id="cb61-17" title="17"></a>
<a class="sourceLine" id="cb61-18" title="18">  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb61-19" title="19">    <span class="st">&quot;min_obs_started&quot;</span>,</a>
<a class="sourceLine" id="cb61-20" title="20">    <span class="st">&quot;duration_minutes&quot;</span>,</a>
<a class="sourceLine" id="cb61-21" title="21">    <span class="st">&quot;effort_distance_km&quot;</span>,</a>
<a class="sourceLine" id="cb61-22" title="22">    <span class="st">&quot;number_observers&quot;</span>,</a>
<a class="sourceLine" id="cb61-23" title="23">    <span class="st">&quot;protocol_type&quot;</span>,</a>
<a class="sourceLine" id="cb61-24" title="24">    <span class="st">&quot;expertise&quot;</span>,</a>
<a class="sourceLine" id="cb61-25" title="25">    <span class="st">&quot;julian_date&quot;</span></a>
<a class="sourceLine" id="cb61-26" title="26">  )</a>
<a class="sourceLine" id="cb61-27" title="27"></a>
<a class="sourceLine" id="cb61-28" title="28">  <span class="co"># format for unmarked</span></a>
<a class="sourceLine" id="cb61-29" title="29">  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</a>
<a class="sourceLine" id="cb61-30" title="30">    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</a>
<a class="sourceLine" id="cb61-31" title="31">    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</a>
<a class="sourceLine" id="cb61-32" title="32">    <span class="dt">site_covs =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01.y&quot;</span>, <span class="st">&quot;lc_02.y&quot;</span>, <span class="st">&quot;lc_04.y&quot;</span>, <span class="st">&quot;lc_05.y&quot;</span>, <span class="st">&quot;lc_06.y&quot;</span>, <span class="st">&quot;lc_07.y&quot;</span>, <span class="st">&quot;bio_1.y&quot;</span>, <span class="st">&quot;bio_12.y&quot;</span>),</a>
<a class="sourceLine" id="cb61-33" title="33">    <span class="dt">obs_covs =</span> obs_covs</a>
<a class="sourceLine" id="cb61-34" title="34">  )</a>
<a class="sourceLine" id="cb61-35" title="35"></a>
<a class="sourceLine" id="cb61-36" title="36">  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></a>
<a class="sourceLine" id="cb61-37" title="37">  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</a>
<a class="sourceLine" id="cb61-38" title="38"></a>
<a class="sourceLine" id="cb61-39" title="39">  model_lc_clim &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>min_obs_started <span class="op">+</span></a>
<a class="sourceLine" id="cb61-40" title="40"><span class="st">    </span>julian_date <span class="op">+</span></a>
<a class="sourceLine" id="cb61-41" title="41"><span class="st">    </span>duration_minutes <span class="op">+</span></a>
<a class="sourceLine" id="cb61-42" title="42"><span class="st">    </span>effort_distance_km <span class="op">+</span></a>
<a class="sourceLine" id="cb61-43" title="43"><span class="st">    </span>number_observers <span class="op">+</span></a>
<a class="sourceLine" id="cb61-44" title="44"><span class="st">    </span>protocol_type <span class="op">+</span></a>
<a class="sourceLine" id="cb61-45" title="45"><span class="st">    </span>expertise <span class="op">~</span><span class="st"> </span>lc_<span class="fl">01.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">02.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">04.</span>y <span class="op">+</span></a>
<a class="sourceLine" id="cb61-46" title="46"><span class="st">    </span>lc_<span class="fl">05.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">06.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">07.</span>y <span class="op">+</span><span class="st"> </span>bio_<span class="fl">1.</span>y <span class="op">+</span><span class="st"> </span>bio_<span class="fl">12.</span>y, <span class="dt">data =</span> occ_um)</a>
<a class="sourceLine" id="cb61-47" title="47"></a>
<a class="sourceLine" id="cb61-48" title="48">  occ_gof &lt;-<span class="st"> </span><span class="kw">mb.gof.test</span>(model_lc_clim, <span class="dt">nsim =</span> <span class="dv">5000</span>, <span class="dt">plot.hist =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb61-49" title="49"></a>
<a class="sourceLine" id="cb61-50" title="50">  p.value &lt;-<span class="st"> </span>occ_gof<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb61-51" title="51">  c.hat &lt;-<span class="st"> </span>occ_gof<span class="op">$</span>c.hat.est</a>
<a class="sourceLine" id="cb61-52" title="52">  scientific_name &lt;-<span class="st"> </span><span class="kw">unique</span>(data<span class="op">$</span>scientific_name)</a>
<a class="sourceLine" id="cb61-53" title="53"></a>
<a class="sourceLine" id="cb61-54" title="54">  a &lt;-<span class="st"> </span><span class="kw">data.frame</span>(scientific_name, p.value, c.hat)</a>
<a class="sourceLine" id="cb61-55" title="55"></a>
<a class="sourceLine" id="cb61-56" title="56">  goodness_of_fit &lt;-<span class="st"> </span><span class="kw">rbind</span>(a, goodness_of_fit)</a>
<a class="sourceLine" id="cb61-57" title="57"></a>
<a class="sourceLine" id="cb61-58" title="58">  <span class="kw">setTxtProgressBar</span>(pb, i)</a>
<a class="sourceLine" id="cb61-59" title="59">}</a>
<a class="sourceLine" id="cb61-60" title="60"><span class="kw">close</span>(pb)</a>
<a class="sourceLine" id="cb61-61" title="61"></a>
<a class="sourceLine" id="cb61-62" title="62"><span class="kw">write.csv</span>(goodness_of_fit, <span class="st">&quot;data</span><span class="ch">\r</span><span class="st">esults</span><span class="ch">\05</span><span class="st">_goodness-of-fit-2.5km.csv&quot;</span>)</a></code></pre></div>

</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-MuMIn">
<p>Bartoń, Kamil. 2020. <em>MuMIn: Multi-Model Inference</em>. Manual.</p>
</div>
<div id="ref-burnham2002a">
<p>Burnham, Kenneth P., and David R. Anderson. 2002. <em>Model Selection and Multimodel Inference: A Practical Information-Theoretic Approach</em>. Second. New York: Springer-Verlag. <a href="https://doi.org/10.1007/b97636">https://doi.org/10.1007/b97636</a>.</p>
</div>
<div id="ref-burnham2011">
<p>Burnham, Kenneth P., David R. Anderson, and Kathryn P. Huyvaert. 2011. “AIC Model Selection and Multimodel Inference in Behavioral Ecology: Some Background, Observations, and Comparisons.” <em>Behavioral Ecology and Sociobiology</em> 65 (1): 23–35. <a href="https://doi.org/10.1007/s00265-010-1029-6">https://doi.org/10.1007/s00265-010-1029-6</a>.</p>
</div>
<div id="ref-elsen2017">
<p>Elsen, Paul R., Morgan W. Tingley, Ramnarayan Kalyanaraman, Krishnamurthy Ramesh, and David S. Wilcove. 2017. “The Role of Competition, Ecotones, and Temperature in the Elevational Distribution of Himalayan Birds.” <em>Ecology</em> 98 (2): 337–48. <a href="https://doi.org/10.1002/ecy.1669">https://doi.org/10.1002/ecy.1669</a>.</p>
</div>
<div id="ref-fiske2011">
<p>Fiske, Ian, and Richard Chandler. 2011. “<em>Unmarked</em> : An <em>R</em> Package for Fitting Hierarchical Models of Wildlife Occurrence and Abundance.” <em>Journal of Statistical Software</em> 43 (10). <a href="https://doi.org/10.18637/jss.v043.i10">https://doi.org/10.18637/jss.v043.i10</a>.</p>
</div>
<div id="ref-johnston2019a">
<p>Johnston, A, Wm Hochachka, Me Strimas-Mackey, V Ruiz Gutierrez, Oj Robinson, Et Miller, T Auer, St Kelling, and D Fink. 2019. “Analytical Guidelines to Increase the Value of Citizen Science Data: Using eBird Data to Estimate Species Occurrence.” Preprint. Ecology. <a href="https://doi.org/10.1101/574392">https://doi.org/10.1101/574392</a>.</p>
</div>
<div id="ref-johnston2018">
<p>Johnston, Alison, Daniel Fink, Wesley M. Hochachka, and Steve Kelling. 2018. “Estimates of Observer Expertise Improve Species Distributions from Citizen Science Data.” Edited by Nick Isaac. <em>Methods in Ecology and Evolution</em> 9 (1): 88–97. <a href="https://doi.org/10.1111/2041-210X.12838">https://doi.org/10.1111/2041-210X.12838</a>.</p>
</div>
<div id="ref-mackenzie2002">
<p>MacKenzie, Darryl I., James D. Nichols, Gideon B. Lachman, Sam Droege, J. Andrew Royle, and Catherine A. Langtimm. 2002. “Estimating Site Occupancy Rates When Detection Probabilities Are Less Than One.” <em>Ecology</em> 83 (8): 2248–55. <a href="https://doi.org/10.1890/0012-9658(2002)083[2248:ESORWD]2.0.CO;2">https://doi.org/10.1890/0012-9658(2002)083[2248:ESORWD]2.0.CO;2</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="adding-covariates-to-checklist-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualizing-occupancy-predictor-effects.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pratikunterwegs/eBirdOccupancy/edit/master/05_occupancy-models.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ebird_occupancy_main_text.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
