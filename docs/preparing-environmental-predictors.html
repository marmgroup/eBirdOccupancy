<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 3 Preparing Environmental Predictors | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</title>
  <meta name="description" content="Section 3 Preparing Environmental Predictors | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 3 Preparing Environmental Predictors | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="pratikunterwegs/eBirdOccupancy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 3 Preparing Environmental Predictors | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  
  
  

<meta name="author" content="Vijay Ramesh" />
<meta name="author" content="Pratik R. Gupte" />
<meta name="author" content="Morgan W. Tingley" />
<meta name="author" content="VV Robin" />
<meta name="author" content="Ruth DeFries" />


<meta name="date" content="2021-06-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="preparing-ebird-data.html"/>
<link rel="next" href="preparing-observer-expertise-scores.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#attribution"><i class="fa fa-check"></i><b>1.1</b> Attribution</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-access"><i class="fa fa-check"></i><b>1.2</b> Data access</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.3</b> Data processing</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#main-text-figure-1"><i class="fa fa-check"></i><b>1.4</b> Main Text Figure 1</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html"><i class="fa fa-check"></i><b>2</b> Preparing eBird Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#prepare-libraries-and-data-sources"><i class="fa fa-check"></i><b>2.1</b> Prepare libraries and data sources</a></li>
<li class="chapter" data-level="2.2" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#filter-data"><i class="fa fa-check"></i><b>2.2</b> Filter data</a></li>
<li class="chapter" data-level="2.3" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#process-filtered-data"><i class="fa fa-check"></i><b>2.3</b> Process filtered data</a></li>
<li class="chapter" data-level="2.4" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#spatial-filter"><i class="fa fa-check"></i><b>2.4</b> Spatial filter</a></li>
<li class="chapter" data-level="2.5" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#handle-presence-data"><i class="fa fa-check"></i><b>2.5</b> Handle presence data</a></li>
<li class="chapter" data-level="2.6" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#add-decimal-time"><i class="fa fa-check"></i><b>2.6</b> Add decimal time</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html"><i class="fa fa-check"></i><b>3</b> Preparing Environmental Predictors</a>
<ul>
<li class="chapter" data-level="3.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-libraries"><i class="fa fa-check"></i><b>3.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="3.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-spatial-extent"><i class="fa fa-check"></i><b>3.2</b> Prepare spatial extent</a></li>
<li class="chapter" data-level="3.3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-terrain-rasters"><i class="fa fa-check"></i><b>3.3</b> Prepare terrain rasters</a></li>
<li class="chapter" data-level="3.4" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-4a-and-bioclim-15"><i class="fa fa-check"></i><b>3.4</b> Prepare Bioclim 4a and Bioclim 15</a></li>
<li class="chapter" data-level="3.5" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-chelsa-rasters"><i class="fa fa-check"></i><b>3.5</b> Prepare CHELSA rasters</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-4a-and-15"><i class="fa fa-check"></i><b>3.5.1</b> Prepare BIOCLIM 4a and 15</a></li>
<li class="chapter" data-level="3.5.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-4a"><i class="fa fa-check"></i><b>3.5.2</b> Prepare BIOCLIM 4a</a></li>
<li class="chapter" data-level="3.5.3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-15"><i class="fa fa-check"></i><b>3.5.3</b> Prepare Bioclim 15</a></li>
<li class="chapter" data-level="3.5.4" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#stack-terrain-and-climate"><i class="fa fa-check"></i><b>3.5.4</b> Stack terrain and climate</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#resample-landcover-from-10m-to-1km"><i class="fa fa-check"></i><b>3.6</b> Resample landcover from 10m to 1km</a></li>
<li class="chapter" data-level="3.7" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#resample-other-rasters-to-1km"><i class="fa fa-check"></i><b>3.7</b> Resample other rasters to 1km</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#read-in-resampled-landcover"><i class="fa fa-check"></i><b>3.7.1</b> Read in resampled landcover</a></li>
<li class="chapter" data-level="3.7.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#reproject-environmental-data-using-landcover-as-a-template"><i class="fa fa-check"></i><b>3.7.2</b> Reproject environmental data using landcover as a template</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#temperature-and-rainfall-in-relation-to-elevation"><i class="fa fa-check"></i><b>3.8</b> Temperature and rainfall in relation to elevation</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#load-resampled-environmental-rasters"><i class="fa fa-check"></i><b>3.8.1</b> Load resampled environmental rasters</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#land-cover-type-in-relation-to-elevation"><i class="fa fa-check"></i><b>3.9</b> Land cover type in relation to elevation</a></li>
<li class="chapter" data-level="3.10" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#main-text-figure-2"><i class="fa fa-check"></i><b>3.10</b> Main Text Figure 2</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html"><i class="fa fa-check"></i><b>4</b> Preparing Observer Expertise Scores</a>
<ul>
<li class="chapter" data-level="4.1" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-libraries-1"><i class="fa fa-check"></i><b>4.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="4.2" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-data"><i class="fa fa-check"></i><b>4.2</b> Prepare data</a></li>
<li class="chapter" data-level="4.3" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#spatially-explicit-filter-on-checklists"><i class="fa fa-check"></i><b>4.3</b> Spatially explicit filter on checklists</a></li>
<li class="chapter" data-level="4.4" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-species-of-interest"><i class="fa fa-check"></i><b>4.4</b> Prepare species of interest</a></li>
<li class="chapter" data-level="4.5" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-checklists-for-observer-score"><i class="fa fa-check"></i><b>4.5</b> Prepare checklists for observer score</a></li>
<li class="chapter" data-level="4.6" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#get-landcover"><i class="fa fa-check"></i><b>4.6</b> Get landcover</a></li>
<li class="chapter" data-level="4.7" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#filter-checklist-data"><i class="fa fa-check"></i><b>4.7</b> Filter checklist data</a></li>
<li class="chapter" data-level="4.8" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#model-observer-expertise"><i class="fa fa-check"></i><b>4.8</b> Model observer expertise</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="prepare-nearest-neighbour-and-road-metrics.html"><a href="prepare-nearest-neighbour-and-road-metrics.html"><i class="fa fa-check"></i><b>5</b> Prepare Nearest Neighbour and Road Metrics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="prepare-nearest-neighbour-and-road-metrics.html"><a href="prepare-nearest-neighbour-and-road-metrics.html#prepare-libraries-2"><i class="fa fa-check"></i><b>5.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="5.2" data-path="prepare-nearest-neighbour-and-road-metrics.html"><a href="prepare-nearest-neighbour-and-road-metrics.html#prepare-data-for-processing"><i class="fa fa-check"></i><b>5.2</b> Prepare data for processing</a></li>
<li class="chapter" data-level="5.3" data-path="prepare-nearest-neighbour-and-road-metrics.html"><a href="prepare-nearest-neighbour-and-road-metrics.html#read-in-data"><i class="fa fa-check"></i><b>5.3</b> Read in data</a></li>
<li class="chapter" data-level="5.4" data-path="prepare-nearest-neighbour-and-road-metrics.html"><a href="prepare-nearest-neighbour-and-road-metrics.html#define-functions-for-geometry-simplication-and-distances"><i class="fa fa-check"></i><b>5.4</b> Define functions for geometry simplication and distances</a></li>
<li class="chapter" data-level="5.5" data-path="prepare-nearest-neighbour-and-road-metrics.html"><a href="prepare-nearest-neighbour-and-road-metrics.html#get-distance-from-sites-to-road-and-each-other"><i class="fa fa-check"></i><b>5.5</b> Get distance from sites to road and each other</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html"><i class="fa fa-check"></i><b>6</b> Examining Spatial Sampling Bias</a>
<ul>
<li class="chapter" data-level="6.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-libraries-3"><i class="fa fa-check"></i><b>6.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="6.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#read-checklist-data"><i class="fa fa-check"></i><b>6.2</b> Read checklist data</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#spatially-explicit-filter-on-checklists-1"><i class="fa fa-check"></i><b>6.2.1</b> Spatially explicit filter on checklists</a></li>
<li class="chapter" data-level="6.2.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#get-background-land-for-plotting"><i class="fa fa-check"></i><b>6.2.2</b> Get background land for plotting</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-main-text-figure-3"><i class="fa fa-check"></i><b>6.3</b> Prepare Main Text Figure 3</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-histogram-of-distance-to-roads"><i class="fa fa-check"></i><b>6.3.1</b> Prepare histogram of distance to roads</a></li>
<li class="chapter" data-level="6.3.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#table-distance-to-roads"><i class="fa fa-check"></i><b>6.3.2</b> Table: Distance to roads</a></li>
<li class="chapter" data-level="6.3.3" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#distance-to-nearest-neighbouring-site"><i class="fa fa-check"></i><b>6.3.3</b> Distance to nearest neighbouring site</a></li>
<li class="chapter" data-level="6.3.4" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#spatial-distribution-of-distances-to-neighbours"><i class="fa fa-check"></i><b>6.3.4</b> Spatial distribution of distances to neighbours</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#main-text-figure-3"><i class="fa fa-check"></i><b>6.4</b> Main Text Figure 3</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html"><i class="fa fa-check"></i><b>7</b> Checking Temporal Sampling Frequency</a>
<ul>
<li class="chapter" data-level="7.1" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#load-libraries"><i class="fa fa-check"></i><b>7.1</b> Load libraries</a></li>
<li class="chapter" data-level="7.2" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#load-checklist-data"><i class="fa fa-check"></i><b>7.2</b> Load checklist data</a></li>
<li class="chapter" data-level="7.3" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#get-time-differences-per-grid-cell"><i class="fa fa-check"></i><b>7.3</b> Get time differences per grid cell</a></li>
<li class="chapter" data-level="7.4" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#time-since-previous-checklist"><i class="fa fa-check"></i><b>7.4</b> Time Since Previous Checklist</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#get-aux-data"><i class="fa fa-check"></i><b>7.4.1</b> Get aux data</a></li>
<li class="chapter" data-level="7.4.2" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#histogram-of-lags"><i class="fa fa-check"></i><b>7.4.2</b> Histogram of lags</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#checklists-per-month"><i class="fa fa-check"></i><b>7.5</b> Checklists per Month</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html"><i class="fa fa-check"></i><b>8</b> Adding Covariates to Checklist Data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#prepare-libraries-and-data"><i class="fa fa-check"></i><b>8.1</b> Prepare libraries and data</a></li>
<li class="chapter" data-level="8.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-subsampling"><i class="fa fa-check"></i><b>8.2</b> Spatial subsampling</a></li>
<li class="chapter" data-level="8.3" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#temporal-subsampling"><i class="fa fa-check"></i><b>8.3</b> Temporal subsampling</a></li>
<li class="chapter" data-level="8.4" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#add-checklist-calibration-index"><i class="fa fa-check"></i><b>8.4</b> Add checklist calibration index</a></li>
<li class="chapter" data-level="8.5" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#add-climatic-and-landscape-covariates"><i class="fa fa-check"></i><b>8.5</b> Add climatic and landscape covariates</a></li>
<li class="chapter" data-level="8.6" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-buffers-around-selected-checklists"><i class="fa fa-check"></i><b>8.6</b> Spatial buffers around selected checklists</a></li>
<li class="chapter" data-level="8.7" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-buffer-wide-covariates"><i class="fa fa-check"></i><b>8.7</b> Spatial buffer-wide covariates</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#mean-climatic-covariates"><i class="fa fa-check"></i><b>8.7.1</b> Mean climatic covariates</a></li>
<li class="chapter" data-level="8.7.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#proportions-of-land-cover-type"><i class="fa fa-check"></i><b>8.7.2</b> Proportions of land cover type</a></li>
<li class="chapter" data-level="8.7.3" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#link-environmental-covariates-to-checklists"><i class="fa fa-check"></i><b>8.7.3</b> Link environmental covariates to checklists</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html"><i class="fa fa-check"></i><b>9</b> Modelling Species Occupancy</a>
<ul>
<li class="chapter" data-level="9.0.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#load-necessary-libraries"><i class="fa fa-check"></i><b>9.0.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="9.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#load-dataframe-and-scale-covariates"><i class="fa fa-check"></i><b>9.1</b> Load dataframe and scale covariates</a></li>
<li class="chapter" data-level="9.2" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#running-a-null-model"><i class="fa fa-check"></i><b>9.2</b> Running a null model</a></li>
<li class="chapter" data-level="9.3" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#identifying-covariates-necessary-to-model-the-detection-process"><i class="fa fa-check"></i><b>9.3</b> Identifying covariates necessary to model the detection process</a></li>
<li class="chapter" data-level="9.4" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#land-cover-and-climate"><i class="fa fa-check"></i><b>9.4</b> Land Cover and Climate</a></li>
<li class="chapter" data-level="9.5" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#goodness-of-fit-tests"><i class="fa fa-check"></i><b>9.5</b> Goodness-of-fit tests</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html"><i class="fa fa-check"></i><b>10</b> Visualizing Occupancy Predictor Effects</a>
<ul>
<li class="chapter" data-level="10.1" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-libraries-4"><i class="fa fa-check"></i><b>10.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="10.2" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#load-species-list"><i class="fa fa-check"></i><b>10.2</b> Load species list</a></li>
<li class="chapter" data-level="10.3" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#show-aic-weight-importance"><i class="fa fa-check"></i><b>10.3</b> Show AIC weight importance</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#read-in-aic-weight-data"><i class="fa fa-check"></i><b>10.3.1</b> Read in AIC weight data</a></li>
<li class="chapter" data-level="10.3.2" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-cumulative-aic-weight-data"><i class="fa fa-check"></i><b>10.3.2</b> Prepare cumulative AIC weight data</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-model-coefficient-data"><i class="fa fa-check"></i><b>10.4</b> Prepare model coefficient data</a></li>
<li class="chapter" data-level="10.5" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#get-predictor-effects"><i class="fa fa-check"></i><b>10.5</b> Get predictor effects</a></li>
<li class="chapter" data-level="10.6" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#main-text-figure-4"><i class="fa fa-check"></i><b>10.6</b> Main Text Figure 4</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>11</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Source code for <em>Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="preparing-environmental-predictors" class="section level1">
<h1><span class="header-section-number">Section 3</span> Preparing Environmental Predictors</h1>
<p>In this script, we processed climatic and landscape predictors for occupancy modeling.</p>
<p>All climatic data was obtained from <a href="https://chelsa-climate.org/bioclim/" class="uri">https://chelsa-climate.org/bioclim/</a>
All landscape data was derived from a high resolution land cover map (Roy et al 2015). This map provides sufficient classes to achieve a high land cover resolution.</p>
<p>The goal here is to resample all rasters so that they have the same resolution of 1km cells. We also tested for spatial autocorrelation among climatic predictors, which can be found in Section 4 of the Supplementary Material.</p>
<div id="prepare-libraries" class="section level2">
<h2><span class="header-section-number">3.1</span> Prepare libraries</h2>
<p>We load some common libraries for raster processing and define a custom mode function.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="preparing-environmental-predictors.html#cb14-1"></a><span class="co"># load libs</span></span>
<span id="cb14-2"><a href="preparing-environmental-predictors.html#cb14-2"></a><span class="kw">library</span>(raster)</span>
<span id="cb14-3"><a href="preparing-environmental-predictors.html#cb14-3"></a><span class="kw">library</span>(stringi)</span>
<span id="cb14-4"><a href="preparing-environmental-predictors.html#cb14-4"></a><span class="kw">library</span>(glue)</span>
<span id="cb14-5"><a href="preparing-environmental-predictors.html#cb14-5"></a><span class="kw">library</span>(gdalUtils)</span>
<span id="cb14-6"><a href="preparing-environmental-predictors.html#cb14-6"></a><span class="kw">library</span>(purrr)</span>
<span id="cb14-7"><a href="preparing-environmental-predictors.html#cb14-7"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb14-8"><a href="preparing-environmental-predictors.html#cb14-8"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb14-9"><a href="preparing-environmental-predictors.html#cb14-9"></a><span class="kw">library</span>(tibble)</span>
<span id="cb14-10"><a href="preparing-environmental-predictors.html#cb14-10"></a></span>
<span id="cb14-11"><a href="preparing-environmental-predictors.html#cb14-11"></a><span class="co"># for plotting</span></span>
<span id="cb14-12"><a href="preparing-environmental-predictors.html#cb14-12"></a><span class="kw">library</span>(viridis)</span>
<span id="cb14-13"><a href="preparing-environmental-predictors.html#cb14-13"></a><span class="kw">library</span>(tmap)</span>
<span id="cb14-14"><a href="preparing-environmental-predictors.html#cb14-14"></a><span class="kw">library</span>(scales)</span>
<span id="cb14-15"><a href="preparing-environmental-predictors.html#cb14-15"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb14-16"><a href="preparing-environmental-predictors.html#cb14-16"></a><span class="kw">library</span>(patchwork)</span>
<span id="cb14-17"><a href="preparing-environmental-predictors.html#cb14-17"></a></span>
<span id="cb14-18"><a href="preparing-environmental-predictors.html#cb14-18"></a><span class="co"># prep mode function to aggregate</span></span>
<span id="cb14-19"><a href="preparing-environmental-predictors.html#cb14-19"></a>funcMode &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">na.rm =</span> T) {</span>
<span id="cb14-20"><a href="preparing-environmental-predictors.html#cb14-20"></a>  ux &lt;-<span class="st"> </span><span class="kw">unique</span>(x)</span>
<span id="cb14-21"><a href="preparing-environmental-predictors.html#cb14-21"></a>  ux[<span class="kw">which.max</span>(<span class="kw">tabulate</span>(<span class="kw">match</span>(x, ux)))]</span>
<span id="cb14-22"><a href="preparing-environmental-predictors.html#cb14-22"></a>}</span>
<span id="cb14-23"><a href="preparing-environmental-predictors.html#cb14-23"></a></span>
<span id="cb14-24"><a href="preparing-environmental-predictors.html#cb14-24"></a><span class="co"># a basic test</span></span>
<span id="cb14-25"><a href="preparing-environmental-predictors.html#cb14-25"></a>assertthat<span class="op">::</span><span class="kw">assert_that</span>(<span class="kw">funcMode</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>)) <span class="op">==</span><span class="st"> </span><span class="kw">as.character</span>(<span class="dv">2</span>),</span>
<span id="cb14-26"><a href="preparing-environmental-predictors.html#cb14-26"></a>  <span class="dt">msg =</span> <span class="st">&quot;problem in the mode function&quot;</span></span>
<span id="cb14-27"><a href="preparing-environmental-predictors.html#cb14-27"></a>) <span class="co"># works</span></span>
<span id="cb14-28"><a href="preparing-environmental-predictors.html#cb14-28"></a></span>
<span id="cb14-29"><a href="preparing-environmental-predictors.html#cb14-29"></a><span class="co"># get ci func</span></span>
<span id="cb14-30"><a href="preparing-environmental-predictors.html#cb14-30"></a>ci &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb14-31"><a href="preparing-environmental-predictors.html#cb14-31"></a>  <span class="kw">qnorm</span>(<span class="fl">0.975</span>) <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(x, <span class="dt">na.rm =</span> T) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">length</span>(x))</span>
<span id="cb14-32"><a href="preparing-environmental-predictors.html#cb14-32"></a>}</span></code></pre></div>
</div>
<div id="prepare-spatial-extent" class="section level2">
<h2><span class="header-section-number">3.2</span> Prepare spatial extent</h2>
<p>We prepare a 30km buffer around the boundary of the study area. This buffer will be used to mask the landscape rasters.The buffer procedure is done on data transformed to the UTM 43N CRS to avoid distortions.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="preparing-environmental-predictors.html#cb15-1"></a><span class="co"># load hills</span></span>
<span id="cb15-2"><a href="preparing-environmental-predictors.html#cb15-2"></a><span class="kw">library</span>(sf)</span>
<span id="cb15-3"><a href="preparing-environmental-predictors.html#cb15-3"></a>hills &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/spatial/hillsShapefile/Nil_Ana_Pal.shp&quot;</span>)</span>
<span id="cb15-4"><a href="preparing-environmental-predictors.html#cb15-4"></a>hills &lt;-<span class="st"> </span><span class="kw">st_transform</span>(hills, <span class="dv">32643</span>)</span>
<span id="cb15-5"><a href="preparing-environmental-predictors.html#cb15-5"></a>buffer &lt;-<span class="st"> </span><span class="kw">st_buffer</span>(hills, <span class="fl">3e4</span>) <span class="op">%&gt;%</span></span>
<span id="cb15-6"><a href="preparing-environmental-predictors.html#cb15-6"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">4326</span>)</span></code></pre></div>
</div>
<div id="prepare-terrain-rasters" class="section level2">
<h2><span class="header-section-number">3.3</span> Prepare terrain rasters</h2>
<p>We prepare the elevation data which is an SRTM raster layer, and derive the slope and aspect from it after cropping it to the extent of the study site buffer. Please download the latest version of the SRTM raster layer from <a href="https://www.worldclim.org/data/worldclim21.html" class="uri">https://www.worldclim.org/data/worldclim21.html</a></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="preparing-environmental-predictors.html#cb16-1"></a><span class="co"># load elevation and crop to hills size, then mask by hills</span></span>
<span id="cb16-2"><a href="preparing-environmental-predictors.html#cb16-2"></a>alt &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;data/spatial/Elevation/alt&quot;</span>) <span class="co"># this layer is not added to github as a result of its large size and can be downloaded from the above link</span></span>
<span id="cb16-3"><a href="preparing-environmental-predictors.html#cb16-3"></a>alt.hills &lt;-<span class="st"> </span><span class="kw">crop</span>(alt, <span class="kw">as</span>(buffer, <span class="st">&quot;Spatial&quot;</span>))</span>
<span id="cb16-4"><a href="preparing-environmental-predictors.html#cb16-4"></a><span class="kw">rm</span>(alt)</span>
<span id="cb16-5"><a href="preparing-environmental-predictors.html#cb16-5"></a><span class="kw">gc</span>()</span>
<span id="cb16-6"><a href="preparing-environmental-predictors.html#cb16-6"></a></span>
<span id="cb16-7"><a href="preparing-environmental-predictors.html#cb16-7"></a><span class="co"># get slope and aspect</span></span>
<span id="cb16-8"><a href="preparing-environmental-predictors.html#cb16-8"></a>slopeData &lt;-<span class="st"> </span><span class="kw">terrain</span>(<span class="dt">x =</span> alt.hills, <span class="dt">opt =</span> <span class="kw">c</span>(<span class="st">&quot;slope&quot;</span>, <span class="st">&quot;aspect&quot;</span>))</span>
<span id="cb16-9"><a href="preparing-environmental-predictors.html#cb16-9"></a>elevData &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">stack</span>(alt.hills, slopeData)</span>
<span id="cb16-10"><a href="preparing-environmental-predictors.html#cb16-10"></a><span class="kw">rm</span>(alt.hills)</span>
<span id="cb16-11"><a href="preparing-environmental-predictors.html#cb16-11"></a><span class="kw">gc</span>()</span></code></pre></div>
</div>
<div id="prepare-bioclim-4a-and-bioclim-15" class="section level2">
<h2><span class="header-section-number">3.4</span> Prepare Bioclim 4a and Bioclim 15</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="preparing-environmental-predictors.html#cb17-1"></a><span class="co"># list chelsa files</span></span>
<span id="cb17-2"><a href="preparing-environmental-predictors.html#cb17-2"></a>chelsaFiles &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;data/chelsa/&quot;</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>, <span class="dt">pattern =</span> <span class="st">&quot;tif&quot;</span>)</span>
<span id="cb17-3"><a href="preparing-environmental-predictors.html#cb17-3"></a></span>
<span id="cb17-4"><a href="preparing-environmental-predictors.html#cb17-4"></a><span class="co"># load Bio 1 and 12</span></span>
<span id="cb17-5"><a href="preparing-environmental-predictors.html#cb17-5"></a>bio_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;data/chelsa/envicloud/chelsa/chelsa_V1/climatologies/bio/CHELSA_bio10_01.tif&quot;</span>)</span>
<span id="cb17-6"><a href="preparing-environmental-predictors.html#cb17-6"></a>bio_<span class="dv">12</span> &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;data/chelsa/envicloud/chelsa/chelsa_V1/climatologies/bio/CHELSA_bio10_12.tif&quot;</span>)</span></code></pre></div>
</div>
<div id="prepare-chelsa-rasters" class="section level2">
<h2><span class="header-section-number">3.5</span> Prepare CHELSA rasters</h2>
<p>CHELSA rasters can be downloaded using the <code>get_chelsa.sh</code> shell script, which is a <code>wget</code> command pointing to the <code>envidatS3.txt</code> file.</p>
<div id="prepare-bioclim-4a-and-15" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Prepare BIOCLIM 4a and 15</h3>
<p>We prepare the CHELSA rasters for seasonality in temperature (Bio 4a) and seasonality in precipitation (Bio 15) in the same way, reading them in, cropping them to the study site buffer extent, and handling the temperature layer values which we divide by 10. The CHELSA rasters can be downloaded from <a href="https://chelsa-climate.org/bioclim/" class="uri">https://chelsa-climate.org/bioclim/</a></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="preparing-environmental-predictors.html#cb18-1"></a><span class="co"># list chelsa files</span></span>
<span id="cb18-2"><a href="preparing-environmental-predictors.html#cb18-2"></a><span class="co"># the chelsa data can be downloaded from the aforementioned link. They haven&#39;t been uploaded to github as a result of its large size.</span></span>
<span id="cb18-3"><a href="preparing-environmental-predictors.html#cb18-3"></a>chelsaFiles &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;data/chelsa/&quot;</span>,</span>
<span id="cb18-4"><a href="preparing-environmental-predictors.html#cb18-4"></a>  <span class="dt">full.names =</span> <span class="ot">TRUE</span>,</span>
<span id="cb18-5"><a href="preparing-environmental-predictors.html#cb18-5"></a>  <span class="dt">recursive =</span> <span class="ot">TRUE</span>,</span>
<span id="cb18-6"><a href="preparing-environmental-predictors.html#cb18-6"></a>  <span class="dt">pattern =</span> <span class="st">&quot;bio10&quot;</span></span>
<span id="cb18-7"><a href="preparing-environmental-predictors.html#cb18-7"></a>)</span>
<span id="cb18-8"><a href="preparing-environmental-predictors.html#cb18-8"></a></span>
<span id="cb18-9"><a href="preparing-environmental-predictors.html#cb18-9"></a><span class="co"># gather chelsa rasters</span></span>
<span id="cb18-10"><a href="preparing-environmental-predictors.html#cb18-10"></a>chelsaData &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(chelsaFiles, <span class="cf">function</span>(chr) {</span>
<span id="cb18-11"><a href="preparing-environmental-predictors.html#cb18-11"></a>  a &lt;-<span class="st"> </span><span class="kw">raster</span>(chr)</span>
<span id="cb18-12"><a href="preparing-environmental-predictors.html#cb18-12"></a>  <span class="kw">crs</span>(a) &lt;-<span class="st"> </span><span class="kw">crs</span>(elevData)</span>
<span id="cb18-13"><a href="preparing-environmental-predictors.html#cb18-13"></a>  a &lt;-<span class="st"> </span><span class="kw">crop</span>(a, <span class="kw">as</span>(buffer, <span class="st">&quot;Spatial&quot;</span>))</span>
<span id="cb18-14"><a href="preparing-environmental-predictors.html#cb18-14"></a>  <span class="kw">return</span>(a)</span>
<span id="cb18-15"><a href="preparing-environmental-predictors.html#cb18-15"></a>})</span>
<span id="cb18-16"><a href="preparing-environmental-predictors.html#cb18-16"></a></span>
<span id="cb18-17"><a href="preparing-environmental-predictors.html#cb18-17"></a><span class="co"># divide temperature by 10</span></span>
<span id="cb18-18"><a href="preparing-environmental-predictors.html#cb18-18"></a>chelsaData[[<span class="dv">1</span>]] &lt;-<span class="st"> </span>chelsaData[[<span class="dv">1</span>]] <span class="op">/</span><span class="st"> </span><span class="dv">10</span></span>
<span id="cb18-19"><a href="preparing-environmental-predictors.html#cb18-19"></a></span>
<span id="cb18-20"><a href="preparing-environmental-predictors.html#cb18-20"></a><span class="co"># stack chelsa data</span></span>
<span id="cb18-21"><a href="preparing-environmental-predictors.html#cb18-21"></a>chelsaData &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">stack</span>(chelsaData)</span></code></pre></div>
</div>
<div id="prepare-bioclim-4a" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Prepare BIOCLIM 4a</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="preparing-environmental-predictors.html#cb19-1"></a><span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">&quot;data/chelsa/CHELSA_bio10_4a.tif&quot;</span>)) {</span>
<span id="cb19-2"><a href="preparing-environmental-predictors.html#cb19-2"></a>  <span class="kw">message</span>(<span class="st">&quot;Bio 4a already exists, will be overwritten&quot;</span>)</span>
<span id="cb19-3"><a href="preparing-environmental-predictors.html#cb19-3"></a>}</span></code></pre></div>
<p>Bioclim 4a, the coefficient of variation temperature seasonality is calculated as</p>
<p><span class="math display">\[Bio\ 4a = \frac{SD\{ Tkavg_1, \ldots Tkavg_{12} \}}{(Bio\ 1 + 273.15)} \times 100\]</span></p>
<p>where <span class="math inline">\(Tkavg_i = (Tkmin_i + Tkmax_i) / 2\)</span></p>
<p>Here, we use only the months of December and Jan – May for winter temperature variation.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="preparing-environmental-predictors.html#cb20-1"></a><span class="co"># list rasters by pattern</span></span>
<span id="cb20-2"><a href="preparing-environmental-predictors.html#cb20-2"></a>patterns &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;tmin&quot;</span>, <span class="st">&quot;tmax&quot;</span>)</span>
<span id="cb20-3"><a href="preparing-environmental-predictors.html#cb20-3"></a></span>
<span id="cb20-4"><a href="preparing-environmental-predictors.html#cb20-4"></a><span class="co"># list the filepaths</span></span>
<span id="cb20-5"><a href="preparing-environmental-predictors.html#cb20-5"></a>tkAvg &lt;-<span class="st"> </span><span class="kw">map</span>(patterns, <span class="cf">function</span>(pattern) {</span>
<span id="cb20-6"><a href="preparing-environmental-predictors.html#cb20-6"></a>  <span class="co"># list the paths</span></span>
<span id="cb20-7"><a href="preparing-environmental-predictors.html#cb20-7"></a>  files &lt;-<span class="st"> </span><span class="kw">list.files</span>(</span>
<span id="cb20-8"><a href="preparing-environmental-predictors.html#cb20-8"></a>    <span class="dt">path =</span> <span class="st">&quot;data/chelsa&quot;</span>,</span>
<span id="cb20-9"><a href="preparing-environmental-predictors.html#cb20-9"></a>    <span class="dt">full.names =</span> <span class="ot">TRUE</span>,</span>
<span id="cb20-10"><a href="preparing-environmental-predictors.html#cb20-10"></a>    <span class="dt">recursive =</span> <span class="ot">TRUE</span>,</span>
<span id="cb20-11"><a href="preparing-environmental-predictors.html#cb20-11"></a>    <span class="dt">pattern =</span> pattern</span>
<span id="cb20-12"><a href="preparing-environmental-predictors.html#cb20-12"></a>  )</span>
<span id="cb20-13"><a href="preparing-environmental-predictors.html#cb20-13"></a>})</span>
<span id="cb20-14"><a href="preparing-environmental-predictors.html#cb20-14"></a></span>
<span id="cb20-15"><a href="preparing-environmental-predictors.html#cb20-15"></a><span class="co"># print crs elev data for sanity check --- basic WGS84</span></span>
<span id="cb20-16"><a href="preparing-environmental-predictors.html#cb20-16"></a><span class="kw">crs</span>(elevData)</span>
<span id="cb20-17"><a href="preparing-environmental-predictors.html#cb20-17"></a></span>
<span id="cb20-18"><a href="preparing-environmental-predictors.html#cb20-18"></a><span class="co"># now run over the paths and read as rasters and crop by buffer</span></span>
<span id="cb20-19"><a href="preparing-environmental-predictors.html#cb20-19"></a>tkAvg &lt;-<span class="st"> </span><span class="kw">map</span>(tkAvg, <span class="cf">function</span>(paths) {</span>
<span id="cb20-20"><a href="preparing-environmental-predictors.html#cb20-20"></a>  <span class="co"># going over the file paths, read them in as rasters, convert CRS and crop</span></span>
<span id="cb20-21"><a href="preparing-environmental-predictors.html#cb20-21"></a>  tempData &lt;-<span class="st"> </span><span class="kw">map</span>(paths, <span class="cf">function</span>(path) {</span>
<span id="cb20-22"><a href="preparing-environmental-predictors.html#cb20-22"></a>    <span class="co"># read in</span></span>
<span id="cb20-23"><a href="preparing-environmental-predictors.html#cb20-23"></a>    a &lt;-<span class="st"> </span><span class="kw">raster</span>(path)</span>
<span id="cb20-24"><a href="preparing-environmental-predictors.html#cb20-24"></a>    <span class="co"># assign crs</span></span>
<span id="cb20-25"><a href="preparing-environmental-predictors.html#cb20-25"></a>    <span class="kw">crs</span>(a) &lt;-<span class="st"> </span><span class="kw">crs</span>(elevData)</span>
<span id="cb20-26"><a href="preparing-environmental-predictors.html#cb20-26"></a>    <span class="co"># crop by buffer, will throw error if CRS doesn&#39;t match</span></span>
<span id="cb20-27"><a href="preparing-environmental-predictors.html#cb20-27"></a>    a &lt;-<span class="st"> </span><span class="kw">crop</span>(a, <span class="kw">as</span>(buffer, <span class="st">&quot;Spatial&quot;</span>))</span>
<span id="cb20-28"><a href="preparing-environmental-predictors.html#cb20-28"></a>    <span class="co"># return a</span></span>
<span id="cb20-29"><a href="preparing-environmental-predictors.html#cb20-29"></a>    a</span>
<span id="cb20-30"><a href="preparing-environmental-predictors.html#cb20-30"></a>  })</span>
<span id="cb20-31"><a href="preparing-environmental-predictors.html#cb20-31"></a>  <span class="co"># convert each to kelvin, first dividing by 10 to get celsius</span></span>
<span id="cb20-32"><a href="preparing-environmental-predictors.html#cb20-32"></a>  tempData &lt;-<span class="st"> </span><span class="kw">map</span>(tempData, <span class="cf">function</span>(tmpRaster) {</span>
<span id="cb20-33"><a href="preparing-environmental-predictors.html#cb20-33"></a>    tmpRaster &lt;-<span class="st"> </span>(tmpRaster <span class="op">/</span><span class="st"> </span><span class="dv">10</span>) <span class="op">+</span><span class="st"> </span><span class="fl">273.15</span></span>
<span id="cb20-34"><a href="preparing-environmental-predictors.html#cb20-34"></a>  })</span>
<span id="cb20-35"><a href="preparing-environmental-predictors.html#cb20-35"></a>})</span>
<span id="cb20-36"><a href="preparing-environmental-predictors.html#cb20-36"></a></span>
<span id="cb20-37"><a href="preparing-environmental-predictors.html#cb20-37"></a><span class="co"># assign names</span></span>
<span id="cb20-38"><a href="preparing-environmental-predictors.html#cb20-38"></a><span class="kw">names</span>(tkAvg) &lt;-<span class="st"> </span>patterns</span>
<span id="cb20-39"><a href="preparing-environmental-predictors.html#cb20-39"></a></span>
<span id="cb20-40"><a href="preparing-environmental-predictors.html#cb20-40"></a><span class="co"># go over the tmin and tmax and get the average monthly temp</span></span>
<span id="cb20-41"><a href="preparing-environmental-predictors.html#cb20-41"></a>tkAvg &lt;-<span class="st"> </span><span class="kw">map2</span>(tkAvg[[<span class="st">&quot;tmin&quot;</span>]], tkAvg[[<span class="st">&quot;tmax&quot;</span>]], <span class="cf">function</span>(tmin, tmax) {</span>
<span id="cb20-42"><a href="preparing-environmental-predictors.html#cb20-42"></a>  <span class="co"># return the mean of the corresponding tmin and tmax</span></span>
<span id="cb20-43"><a href="preparing-environmental-predictors.html#cb20-43"></a>  <span class="co"># still in kelvin</span></span>
<span id="cb20-44"><a href="preparing-environmental-predictors.html#cb20-44"></a>  <span class="kw">calc</span>(<span class="kw">stack</span>(tmin, tmax), <span class="dt">fun =</span> mean)</span>
<span id="cb20-45"><a href="preparing-environmental-predictors.html#cb20-45"></a>})</span>
<span id="cb20-46"><a href="preparing-environmental-predictors.html#cb20-46"></a></span>
<span id="cb20-47"><a href="preparing-environmental-predictors.html#cb20-47"></a><span class="co"># calculate Bio 4a</span></span>
<span id="cb20-48"><a href="preparing-environmental-predictors.html#cb20-48"></a>bio_4a &lt;-<span class="st"> </span>(<span class="kw">calc</span>(<span class="kw">stack</span>(tkAvg), <span class="dt">fun =</span> sd) <span class="op">/</span><span class="st"> </span>(chelsaData[[<span class="dv">1</span>]] <span class="op">+</span><span class="st"> </span><span class="fl">273.15</span>)) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb20-49"><a href="preparing-environmental-predictors.html#cb20-49"></a><span class="kw">names</span>(bio_4a) &lt;-<span class="st"> &quot;CHELSA_bio10_4a&quot;</span></span>
<span id="cb20-50"><a href="preparing-environmental-predictors.html#cb20-50"></a><span class="co"># save bio_4a</span></span>
<span id="cb20-51"><a href="preparing-environmental-predictors.html#cb20-51"></a><span class="kw">writeRaster</span>(bio_4a, <span class="dt">filename =</span> <span class="st">&quot;data/chelsa/CHELSA_bio10_4a.tif&quot;</span>, <span class="dt">overwrite =</span> T)</span></code></pre></div>
</div>
<div id="prepare-bioclim-15" class="section level3">
<h3><span class="header-section-number">3.5.3</span> Prepare Bioclim 15</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="preparing-environmental-predictors.html#cb21-1"></a><span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">&quot;data/chelsa/CHELSA_bio10_15.tif&quot;</span>)) {</span>
<span id="cb21-2"><a href="preparing-environmental-predictors.html#cb21-2"></a>  <span class="kw">message</span>(<span class="st">&quot;Bio 15 already exists, will be overwritten&quot;</span>)</span>
<span id="cb21-3"><a href="preparing-environmental-predictors.html#cb21-3"></a>}</span></code></pre></div>
<p>Bioclim 15, the coefficient of variation precipitation (in our area, rainfall) seasonality is calculated as</p>
<p><span class="math display">\[Bio\ 15 = \frac{SD\{ PPT_1, \ldots PPT_{12} \}}{1 + (Bio\ 12 / 12)} \times 100\]</span></p>
<p>where <span class="math inline">\(PPT_i\)</span> is the monthly precipitation.</p>
<p>Here, we use only the months of December and Jan – May for winter rainfall variation.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="preparing-environmental-predictors.html#cb22-1"></a><span class="co"># list rasters by pattern</span></span>
<span id="cb22-2"><a href="preparing-environmental-predictors.html#cb22-2"></a>pattern &lt;-<span class="st"> &quot;prec&quot;</span></span>
<span id="cb22-3"><a href="preparing-environmental-predictors.html#cb22-3"></a></span>
<span id="cb22-4"><a href="preparing-environmental-predictors.html#cb22-4"></a><span class="co"># list the filepaths</span></span>
<span id="cb22-5"><a href="preparing-environmental-predictors.html#cb22-5"></a>pptTotal &lt;-<span class="st"> </span><span class="kw">list.files</span>(</span>
<span id="cb22-6"><a href="preparing-environmental-predictors.html#cb22-6"></a>  <span class="dt">path =</span> <span class="st">&quot;data/chelsa&quot;</span>,</span>
<span id="cb22-7"><a href="preparing-environmental-predictors.html#cb22-7"></a>  <span class="dt">full.names =</span> <span class="ot">TRUE</span>,</span>
<span id="cb22-8"><a href="preparing-environmental-predictors.html#cb22-8"></a>  <span class="dt">recursive =</span> <span class="ot">TRUE</span>,</span>
<span id="cb22-9"><a href="preparing-environmental-predictors.html#cb22-9"></a>  <span class="dt">pattern =</span> pattern</span>
<span id="cb22-10"><a href="preparing-environmental-predictors.html#cb22-10"></a>)</span>
<span id="cb22-11"><a href="preparing-environmental-predictors.html#cb22-11"></a></span>
<span id="cb22-12"><a href="preparing-environmental-predictors.html#cb22-12"></a><span class="co"># print crs elev data for sanity check --- basic WGS84</span></span>
<span id="cb22-13"><a href="preparing-environmental-predictors.html#cb22-13"></a><span class="kw">crs</span>(elevData)</span>
<span id="cb22-14"><a href="preparing-environmental-predictors.html#cb22-14"></a></span>
<span id="cb22-15"><a href="preparing-environmental-predictors.html#cb22-15"></a><span class="co"># now run over the paths and read as rasters and crop by buffer</span></span>
<span id="cb22-16"><a href="preparing-environmental-predictors.html#cb22-16"></a>pptTotal &lt;-<span class="st"> </span><span class="kw">map</span>(pptTotal, <span class="cf">function</span>(path) {</span>
<span id="cb22-17"><a href="preparing-environmental-predictors.html#cb22-17"></a>  a &lt;-<span class="st"> </span><span class="kw">raster</span>(path)</span>
<span id="cb22-18"><a href="preparing-environmental-predictors.html#cb22-18"></a>  <span class="co"># assign crs</span></span>
<span id="cb22-19"><a href="preparing-environmental-predictors.html#cb22-19"></a>  <span class="kw">crs</span>(a) &lt;-<span class="st"> </span><span class="kw">crs</span>(elevData)</span>
<span id="cb22-20"><a href="preparing-environmental-predictors.html#cb22-20"></a>  <span class="co"># crop by buffer, will throw error if CRS doesn&#39;t match</span></span>
<span id="cb22-21"><a href="preparing-environmental-predictors.html#cb22-21"></a>  a &lt;-<span class="st"> </span><span class="kw">crop</span>(a, <span class="kw">as</span>(buffer, <span class="st">&quot;Spatial&quot;</span>))</span>
<span id="cb22-22"><a href="preparing-environmental-predictors.html#cb22-22"></a>  <span class="co"># return a</span></span>
<span id="cb22-23"><a href="preparing-environmental-predictors.html#cb22-23"></a>  a</span>
<span id="cb22-24"><a href="preparing-environmental-predictors.html#cb22-24"></a>})</span>
<span id="cb22-25"><a href="preparing-environmental-predictors.html#cb22-25"></a></span>
<span id="cb22-26"><a href="preparing-environmental-predictors.html#cb22-26"></a><span class="co"># calculate Bio 4a</span></span>
<span id="cb22-27"><a href="preparing-environmental-predictors.html#cb22-27"></a>bio_<span class="dv">15</span> &lt;-<span class="st"> </span>(<span class="kw">calc</span>(<span class="kw">stack</span>(pptTotal), <span class="dt">fun =</span> sd) <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(chelsaData[[<span class="dv">2</span>]] <span class="op">/</span><span class="st"> </span><span class="dv">12</span>))) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb22-28"><a href="preparing-environmental-predictors.html#cb22-28"></a><span class="kw">names</span>(bio_<span class="dv">15</span>) &lt;-<span class="st"> &quot;CHELSA_bio10_15&quot;</span></span>
<span id="cb22-29"><a href="preparing-environmental-predictors.html#cb22-29"></a><span class="co"># save bio_4a</span></span>
<span id="cb22-30"><a href="preparing-environmental-predictors.html#cb22-30"></a><span class="kw">writeRaster</span>(bio_<span class="dv">15</span>, <span class="dt">filename =</span> <span class="st">&quot;data/chelsa/CHELSA_bio10_15.tif&quot;</span>, <span class="dt">overwrite =</span> T)</span></code></pre></div>
</div>
<div id="stack-terrain-and-climate" class="section level3">
<h3><span class="header-section-number">3.5.4</span> Stack terrain and climate</h3>
<p>We stack the terrain and climatic rasters.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="preparing-environmental-predictors.html#cb23-1"></a><span class="co"># stack rasters for efficient reprojection later</span></span>
<span id="cb23-2"><a href="preparing-environmental-predictors.html#cb23-2"></a>env_data &lt;-<span class="st"> </span><span class="kw">stack</span>(elevData, bio_4a, bio_<span class="dv">15</span>)</span></code></pre></div>
</div>
</div>
<div id="resample-landcover-from-10m-to-1km" class="section level2">
<h2><span class="header-section-number">3.6</span> Resample landcover from 10m to 1km</h2>
<p>We read in a land cover classified image and resample that using the mode function to a 1km resolution. Please note that the resampling process need not be carried out as it has been done already and the resampled raster can be loaded with the subsequent code chunk.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="preparing-environmental-predictors.html#cb24-1"></a><span class="co"># read in landcover raster location</span></span>
<span id="cb24-2"><a href="preparing-environmental-predictors.html#cb24-2"></a>landcover &lt;-<span class="st"> &quot;data/landUseClassification/landcover_roy_2015/&quot;</span></span>
<span id="cb24-3"><a href="preparing-environmental-predictors.html#cb24-3"></a></span>
<span id="cb24-4"><a href="preparing-environmental-predictors.html#cb24-4"></a><span class="co"># read in and crop</span></span>
<span id="cb24-5"><a href="preparing-environmental-predictors.html#cb24-5"></a>landcover &lt;-<span class="st"> </span><span class="kw">raster</span>(landcover)</span>
<span id="cb24-6"><a href="preparing-environmental-predictors.html#cb24-6"></a>buffer_utm &lt;-<span class="st"> </span><span class="kw">st_transform</span>(buffer, <span class="dv">32643</span>)</span>
<span id="cb24-7"><a href="preparing-environmental-predictors.html#cb24-7"></a>landcover &lt;-<span class="st"> </span><span class="kw">crop</span>(</span>
<span id="cb24-8"><a href="preparing-environmental-predictors.html#cb24-8"></a>  landcover,</span>
<span id="cb24-9"><a href="preparing-environmental-predictors.html#cb24-9"></a>  <span class="kw">as</span>(</span>
<span id="cb24-10"><a href="preparing-environmental-predictors.html#cb24-10"></a>    buffer_utm,</span>
<span id="cb24-11"><a href="preparing-environmental-predictors.html#cb24-11"></a>    <span class="st">&quot;Spatial&quot;</span></span>
<span id="cb24-12"><a href="preparing-environmental-predictors.html#cb24-12"></a>  )</span>
<span id="cb24-13"><a href="preparing-environmental-predictors.html#cb24-13"></a>)</span>
<span id="cb24-14"><a href="preparing-environmental-predictors.html#cb24-14"></a></span>
<span id="cb24-15"><a href="preparing-environmental-predictors.html#cb24-15"></a><span class="co"># read reclassification matrix</span></span>
<span id="cb24-16"><a href="preparing-environmental-predictors.html#cb24-16"></a>reclassification_matrix &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/landUseClassification/LandCover_ReclassifyMatrix_2015.csv&quot;</span>)</span>
<span id="cb24-17"><a href="preparing-environmental-predictors.html#cb24-17"></a>reclassification_matrix &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(reclassification_matrix[, <span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;To&quot;</span>)])</span>
<span id="cb24-18"><a href="preparing-environmental-predictors.html#cb24-18"></a></span>
<span id="cb24-19"><a href="preparing-environmental-predictors.html#cb24-19"></a><span class="co"># reclassify</span></span>
<span id="cb24-20"><a href="preparing-environmental-predictors.html#cb24-20"></a>landcover_reclassified &lt;-<span class="st"> </span><span class="kw">reclassify</span>(</span>
<span id="cb24-21"><a href="preparing-environmental-predictors.html#cb24-21"></a>  <span class="dt">x =</span> landcover,</span>
<span id="cb24-22"><a href="preparing-environmental-predictors.html#cb24-22"></a>  <span class="dt">rcl =</span> reclassification_matrix</span>
<span id="cb24-23"><a href="preparing-environmental-predictors.html#cb24-23"></a>)</span>
<span id="cb24-24"><a href="preparing-environmental-predictors.html#cb24-24"></a></span>
<span id="cb24-25"><a href="preparing-environmental-predictors.html#cb24-25"></a><span class="co"># write to file</span></span>
<span id="cb24-26"><a href="preparing-environmental-predictors.html#cb24-26"></a><span class="kw">writeRaster</span>(landcover_reclassified,</span>
<span id="cb24-27"><a href="preparing-environmental-predictors.html#cb24-27"></a>  <span class="dt">filename =</span> <span class="st">&quot;data/landUseClassification/landcover_roy_2015_reclassified.tif&quot;</span>,</span>
<span id="cb24-28"><a href="preparing-environmental-predictors.html#cb24-28"></a>  <span class="dt">overwrite =</span> <span class="ot">TRUE</span></span>
<span id="cb24-29"><a href="preparing-environmental-predictors.html#cb24-29"></a>)</span>
<span id="cb24-30"><a href="preparing-environmental-predictors.html#cb24-30"></a></span>
<span id="cb24-31"><a href="preparing-environmental-predictors.html#cb24-31"></a><span class="co"># check reclassification</span></span>
<span id="cb24-32"><a href="preparing-environmental-predictors.html#cb24-32"></a><span class="kw">plot</span>(landcover_reclassified)</span>
<span id="cb24-33"><a href="preparing-environmental-predictors.html#cb24-33"></a></span>
<span id="cb24-34"><a href="preparing-environmental-predictors.html#cb24-34"></a><span class="co"># get extent</span></span>
<span id="cb24-35"><a href="preparing-environmental-predictors.html#cb24-35"></a>e &lt;-<span class="st"> </span><span class="kw">bbox</span>(<span class="kw">raster</span>(landcover))</span>
<span id="cb24-36"><a href="preparing-environmental-predictors.html#cb24-36"></a></span>
<span id="cb24-37"><a href="preparing-environmental-predictors.html#cb24-37"></a><span class="co"># init resolution</span></span>
<span id="cb24-38"><a href="preparing-environmental-predictors.html#cb24-38"></a>res_init &lt;-<span class="st"> </span><span class="kw">res</span>(<span class="kw">raster</span>(landcover))</span>
<span id="cb24-39"><a href="preparing-environmental-predictors.html#cb24-39"></a></span>
<span id="cb24-40"><a href="preparing-environmental-predictors.html#cb24-40"></a><span class="co"># res to transform to 1000m</span></span>
<span id="cb24-41"><a href="preparing-environmental-predictors.html#cb24-41"></a>res_final &lt;-<span class="st"> </span>res_init <span class="op">*</span><span class="st"> </span>(<span class="dv">1000</span> <span class="op">/</span><span class="st"> </span>res_init)</span>
<span id="cb24-42"><a href="preparing-environmental-predictors.html#cb24-42"></a></span>
<span id="cb24-43"><a href="preparing-environmental-predictors.html#cb24-43"></a><span class="co"># use gdalutils gdalwarp for resampling transform</span></span>
<span id="cb24-44"><a href="preparing-environmental-predictors.html#cb24-44"></a><span class="co"># to 1km from 10m</span></span>
<span id="cb24-45"><a href="preparing-environmental-predictors.html#cb24-45"></a>gdalUtils<span class="op">::</span><span class="kw">gdalwarp</span>(</span>
<span id="cb24-46"><a href="preparing-environmental-predictors.html#cb24-46"></a>  <span class="dt">srcfile =</span> <span class="st">&quot;data/landUseClassification/landcover_roy_2015_reclassified.tif&quot;</span>,</span>
<span id="cb24-47"><a href="preparing-environmental-predictors.html#cb24-47"></a>  <span class="dt">dstfile =</span> <span class="st">&quot;data/landUseClassification/lc_01000m.tif&quot;</span>,</span>
<span id="cb24-48"><a href="preparing-environmental-predictors.html#cb24-48"></a>  <span class="dt">tr =</span> <span class="kw">c</span>(res_final), <span class="dt">r =</span> <span class="st">&quot;mode&quot;</span>, <span class="dt">te =</span> <span class="kw">c</span>(e)</span>
<span id="cb24-49"><a href="preparing-environmental-predictors.html#cb24-49"></a>)</span></code></pre></div>
<p>We compare the frequency of landcover classes between the original raster and the resampled 1km raster to be certain that the resampling has not resulted in drastic misrepresentation of the frequency of any landcover type. This comparison is made using the figure below.</p>
</div>
<div id="resample-other-rasters-to-1km" class="section level2">
<h2><span class="header-section-number">3.7</span> Resample other rasters to 1km</h2>
<p>We now resample all other rasters to a resolution of 1km.</p>
<div id="read-in-resampled-landcover" class="section level3">
<h3><span class="header-section-number">3.7.1</span> Read in resampled landcover</h3>
<p>Here, we read in the 1km landcover raster and set 0 to NA.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="preparing-environmental-predictors.html#cb25-1"></a>lc_data &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;data/landUseClassification/lc_01000m.tif&quot;</span>)</span>
<span id="cb25-2"><a href="preparing-environmental-predictors.html#cb25-2"></a>lc_data[lc_data <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span></code></pre></div>
</div>
<div id="reproject-environmental-data-using-landcover-as-a-template" class="section level3">
<h3><span class="header-section-number">3.7.2</span> Reproject environmental data using landcover as a template</h3>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="preparing-environmental-predictors.html#cb26-1"></a><span class="co"># resample to the corresponding landcover data</span></span>
<span id="cb26-2"><a href="preparing-environmental-predictors.html#cb26-2"></a>env_data_resamp &lt;-<span class="st"> </span><span class="kw">projectRaster</span>(</span>
<span id="cb26-3"><a href="preparing-environmental-predictors.html#cb26-3"></a>  <span class="dt">from =</span> env_data, <span class="dt">to =</span> lc_data,</span>
<span id="cb26-4"><a href="preparing-environmental-predictors.html#cb26-4"></a>  <span class="dt">crs =</span> <span class="kw">crs</span>(lc_data), <span class="dt">res =</span> <span class="kw">res</span>(lc_data)</span>
<span id="cb26-5"><a href="preparing-environmental-predictors.html#cb26-5"></a>)</span>
<span id="cb26-6"><a href="preparing-environmental-predictors.html#cb26-6"></a></span>
<span id="cb26-7"><a href="preparing-environmental-predictors.html#cb26-7"></a><span class="co"># export as raster stack</span></span>
<span id="cb26-8"><a href="preparing-environmental-predictors.html#cb26-8"></a>land_stack &lt;-<span class="st"> </span><span class="kw">stack</span>(env_data_resamp, lc_data)</span>
<span id="cb26-9"><a href="preparing-environmental-predictors.html#cb26-9"></a></span>
<span id="cb26-10"><a href="preparing-environmental-predictors.html#cb26-10"></a><span class="co"># get names</span></span>
<span id="cb26-11"><a href="preparing-environmental-predictors.html#cb26-11"></a>land_names &lt;-<span class="st"> </span><span class="kw">glue</span>(<span class="st">&#39;data/spatial/landscape_resamp{c(&quot;01&quot;)}_km.tif&#39;</span>)</span>
<span id="cb26-12"><a href="preparing-environmental-predictors.html#cb26-12"></a></span>
<span id="cb26-13"><a href="preparing-environmental-predictors.html#cb26-13"></a><span class="co"># write to file</span></span>
<span id="cb26-14"><a href="preparing-environmental-predictors.html#cb26-14"></a><span class="kw">writeRaster</span>(land_stack, <span class="dt">filename =</span> <span class="kw">as.character</span>(land_names), <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="temperature-and-rainfall-in-relation-to-elevation" class="section level2">
<h2><span class="header-section-number">3.8</span> Temperature and rainfall in relation to elevation</h2>
<div id="load-resampled-environmental-rasters" class="section level3">
<h3><span class="header-section-number">3.8.1</span> Load resampled environmental rasters</h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="preparing-environmental-predictors.html#cb27-1"></a><span class="co"># read landscape prepare for plotting</span></span>
<span id="cb27-2"><a href="preparing-environmental-predictors.html#cb27-2"></a>landscape &lt;-<span class="st"> </span><span class="kw">stack</span>(<span class="st">&quot;data/spatial/landscape_resamp01_km.tif&quot;</span>)</span>
<span id="cb27-3"><a href="preparing-environmental-predictors.html#cb27-3"></a></span>
<span id="cb27-4"><a href="preparing-environmental-predictors.html#cb27-4"></a><span class="co"># get proper names</span></span>
<span id="cb27-5"><a href="preparing-environmental-predictors.html#cb27-5"></a>elev_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;elev&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;aspect&quot;</span>)</span>
<span id="cb27-6"><a href="preparing-environmental-predictors.html#cb27-6"></a>chelsa_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;bio_4a&quot;</span>, <span class="st">&quot;bio_15&quot;</span>)</span>
<span id="cb27-7"><a href="preparing-environmental-predictors.html#cb27-7"></a></span>
<span id="cb27-8"><a href="preparing-environmental-predictors.html#cb27-8"></a><span class="kw">names</span>(landscape) &lt;-<span class="st"> </span><span class="kw">glue</span>(<span class="st">&#39;{c(elev_names, chelsa_names, &quot;landcover&quot;)}&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="preparing-environmental-predictors.html#cb28-1"></a><span class="co"># make duplicate stack</span></span>
<span id="cb28-2"><a href="preparing-environmental-predictors.html#cb28-2"></a>land_data &lt;-<span class="st"> </span>landscape[[<span class="kw">c</span>(<span class="st">&quot;elev&quot;</span>, chelsa_names)]]</span>
<span id="cb28-3"><a href="preparing-environmental-predictors.html#cb28-3"></a></span>
<span id="cb28-4"><a href="preparing-environmental-predictors.html#cb28-4"></a><span class="co"># convert to list</span></span>
<span id="cb28-5"><a href="preparing-environmental-predictors.html#cb28-5"></a>land_data &lt;-<span class="st"> </span><span class="kw">as.list</span>(land_data)</span>
<span id="cb28-6"><a href="preparing-environmental-predictors.html#cb28-6"></a></span>
<span id="cb28-7"><a href="preparing-environmental-predictors.html#cb28-7"></a><span class="co"># map get values over the stack</span></span>
<span id="cb28-8"><a href="preparing-environmental-predictors.html#cb28-8"></a>land_data &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(land_data, getValues)</span>
<span id="cb28-9"><a href="preparing-environmental-predictors.html#cb28-9"></a><span class="kw">names</span>(land_data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;elev&quot;</span>, chelsa_names)</span>
<span id="cb28-10"><a href="preparing-environmental-predictors.html#cb28-10"></a></span>
<span id="cb28-11"><a href="preparing-environmental-predictors.html#cb28-11"></a><span class="co"># conver to dataframe and round to 100m</span></span>
<span id="cb28-12"><a href="preparing-environmental-predictors.html#cb28-12"></a>land_data &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(land_data)</span>
<span id="cb28-13"><a href="preparing-environmental-predictors.html#cb28-13"></a>land_data &lt;-<span class="st"> </span><span class="kw">drop_na</span>(land_data) <span class="op">%&gt;%</span></span>
<span id="cb28-14"><a href="preparing-environmental-predictors.html#cb28-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">elev_round =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(elev, <span class="dv">200</span>)) <span class="op">%&gt;%</span></span>
<span id="cb28-15"><a href="preparing-environmental-predictors.html#cb28-15"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>elev) <span class="op">%&gt;%</span></span>
<span id="cb28-16"><a href="preparing-environmental-predictors.html#cb28-16"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
<span id="cb28-17"><a href="preparing-environmental-predictors.html#cb28-17"></a>    <span class="dt">cols =</span> <span class="kw">contains</span>(<span class="st">&quot;bio&quot;</span>),</span>
<span id="cb28-18"><a href="preparing-environmental-predictors.html#cb28-18"></a>    <span class="dt">names_to =</span> <span class="st">&quot;clim_var&quot;</span></span>
<span id="cb28-19"><a href="preparing-environmental-predictors.html#cb28-19"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb28-20"><a href="preparing-environmental-predictors.html#cb28-20"></a><span class="st">  </span><span class="kw">group_by</span>(elev_round, clim_var) <span class="op">%&gt;%</span></span>
<span id="cb28-21"><a href="preparing-environmental-predictors.html#cb28-21"></a><span class="st">  </span><span class="kw">summarise_all</span>(<span class="dt">.funs =</span> <span class="kw">list</span>(<span class="op">~</span><span class="st"> </span><span class="kw">mean</span>(.), <span class="op">~</span><span class="st"> </span><span class="kw">ci</span>(.)))</span></code></pre></div>
<p>Figure code is hidden in versions rendered as HTML or PDF.</p>
</div>
</div>
<div id="land-cover-type-in-relation-to-elevation" class="section level2">
<h2><span class="header-section-number">3.9</span> Land cover type in relation to elevation</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="preparing-environmental-predictors.html#cb29-1"></a><span class="co"># get data from landscape rasters</span></span>
<span id="cb29-2"><a href="preparing-environmental-predictors.html#cb29-2"></a>lc_elev &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb29-3"><a href="preparing-environmental-predictors.html#cb29-3"></a>  <span class="dt">elev =</span> <span class="kw">getValues</span>(landscape[[<span class="st">&quot;elev&quot;</span>]]),</span>
<span id="cb29-4"><a href="preparing-environmental-predictors.html#cb29-4"></a>  <span class="dt">landcover =</span> <span class="kw">getValues</span>(landscape[[<span class="st">&quot;landcover&quot;</span>]])</span>
<span id="cb29-5"><a href="preparing-environmental-predictors.html#cb29-5"></a>)</span>
<span id="cb29-6"><a href="preparing-environmental-predictors.html#cb29-6"></a></span>
<span id="cb29-7"><a href="preparing-environmental-predictors.html#cb29-7"></a><span class="co"># process data for proportions</span></span>
<span id="cb29-8"><a href="preparing-environmental-predictors.html#cb29-8"></a>lc_elev &lt;-<span class="st"> </span>lc_elev <span class="op">%&gt;%</span></span>
<span id="cb29-9"><a href="preparing-environmental-predictors.html#cb29-9"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(landcover), <span class="op">!</span><span class="kw">is.na</span>(elev)) <span class="op">%&gt;%</span></span>
<span id="cb29-10"><a href="preparing-environmental-predictors.html#cb29-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">elev =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(elev, <span class="dv">100</span>)) <span class="op">%&gt;%</span></span>
<span id="cb29-11"><a href="preparing-environmental-predictors.html#cb29-11"></a><span class="st">  </span><span class="kw">count</span>(elev, landcover) <span class="op">%&gt;%</span></span>
<span id="cb29-12"><a href="preparing-environmental-predictors.html#cb29-12"></a><span class="st">  </span><span class="kw">group_by</span>(elev) <span class="op">%&gt;%</span></span>
<span id="cb29-13"><a href="preparing-environmental-predictors.html#cb29-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</span>
<span id="cb29-14"><a href="preparing-environmental-predictors.html#cb29-14"></a></span>
<span id="cb29-15"><a href="preparing-environmental-predictors.html#cb29-15"></a><span class="co"># fill out lc elev</span></span>
<span id="cb29-16"><a href="preparing-environmental-predictors.html#cb29-16"></a>lc_elev_canon &lt;-<span class="st"> </span><span class="kw">crossing</span>(</span>
<span id="cb29-17"><a href="preparing-environmental-predictors.html#cb29-17"></a>  <span class="dt">elev =</span> <span class="kw">unique</span>(lc_elev<span class="op">$</span>elev),</span>
<span id="cb29-18"><a href="preparing-environmental-predictors.html#cb29-18"></a>  <span class="dt">landcover =</span> <span class="kw">unique</span>(lc_elev<span class="op">$</span>landcover)</span>
<span id="cb29-19"><a href="preparing-environmental-predictors.html#cb29-19"></a>)</span>
<span id="cb29-20"><a href="preparing-environmental-predictors.html#cb29-20"></a></span>
<span id="cb29-21"><a href="preparing-environmental-predictors.html#cb29-21"></a><span class="co"># bind with lcelev</span></span>
<span id="cb29-22"><a href="preparing-environmental-predictors.html#cb29-22"></a>lc_elev &lt;-<span class="st"> </span><span class="kw">full_join</span>(lc_elev, lc_elev_canon)</span>
<span id="cb29-23"><a href="preparing-environmental-predictors.html#cb29-23"></a></span>
<span id="cb29-24"><a href="preparing-environmental-predictors.html#cb29-24"></a><span class="co"># convert NA to zero</span></span>
<span id="cb29-25"><a href="preparing-environmental-predictors.html#cb29-25"></a>lc_elev &lt;-<span class="st"> </span><span class="kw">replace_na</span>(lc_elev, <span class="dt">replace =</span> <span class="kw">list</span>(<span class="dt">n =</span> <span class="dv">0</span>, <span class="dt">prop =</span> <span class="dv">0</span>))</span></code></pre></div>
<p>Figure code is hidden in versions rendered as HTML and PDF.</p>
</div>
<div id="main-text-figure-2" class="section level2">
<h2><span class="header-section-number">3.10</span> Main Text Figure 2</h2>
<div class="figure">
<img src="figs/fig_02.png" alt="" />
<p class="caption">(a) Seasonality in precipitation and seasonality in temperature as a function of elevation is shown here. The coefficient of variation was calculated. (b) The proportion of land cover types varied across the study area as shown in this panel.</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="preparing-ebird-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="preparing-observer-expertise-scores.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pratikunterwegs/eBirdOccupancy/edit/master/02_prep-environmental-predictors.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ebird_occupancy_main_text.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
