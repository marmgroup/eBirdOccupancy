<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 9 Supplementary material | Influence of land cover and climate on the occupancy of avian distributions along a tropical montane gradient</title>
  <meta name="description" content="Section 9 Supplementary material | Influence of land cover and climate on the occupancy of avian distributions along a tropical montane gradient" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 9 Supplementary material | Influence of land cover and climate on the occupancy of avian distributions along a tropical montane gradient" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Section 9 Supplementary material | Influence of land cover and climate on the occupancy of avian distributions along a tropical montane gradient" />
  <meta name="github-repo" content="pratikunterwegs/eBirdOccupancy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 9 Supplementary material | Influence of land cover and climate on the occupancy of avian distributions along a tropical montane gradient" />
  
  <meta name="twitter:description" content="Section 9 Supplementary material | Influence of land cover and climate on the occupancy of avian distributions along a tropical montane gradient" />
  

<meta name="author" content="Vijay Ramesh, Pratik R Gupte, and Morgan Tingley" />


<meta name="date" content="2020-05-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="results-occupancy-predictors.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#attribution"><i class="fa fa-check"></i><b>1.1</b> Attribution</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-access"><i class="fa fa-check"></i><b>1.2</b> Data access</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.3</b> Data processing</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html"><i class="fa fa-check"></i><b>2</b> Preparing eBird data</a><ul>
<li class="chapter" data-level="2.1" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#prepare-libraries-and-data-sources"><i class="fa fa-check"></i><b>2.1</b> Prepare libraries and data sources</a></li>
<li class="chapter" data-level="2.2" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#filter-data"><i class="fa fa-check"></i><b>2.2</b> Filter data</a></li>
<li class="chapter" data-level="2.3" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#process-filtered-data"><i class="fa fa-check"></i><b>2.3</b> Process filtered data</a></li>
<li class="chapter" data-level="2.4" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#spatial-filter"><i class="fa fa-check"></i><b>2.4</b> Spatial filter</a></li>
<li class="chapter" data-level="2.5" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#handle-presence-data"><i class="fa fa-check"></i><b>2.5</b> Handle presence data</a></li>
<li class="chapter" data-level="2.6" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#add-decimal-time"><i class="fa fa-check"></i><b>2.6</b> Add decimal time</a></li>
<li class="chapter" data-level="2.7" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#write-data"><i class="fa fa-check"></i><b>2.7</b> Write data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="prepare-landscape-data.html"><a href="prepare-landscape-data.html"><i class="fa fa-check"></i><b>3</b> Prepare landscape data</a><ul>
<li class="chapter" data-level="3.1" data-path="prepare-landscape-data.html"><a href="prepare-landscape-data.html#prepare-libraries"><i class="fa fa-check"></i><b>3.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="3.2" data-path="prepare-landscape-data.html"><a href="prepare-landscape-data.html#prepare-initial-data"><i class="fa fa-check"></i><b>3.2</b> Prepare initial data</a><ul>
<li class="chapter" data-level="3.2.1" data-path="prepare-landscape-data.html"><a href="prepare-landscape-data.html#prepare-spatial-extent"><i class="fa fa-check"></i><b>3.2.1</b> Prepare spatial extent</a></li>
<li class="chapter" data-level="3.2.2" data-path="prepare-landscape-data.html"><a href="prepare-landscape-data.html#prepare-terrain-rasters"><i class="fa fa-check"></i><b>3.2.2</b> Prepare terrain rasters</a></li>
<li class="chapter" data-level="3.2.3" data-path="prepare-landscape-data.html"><a href="prepare-landscape-data.html#prepare-chelsa-rasters"><i class="fa fa-check"></i><b>3.2.3</b> Prepare CHELSA rasters</a></li>
<li class="chapter" data-level="3.2.4" data-path="prepare-landscape-data.html"><a href="prepare-landscape-data.html#stack-prepared-rasters"><i class="fa fa-check"></i><b>3.2.4</b> Stack prepared rasters</a></li>
<li class="chapter" data-level="3.2.5" data-path="prepare-landscape-data.html"><a href="prepare-landscape-data.html#prepare-landcover"><i class="fa fa-check"></i><b>3.2.5</b> Prepare landcover</a></li>
<li class="chapter" data-level="3.2.6" data-path="prepare-landscape-data.html"><a href="prepare-landscape-data.html#show-resampled-landcover"><i class="fa fa-check"></i><b>3.2.6</b> Show resampled landcover</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="prepare-landscape-data.html"><a href="prepare-landscape-data.html#resample-rasters"><i class="fa fa-check"></i><b>3.3</b> Resample rasters</a><ul>
<li class="chapter" data-level="3.3.1" data-path="prepare-landscape-data.html"><a href="prepare-landscape-data.html#read-landcover-as-list"><i class="fa fa-check"></i><b>3.3.1</b> Read landcover as list</a></li>
<li class="chapter" data-level="3.3.2" data-path="prepare-landscape-data.html"><a href="prepare-landscape-data.html#reproject-environmental-data-to-landcover"><i class="fa fa-check"></i><b>3.3.2</b> Reproject environmental data to landcover</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="prepare-observer-expertise.html"><a href="prepare-observer-expertise.html"><i class="fa fa-check"></i><b>4</b> Prepare observer expertise</a><ul>
<li class="chapter" data-level="4.1" data-path="prepare-observer-expertise.html"><a href="prepare-observer-expertise.html#prepare-libraries-1"><i class="fa fa-check"></i><b>4.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="4.2" data-path="prepare-observer-expertise.html"><a href="prepare-observer-expertise.html#prepare-data"><i class="fa fa-check"></i><b>4.2</b> Prepare data</a></li>
<li class="chapter" data-level="4.3" data-path="prepare-observer-expertise.html"><a href="prepare-observer-expertise.html#explicit-spatial-subset"><i class="fa fa-check"></i><b>4.3</b> Explicit spatial subset</a></li>
<li class="chapter" data-level="4.4" data-path="prepare-observer-expertise.html"><a href="prepare-observer-expertise.html#prepare-species-of-interest"><i class="fa fa-check"></i><b>4.4</b> Prepare species of interest</a></li>
<li class="chapter" data-level="4.5" data-path="prepare-observer-expertise.html"><a href="prepare-observer-expertise.html#prepare-checklists-for-observer-score"><i class="fa fa-check"></i><b>4.5</b> Prepare checklists for observer score</a></li>
<li class="chapter" data-level="4.6" data-path="prepare-observer-expertise.html"><a href="prepare-observer-expertise.html#get-landcover"><i class="fa fa-check"></i><b>4.6</b> Get landcover</a></li>
<li class="chapter" data-level="4.7" data-path="prepare-observer-expertise.html"><a href="prepare-observer-expertise.html#filter-data-for-stats"><i class="fa fa-check"></i><b>4.7</b> Filter data for stats</a></li>
<li class="chapter" data-level="4.8" data-path="prepare-observer-expertise.html"><a href="prepare-observer-expertise.html#run-observer-expertise-model"><i class="fa fa-check"></i><b>4.8</b> Run observer expertise model</a></li>
<li class="chapter" data-level="4.9" data-path="prepare-observer-expertise.html"><a href="prepare-observer-expertise.html#write-model-to-file"><i class="fa fa-check"></i><b>4.9</b> Write model to file</a></li>
<li class="chapter" data-level="4.10" data-path="prepare-observer-expertise.html"><a href="prepare-observer-expertise.html#get-observer-expertise-as-species-in-60-mins"><i class="fa fa-check"></i><b>4.10</b> Get observer expertise as species in 60 mins</a></li>
<li class="chapter" data-level="4.11" data-path="prepare-observer-expertise.html"><a href="prepare-observer-expertise.html#write-observer-expertise-to-file"><i class="fa fa-check"></i><b>4.11</b> Write observer expertise to file</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="add-covariates-to-subsampled-data.html"><a href="add-covariates-to-subsampled-data.html"><i class="fa fa-check"></i><b>5</b> Add covariates to subsampled data</a><ul>
<li class="chapter" data-level="5.1" data-path="add-covariates-to-subsampled-data.html"><a href="add-covariates-to-subsampled-data.html#prepare-libraries-and-data"><i class="fa fa-check"></i><b>5.1</b> Prepare libraries and data</a></li>
<li class="chapter" data-level="5.2" data-path="add-covariates-to-subsampled-data.html"><a href="add-covariates-to-subsampled-data.html#spatial-subsampling"><i class="fa fa-check"></i><b>5.2</b> Spatial subsampling</a></li>
<li class="chapter" data-level="5.3" data-path="add-covariates-to-subsampled-data.html"><a href="add-covariates-to-subsampled-data.html#temporal-subsampling"><i class="fa fa-check"></i><b>5.3</b> Temporal subsampling</a></li>
<li class="chapter" data-level="5.4" data-path="add-covariates-to-subsampled-data.html"><a href="add-covariates-to-subsampled-data.html#add-expertise-score"><i class="fa fa-check"></i><b>5.4</b> Add expertise score</a></li>
<li class="chapter" data-level="5.5" data-path="add-covariates-to-subsampled-data.html"><a href="add-covariates-to-subsampled-data.html#add-landscape-covariates"><i class="fa fa-check"></i><b>5.5</b> Add landscape covariates</a></li>
<li class="chapter" data-level="5.6" data-path="add-covariates-to-subsampled-data.html"><a href="add-covariates-to-subsampled-data.html#construct-buffers-around-subsampled-points"><i class="fa fa-check"></i><b>5.6</b> Construct buffers around subsampled points</a></li>
<li class="chapter" data-level="5.7" data-path="add-covariates-to-subsampled-data.html"><a href="add-covariates-to-subsampled-data.html#getting-area-means"><i class="fa fa-check"></i><b>5.7</b> Getting area means</a><ul>
<li class="chapter" data-level="5.7.1" data-path="add-covariates-to-subsampled-data.html"><a href="add-covariates-to-subsampled-data.html#mean-environmental-covariates"><i class="fa fa-check"></i><b>5.7.1</b> Mean environmental covariates</a></li>
<li class="chapter" data-level="5.7.2" data-path="add-covariates-to-subsampled-data.html"><a href="add-covariates-to-subsampled-data.html#proportional-landcover"><i class="fa fa-check"></i><b>5.7.2</b> Proportional landcover</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="add-covariates-to-subsampled-data.html"><a href="add-covariates-to-subsampled-data.html#join-landscape-data-to-obs-data"><i class="fa fa-check"></i><b>5.8</b> Join landscape data to obs data</a></li>
<li class="chapter" data-level="5.9" data-path="add-covariates-to-subsampled-data.html"><a href="add-covariates-to-subsampled-data.html#write-data-to-files"><i class="fa fa-check"></i><b>5.9</b> Write data to files</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="occupancy-modelling.html"><a href="occupancy-modelling.html"><i class="fa fa-check"></i><b>6</b> Occupancy modelling</a><ul>
<li class="chapter" data-level="6.1" data-path="occupancy-modelling.html"><a href="occupancy-modelling.html#load-necessary-libraries"><i class="fa fa-check"></i><b>6.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="6.2" data-path="occupancy-modelling.html"><a href="occupancy-modelling.html#load-dataframe-and-scale-covariates"><i class="fa fa-check"></i><b>6.2</b> Load dataframe and scale covariates</a></li>
<li class="chapter" data-level="6.3" data-path="occupancy-modelling.html"><a href="occupancy-modelling.html#setting-up-observation-covariates-for-each-model-as-they-remain-consistent"><i class="fa fa-check"></i><b>6.3</b> Setting up observation covariates for each model as they remain consistent</a></li>
<li class="chapter" data-level="6.4" data-path="occupancy-modelling.html"><a href="occupancy-modelling.html#get-the-aic-values-for-the-top-models"><i class="fa fa-check"></i><b>6.4</b> Get the AIC values for the top models</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="results-best-supported-hypotheses.html"><a href="results-best-supported-hypotheses.html"><i class="fa fa-check"></i><b>7</b> Results: Best supported hypotheses</a><ul>
<li class="chapter" data-level="7.1" data-path="results-best-supported-hypotheses.html"><a href="results-best-supported-hypotheses.html#prepare-libraries-2"><i class="fa fa-check"></i><b>7.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="7.2" data-path="results-best-supported-hypotheses.html"><a href="results-best-supported-hypotheses.html#prepare-data-1"><i class="fa fa-check"></i><b>7.2</b> Prepare data</a></li>
<li class="chapter" data-level="7.3" data-path="results-best-supported-hypotheses.html"><a href="results-best-supported-hypotheses.html#main-text-figure-3"><i class="fa fa-check"></i><b>7.3</b> Main text Figure 3</a></li>
<li class="chapter" data-level="7.4" data-path="results-best-supported-hypotheses.html"><a href="results-best-supported-hypotheses.html#plot-supplementary-figure-3"><i class="fa fa-check"></i><b>7.4</b> Plot supplementary Figure 3</a><ul>
<li class="chapter" data-level="7.4.1" data-path="results-best-supported-hypotheses.html"><a href="results-best-supported-hypotheses.html#prepare-data-2"><i class="fa fa-check"></i><b>7.4.1</b> Prepare data</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="results-best-supported-hypotheses.html"><a href="results-best-supported-hypotheses.html#show-figure-3-supplement"><i class="fa fa-check"></i><b>7.5</b> Show Figure 3 Supplement</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="results-occupancy-predictors.html"><a href="results-occupancy-predictors.html"><i class="fa fa-check"></i><b>8</b> Results: Occupancy predictors</a><ul>
<li class="chapter" data-level="8.1" data-path="results-occupancy-predictors.html"><a href="results-occupancy-predictors.html#prepare-libraries-3"><i class="fa fa-check"></i><b>8.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="8.2" data-path="results-occupancy-predictors.html"><a href="results-occupancy-predictors.html#get-data-from-hypothesis-sheet"><i class="fa fa-check"></i><b>8.2</b> Get data from hypothesis sheet</a></li>
<li class="chapter" data-level="8.3" data-path="results-occupancy-predictors.html"><a href="results-occupancy-predictors.html#read-model-estimates"><i class="fa fa-check"></i><b>8.3</b> Read model estimates</a></li>
<li class="chapter" data-level="8.4" data-path="results-occupancy-predictors.html"><a href="results-occupancy-predictors.html#prepare-interaction-plots"><i class="fa fa-check"></i><b>8.4</b> Prepare interaction plots</a></li>
<li class="chapter" data-level="8.5" data-path="results-occupancy-predictors.html"><a href="results-occupancy-predictors.html#show-example-interaction"><i class="fa fa-check"></i><b>8.5</b> Show example interaction</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="supplementary-material.html"><a href="supplementary-material.html"><i class="fa fa-check"></i><b>9</b> Supplementary material</a><ul>
<li class="chapter" data-level="9.1" data-path="supplementary-material.html"><a href="supplementary-material.html#distance-to-roads"><i class="fa fa-check"></i><b>9.1</b> Distance to roads</a><ul>
<li class="chapter" data-level="9.1.1" data-path="supplementary-material.html"><a href="supplementary-material.html#prepare-libraries-4"><i class="fa fa-check"></i><b>9.1.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="9.1.2" data-path="supplementary-material.html"><a href="supplementary-material.html#prepare-data-for-processing"><i class="fa fa-check"></i><b>9.1.2</b> Prepare data for processing</a></li>
<li class="chapter" data-level="9.1.3" data-path="supplementary-material.html"><a href="supplementary-material.html#species-specific-nearest-sites"><i class="fa fa-check"></i><b>9.1.3</b> Species specific nearest sites</a></li>
<li class="chapter" data-level="9.1.4" data-path="supplementary-material.html"><a href="supplementary-material.html#explicit-spatial-filter"><i class="fa fa-check"></i><b>9.1.4</b> Explicit spatial filter</a></li>
<li class="chapter" data-level="9.1.5" data-path="supplementary-material.html"><a href="supplementary-material.html#species-specific-filter"><i class="fa fa-check"></i><b>9.1.5</b> Species specific filter</a></li>
<li class="chapter" data-level="9.1.6" data-path="supplementary-material.html"><a href="supplementary-material.html#plot-histogram-distance-to-roads"><i class="fa fa-check"></i><b>9.1.6</b> Plot histogram: distance to roads</a></li>
<li class="chapter" data-level="9.1.7" data-path="supplementary-material.html"><a href="supplementary-material.html#table-distance-to-roads"><i class="fa fa-check"></i><b>9.1.7</b> Table: Distance to roads</a></li>
<li class="chapter" data-level="9.1.8" data-path="supplementary-material.html"><a href="supplementary-material.html#plot-histogram-distance-to-nearest-site"><i class="fa fa-check"></i><b>9.1.8</b> Plot histogram: distance to nearest site</a></li>
<li class="chapter" data-level="9.1.9" data-path="supplementary-material.html"><a href="supplementary-material.html#plot-species-specific-histograms-distance-to-nearest-site"><i class="fa fa-check"></i><b>9.1.9</b> Plot species specific histograms: distance to nearest site</a></li>
<li class="chapter" data-level="9.1.10" data-path="supplementary-material.html"><a href="supplementary-material.html#table-species-specific-nearest-site"><i class="fa fa-check"></i><b>9.1.10</b> Table: Species specific nearest site</a></li>
<li class="chapter" data-level="9.1.11" data-path="supplementary-material.html"><a href="supplementary-material.html#plot-map-points-on-roads"><i class="fa fa-check"></i><b>9.1.11</b> Plot map: points on roads</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="supplementary-material.html"><a href="supplementary-material.html#species-observation-distributions"><i class="fa fa-check"></i><b>9.2</b> Species observation distributions</a><ul>
<li class="chapter" data-level="9.2.1" data-path="supplementary-material.html"><a href="supplementary-material.html#prepare-libraries-5"><i class="fa fa-check"></i><b>9.2.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="9.2.2" data-path="supplementary-material.html"><a href="supplementary-material.html#read-species-of-interest"><i class="fa fa-check"></i><b>9.2.2</b> Read species of interest</a></li>
<li class="chapter" data-level="9.2.3" data-path="supplementary-material.html"><a href="supplementary-material.html#load-raw-data-for-locations"><i class="fa fa-check"></i><b>9.2.3</b> Load raw data for locations</a></li>
<li class="chapter" data-level="9.2.4" data-path="supplementary-material.html"><a href="supplementary-material.html#get-proportional-obs-counts-in-20km-cells"><i class="fa fa-check"></i><b>9.2.4</b> Get proportional obs counts in 20km cells</a></li>
<li class="chapter" data-level="9.2.5" data-path="supplementary-material.html"><a href="supplementary-material.html#plot-maps"><i class="fa fa-check"></i><b>9.2.5</b> Plot maps</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="supplementary-material.html"><a href="supplementary-material.html#climate-in-relation-to-elevation"><i class="fa fa-check"></i><b>9.3</b> Climate in relation to elevation</a><ul>
<li class="chapter" data-level="9.3.1" data-path="supplementary-material.html"><a href="supplementary-material.html#prepare-libraries-6"><i class="fa fa-check"></i><b>9.3.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="9.3.2" data-path="supplementary-material.html"><a href="supplementary-material.html#plot-climatic-variables-over-elevation"><i class="fa fa-check"></i><b>9.3.2</b> Plot climatic variables over elevation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="supplementary-material.html"><a href="supplementary-material.html#landcover-in-relation-to-elevation"><i class="fa fa-check"></i><b>9.4</b> Landcover in relation to elevation</a><ul>
<li class="chapter" data-level="9.4.1" data-path="supplementary-material.html"><a href="supplementary-material.html#get-data-from-landscape-rasters"><i class="fa fa-check"></i><b>9.4.1</b> Get data from landscape rasters</a></li>
<li class="chapter" data-level="9.4.2" data-path="supplementary-material.html"><a href="supplementary-material.html#plot-proportional-landcover-in-elevation"><i class="fa fa-check"></i><b>9.4.2</b> Plot proportional landcover in elevation</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="supplementary-material.html"><a href="supplementary-material.html#climate-in-relation-to-landcover"><i class="fa fa-check"></i><b>9.5</b> Climate in relation to landcover</a><ul>
<li class="chapter" data-level="9.5.1" data-path="supplementary-material.html"><a href="supplementary-material.html#prepare-libraries-7"><i class="fa fa-check"></i><b>9.5.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="9.5.2" data-path="supplementary-material.html"><a href="supplementary-material.html#plot-climatic-variables-over-landcover"><i class="fa fa-check"></i><b>9.5.2</b> Plot climatic variables over landcover</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="supplementary-material.html"><a href="supplementary-material.html#obsever-expertise-in-time-and-space"><i class="fa fa-check"></i><b>9.6</b> Obsever expertise in time and space</a><ul>
<li class="chapter" data-level="9.6.1" data-path="supplementary-material.html"><a href="supplementary-material.html#prepare-libraries-8"><i class="fa fa-check"></i><b>9.6.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="9.6.2" data-path="supplementary-material.html"><a href="supplementary-material.html#species-seen-in-relation-to-osberver-expertise"><i class="fa fa-check"></i><b>9.6.2</b> Species seen in relation to osberver expertise</a></li>
<li class="chapter" data-level="9.6.3" data-path="supplementary-material.html"><a href="supplementary-material.html#expertise-in-relation-to-landcover"><i class="fa fa-check"></i><b>9.6.3</b> Expertise in relation to landcover</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="supplementary-material.html"><a href="supplementary-material.html#spatial-autocorrelation-in-climatic-predictors"><i class="fa fa-check"></i><b>9.7</b> Spatial autocorrelation in climatic predictors</a><ul>
<li class="chapter" data-level="9.7.1" data-path="supplementary-material.html"><a href="supplementary-material.html#load-libs-and-prep-data"><i class="fa fa-check"></i><b>9.7.1</b> Load libs and prep data</a></li>
<li class="chapter" data-level="9.7.2" data-path="supplementary-material.html"><a href="supplementary-material.html#calculate-variograms"><i class="fa fa-check"></i><b>9.7.2</b> Calculate variograms</a></li>
<li class="chapter" data-level="9.7.3" data-path="supplementary-material.html"><a href="supplementary-material.html#plot-chelsa-data-and-variograms"><i class="fa fa-check"></i><b>9.7.3</b> Plot CHELSA data and variograms</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="supplementary-material.html"><a href="supplementary-material.html#climatic-raster-resampling"><i class="fa fa-check"></i><b>9.8</b> Climatic raster resampling</a><ul>
<li class="chapter" data-level="9.8.1" data-path="supplementary-material.html"><a href="supplementary-material.html#prepare-landcover-1"><i class="fa fa-check"></i><b>9.8.1</b> Prepare landcover</a></li>
<li class="chapter" data-level="9.8.2" data-path="supplementary-material.html"><a href="supplementary-material.html#prepare-spatial-extent-1"><i class="fa fa-check"></i><b>9.8.2</b> Prepare spatial extent</a></li>
<li class="chapter" data-level="9.8.3" data-path="supplementary-material.html"><a href="supplementary-material.html#prepare-chelsa-rasters-1"><i class="fa fa-check"></i><b>9.8.3</b> Prepare CHELSA rasters</a></li>
<li class="chapter" data-level="9.8.4" data-path="supplementary-material.html"><a href="supplementary-material.html#resample-prepared-rasters"><i class="fa fa-check"></i><b>9.8.4</b> Resample prepared rasters</a></li>
</ul></li>
<li class="chapter" data-level="9.9" data-path="supplementary-material.html"><a href="supplementary-material.html#matching-effort-with-spatial-independence"><i class="fa fa-check"></i><b>9.9</b> Matching effort with spatial independence</a><ul>
<li class="chapter" data-level="9.9.1" data-path="supplementary-material.html"><a href="supplementary-material.html#load-librarires"><i class="fa fa-check"></i><b>9.9.1</b> Load librarires</a></li>
<li class="chapter" data-level="9.9.2" data-path="supplementary-material.html"><a href="supplementary-material.html#load-data"><i class="fa fa-check"></i><b>9.9.2</b> Load data</a></li>
<li class="chapter" data-level="9.9.3" data-path="supplementary-material.html"><a href="supplementary-material.html#plot-distance-exclusion-effect"><i class="fa fa-check"></i><b>9.9.3</b> Plot distance exclusion effect</a></li>
</ul></li>
<li class="chapter" data-level="9.10" data-path="supplementary-material.html"><a href="supplementary-material.html#spatial-thinning-a-comparison-of-approaches"><i class="fa fa-check"></i><b>9.10</b> Spatial thinning: A comparison of approaches</a><ul>
<li class="chapter" data-level="9.10.1" data-path="supplementary-material.html"><a href="supplementary-material.html#prepare-libraries-9"><i class="fa fa-check"></i><b>9.10.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="9.10.2" data-path="supplementary-material.html"><a href="supplementary-material.html#traditional-grid-based-thinning"><i class="fa fa-check"></i><b>9.10.2</b> Traditional grid-based thinning</a></li>
<li class="chapter" data-level="9.10.3" data-path="supplementary-material.html"><a href="supplementary-material.html#network-based-thinning"><i class="fa fa-check"></i><b>9.10.3</b> Network-based thinning</a></li>
<li class="chapter" data-level="9.10.4" data-path="supplementary-material.html"><a href="supplementary-material.html#measuring-method-fallibility"><i class="fa fa-check"></i><b>9.10.4</b> Measuring method fallibility</a></li>
<li class="chapter" data-level="9.10.5" data-path="supplementary-material.html"><a href="supplementary-material.html#plot-metrics-for-different-methods"><i class="fa fa-check"></i><b>9.10.5</b> Plot metrics for different methods</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Influence of land cover and climate on the occupancy of avian distributions along a tropical montane gradient</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="supplementary-material" class="section level1">
<h1><span class="header-section-number">Section 9</span> Supplementary material</h1>
<div id="distance-to-roads" class="section level2">
<h2><span class="header-section-number">9.1</span> Distance to roads</h2>
<div id="prepare-libraries-4" class="section level3">
<h3><span class="header-section-number">9.1.1</span> Prepare libraries</h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="co"># load libraries</span></a>
<a class="sourceLine" id="cb66-2" data-line-number="2"><span class="kw">library</span>(reticulate)</a>
<a class="sourceLine" id="cb66-3" data-line-number="3"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb66-4" data-line-number="4"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb66-5" data-line-number="5"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb66-6" data-line-number="6"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb66-7" data-line-number="7"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb66-8" data-line-number="8"></a>
<a class="sourceLine" id="cb66-9" data-line-number="9"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb66-10" data-line-number="10"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb66-11" data-line-number="11"><span class="kw">library</span>(ggspatial)</a>
<a class="sourceLine" id="cb66-12" data-line-number="12"><span class="kw">library</span>(scico)</a>
<a class="sourceLine" id="cb66-13" data-line-number="13"></a>
<a class="sourceLine" id="cb66-14" data-line-number="14"><span class="co"># round any function</span></a>
<a class="sourceLine" id="cb66-15" data-line-number="15">round_any &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">accuracy =</span> <span class="dv">20000</span>){<span class="kw">round</span>(x<span class="op">/</span>accuracy)<span class="op">*</span>accuracy}</a>
<a class="sourceLine" id="cb66-16" data-line-number="16"><span class="co"># ci function</span></a>
<a class="sourceLine" id="cb66-17" data-line-number="17">ci &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="kw">sd</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">length</span>(x))}</a>
<a class="sourceLine" id="cb66-18" data-line-number="18"></a>
<a class="sourceLine" id="cb66-19" data-line-number="19"><span class="co"># set python path</span></a>
<a class="sourceLine" id="cb66-20" data-line-number="20"><span class="kw">use_python</span>(<span class="st">&quot;/usr/bin/python3&quot;</span>)</a></code></pre></div>
<p>Importing python libraries.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb67-1" data-line-number="1"><span class="co"># import classic python libs</span></a>
<a class="sourceLine" id="cb67-2" data-line-number="2"><span class="im">import</span> itertools</a>
<a class="sourceLine" id="cb67-3" data-line-number="3"><span class="im">from</span> operator <span class="im">import</span> itemgetter</a>
<a class="sourceLine" id="cb67-4" data-line-number="4"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb67-5" data-line-number="5"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
<a class="sourceLine" id="cb67-6" data-line-number="6"><span class="im">import</span> math</a>
<a class="sourceLine" id="cb67-7" data-line-number="7"></a>
<a class="sourceLine" id="cb67-8" data-line-number="8"><span class="co"># libs for dataframes</span></a>
<a class="sourceLine" id="cb67-9" data-line-number="9"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb67-10" data-line-number="10"></a>
<a class="sourceLine" id="cb67-11" data-line-number="11"><span class="co"># import libs for geodata</span></a>
<a class="sourceLine" id="cb67-12" data-line-number="12"><span class="im">from</span> shapely.ops <span class="im">import</span> nearest_points</a>
<a class="sourceLine" id="cb67-13" data-line-number="13"><span class="im">import</span> geopandas <span class="im">as</span> gpd</a>
<a class="sourceLine" id="cb67-14" data-line-number="14"><span class="im">import</span> rasterio</a>
<a class="sourceLine" id="cb67-15" data-line-number="15"></a>
<a class="sourceLine" id="cb67-16" data-line-number="16"><span class="co"># import ckdtree</span></a>
<a class="sourceLine" id="cb67-17" data-line-number="17"><span class="im">from</span> scipy.spatial <span class="im">import</span> cKDTree</a>
<a class="sourceLine" id="cb67-18" data-line-number="18"><span class="im">from</span> shapely.geometry <span class="im">import</span> Point, MultiPoint, LineString, MultiLineString</a></code></pre></div>
</div>
<div id="prepare-data-for-processing" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Prepare data for processing</h3>
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="co"># read in roads shapefile</span></a>
<a class="sourceLine" id="cb68-2" data-line-number="2">roads <span class="op">=</span> gpd.read_file(<span class="st">&quot;data/spatial/roads_studysite_2019/roads_studysite_2019.shp&quot;</span>)</a>
<a class="sourceLine" id="cb68-3" data-line-number="3">roads.head()</a>
<a class="sourceLine" id="cb68-4" data-line-number="4"></a>
<a class="sourceLine" id="cb68-5" data-line-number="5"><span class="co"># read in checklist covariates for conversion to gpd</span></a>
<a class="sourceLine" id="cb68-6" data-line-number="6"><span class="co"># get unique coordinates, assign them to the df</span></a>
<a class="sourceLine" id="cb68-7" data-line-number="7"><span class="co"># convert df to geo-df</span></a>
<a class="sourceLine" id="cb68-8" data-line-number="8">chkCovars <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/eBirdChecklistVars.csv&quot;</span>)</a>
<a class="sourceLine" id="cb68-9" data-line-number="9">unique_locs <span class="op">=</span> chkCovars.drop_duplicates(subset<span class="op">=</span>[<span class="st">&#39;longitude&#39;</span>,<span class="st">&#39;latitude&#39;</span>])[[<span class="st">&#39;longitude&#39;</span>, <span class="st">&#39;latitude&#39;</span>]]</a>
<a class="sourceLine" id="cb68-10" data-line-number="10">unique_locs[<span class="st">&#39;coordId&#39;</span>] <span class="op">=</span> np.arange(<span class="dv">1</span>, unique_locs.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb68-11" data-line-number="11">chkCovars <span class="op">=</span> chkCovars.merge(unique_locs, on<span class="op">=</span>[<span class="st">&#39;longitude&#39;</span>, <span class="st">&#39;latitude&#39;</span>])</a>
<a class="sourceLine" id="cb68-12" data-line-number="12"></a>
<a class="sourceLine" id="cb68-13" data-line-number="13">unique_locs <span class="op">=</span> gpd.GeoDataFrame(</a>
<a class="sourceLine" id="cb68-14" data-line-number="14">unique_locs,</a>
<a class="sourceLine" id="cb68-15" data-line-number="15">geometry<span class="op">=</span>gpd.points_from_xy(unique_locs.longitude, unique_locs.latitude))</a>
<a class="sourceLine" id="cb68-16" data-line-number="16">unique_locs.crs <span class="op">=</span> {<span class="st">&#39;init&#39;</span> :<span class="st">&#39;epsg:4326&#39;</span>}</a>
<a class="sourceLine" id="cb68-17" data-line-number="17"></a>
<a class="sourceLine" id="cb68-18" data-line-number="18"><span class="co"># reproject spatials to 43n epsg 32643</span></a>
<a class="sourceLine" id="cb68-19" data-line-number="19"></a>
<a class="sourceLine" id="cb68-20" data-line-number="20">roads <span class="op">=</span> roads.to_crs({<span class="st">&#39;init&#39;</span>: <span class="st">&#39;epsg:32643&#39;</span>})</a>
<a class="sourceLine" id="cb68-21" data-line-number="21">unique_locs <span class="op">=</span> unique_locs.to_crs({<span class="st">&#39;init&#39;</span>: <span class="st">&#39;epsg:32643&#39;</span>})</a>
<a class="sourceLine" id="cb68-22" data-line-number="22"></a>
<a class="sourceLine" id="cb68-23" data-line-number="23"></a>
<a class="sourceLine" id="cb68-24" data-line-number="24"><span class="co"># function to simplify multilinestrings</span></a>
<a class="sourceLine" id="cb68-25" data-line-number="25"><span class="kw">def</span> simplify_roads(complex_roads):</a>
<a class="sourceLine" id="cb68-26" data-line-number="26">    simpleRoads <span class="op">=</span> []</a>
<a class="sourceLine" id="cb68-27" data-line-number="27">    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(complex_roads.geometry)):</a>
<a class="sourceLine" id="cb68-28" data-line-number="28">        feature <span class="op">=</span> complex_roads.geometry.iloc[i]</a>
<a class="sourceLine" id="cb68-29" data-line-number="29">        <span class="cf">if</span> feature.geom_type <span class="op">==</span> <span class="st">&quot;LineString&quot;</span>:</a>
<a class="sourceLine" id="cb68-30" data-line-number="30">            simpleRoads.append(feature)</a>
<a class="sourceLine" id="cb68-31" data-line-number="31">        <span class="cf">elif</span> feature.geom_type <span class="op">==</span> <span class="st">&quot;MultiLineString&quot;</span>:</a>
<a class="sourceLine" id="cb68-32" data-line-number="32">            <span class="cf">for</span> road_level2 <span class="kw">in</span> feature:</a>
<a class="sourceLine" id="cb68-33" data-line-number="33">                simpleRoads.append(road_level2)</a>
<a class="sourceLine" id="cb68-34" data-line-number="34">    <span class="cf">return</span> simpleRoads</a>
<a class="sourceLine" id="cb68-35" data-line-number="35"></a>
<a class="sourceLine" id="cb68-36" data-line-number="36"></a>
<a class="sourceLine" id="cb68-37" data-line-number="37"><span class="co"># function to use ckdtrees for nearest point finding</span></a>
<a class="sourceLine" id="cb68-38" data-line-number="38"><span class="kw">def</span> ckdnearest(gdfA, gdfB):</a>
<a class="sourceLine" id="cb68-39" data-line-number="39">    A <span class="op">=</span> np.concatenate(</a>
<a class="sourceLine" id="cb68-40" data-line-number="40">    [np.array(geom.coords) <span class="cf">for</span> geom <span class="kw">in</span> gdfA.geometry.to_list()])</a>
<a class="sourceLine" id="cb68-41" data-line-number="41">    simplified_features <span class="op">=</span> simplify_roads(gdfB)</a>
<a class="sourceLine" id="cb68-42" data-line-number="42">    B <span class="op">=</span> [np.array(geom.coords) <span class="cf">for</span> geom <span class="kw">in</span> simplified_features]</a>
<a class="sourceLine" id="cb68-43" data-line-number="43">    B <span class="op">=</span> np.concatenate(B)</a>
<a class="sourceLine" id="cb68-44" data-line-number="44">    ckd_tree <span class="op">=</span> cKDTree(B)</a>
<a class="sourceLine" id="cb68-45" data-line-number="45">    dist, idx <span class="op">=</span> ckd_tree.query(A, k<span class="op">=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb68-46" data-line-number="46">    <span class="cf">return</span> dist</a>
<a class="sourceLine" id="cb68-47" data-line-number="47"></a>
<a class="sourceLine" id="cb68-48" data-line-number="48"></a>
<a class="sourceLine" id="cb68-49" data-line-number="49"><span class="co"># function to use ckdtrees for nearest point finding</span></a>
<a class="sourceLine" id="cb68-50" data-line-number="50"><span class="kw">def</span> ckdnearest_point(gdfA, gdfB):</a>
<a class="sourceLine" id="cb68-51" data-line-number="51">    A <span class="op">=</span> np.concatenate(</a>
<a class="sourceLine" id="cb68-52" data-line-number="52">    [np.array(geom.coords) <span class="cf">for</span> geom <span class="kw">in</span> gdfA.geometry.to_list()])</a>
<a class="sourceLine" id="cb68-53" data-line-number="53">    <span class="co">#simplified_features = simplify_roads(gdfB)</span></a>
<a class="sourceLine" id="cb68-54" data-line-number="54">    B <span class="op">=</span> np.concatenate(</a>
<a class="sourceLine" id="cb68-55" data-line-number="55">    [np.array(geom.coords) <span class="cf">for</span> geom <span class="kw">in</span> gdfB.geometry.to_list()])</a>
<a class="sourceLine" id="cb68-56" data-line-number="56">    <span class="co">#B = np.concatenate(B)</span></a>
<a class="sourceLine" id="cb68-57" data-line-number="57">    ckd_tree <span class="op">=</span> cKDTree(B)</a>
<a class="sourceLine" id="cb68-58" data-line-number="58">    dist, idx <span class="op">=</span> ckd_tree.query(A, k<span class="op">=</span>[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb68-59" data-line-number="59">    <span class="cf">return</span> dist</a>
<a class="sourceLine" id="cb68-60" data-line-number="60"></a>
<a class="sourceLine" id="cb68-61" data-line-number="61"></a>
<a class="sourceLine" id="cb68-62" data-line-number="62"><span class="co"># get distance to nearest road</span></a>
<a class="sourceLine" id="cb68-63" data-line-number="63">unique_locs[<span class="st">&#39;dist_road&#39;</span>] <span class="op">=</span> ckdnearest(unique_locs, roads)</a>
<a class="sourceLine" id="cb68-64" data-line-number="64"></a>
<a class="sourceLine" id="cb68-65" data-line-number="65"><span class="co"># get distance to nearest other site</span></a>
<a class="sourceLine" id="cb68-66" data-line-number="66">unique_locs[<span class="st">&#39;nnb&#39;</span>] <span class="op">=</span> ckdnearest_point(unique_locs, unique_locs)</a>
<a class="sourceLine" id="cb68-67" data-line-number="67"></a>
<a class="sourceLine" id="cb68-68" data-line-number="68"><span class="co"># write to file</span></a>
<a class="sourceLine" id="cb68-69" data-line-number="69">unique_locs <span class="op">=</span> pd.DataFrame(unique_locs.drop(columns<span class="op">=</span><span class="st">&#39;geometry&#39;</span>))</a>
<a class="sourceLine" id="cb68-70" data-line-number="70">unique_locs[<span class="st">&#39;dist_road&#39;</span>] <span class="op">=</span> unique_locs[<span class="st">&#39;dist_road&#39;</span>]</a>
<a class="sourceLine" id="cb68-71" data-line-number="71">unique_locs[<span class="st">&#39;nnb&#39;</span>] <span class="op">=</span> unique_locs[<span class="st">&#39;nnb&#39;</span>]</a>
<a class="sourceLine" id="cb68-72" data-line-number="72">unique_locs.to_csv(path_or_buf<span class="op">=</span><span class="st">&quot;data/locs_dist_to_road.csv&quot;</span>, index<span class="op">=</span><span class="va">False</span>)</a>
<a class="sourceLine" id="cb68-73" data-line-number="73"></a>
<a class="sourceLine" id="cb68-74" data-line-number="74"><span class="co"># merge unique locs with chkCovars</span></a>
<a class="sourceLine" id="cb68-75" data-line-number="75">chkCovars <span class="op">=</span> chkCovars.merge(unique_locs, on<span class="op">=</span>[<span class="st">&#39;latitude&#39;</span>, <span class="st">&#39;longitude&#39;</span>, <span class="st">&#39;coordId&#39;</span>])</a></code></pre></div>
</div>
<div id="species-specific-nearest-sites" class="section level3">
<h3><span class="header-section-number">9.1.3</span> Species specific nearest sites</h3>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="co"># load data and send to python</span></a>
<a class="sourceLine" id="cb69-2" data-line-number="2"><span class="kw">load</span>(<span class="st">&quot;data_prelim_processing.rdata&quot;</span>)</a>
<a class="sourceLine" id="cb69-3" data-line-number="3">py<span class="op">$</span>data &lt;-<span class="st"> </span>dataGrouped</a></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="co"># split data by species</span></a>
<a class="sourceLine" id="cb70-2" data-line-number="2">datalist <span class="op">=</span> [pd.DataFrame(y) <span class="cf">for</span> x, y <span class="kw">in</span> data.groupby(<span class="st">&#39;scientific_name&#39;</span>, as_index<span class="op">=</span><span class="va">False</span>)]</a>
<a class="sourceLine" id="cb70-3" data-line-number="3"></a>
<a class="sourceLine" id="cb70-4" data-line-number="4"></a>
<a class="sourceLine" id="cb70-5" data-line-number="5"><span class="co"># function to get unique vals anc convert to gpd</span></a>
<a class="sourceLine" id="cb70-6" data-line-number="6"><span class="kw">def</span> convData(somedata):</a>
<a class="sourceLine" id="cb70-7" data-line-number="7">    somedata <span class="op">=</span> somedata.drop_duplicates(subset<span class="op">=</span>[<span class="st">&#39;longitude&#39;</span>,<span class="st">&#39;latitude&#39;</span>])[[<span class="st">&#39;longitude&#39;</span>, <span class="st">&#39;latitude&#39;</span>, <span class="st">&#39;scientific_name&#39;</span>]]</a>
<a class="sourceLine" id="cb70-8" data-line-number="8">    unique_locs <span class="op">=</span> gpd.GeoDataFrame(somedata,</a>
<a class="sourceLine" id="cb70-9" data-line-number="9">                                  geometry<span class="op">=</span>gpd.points_from_xy(somedata.longitude, </a>
<a class="sourceLine" id="cb70-10" data-line-number="10">                                  somedata.latitude))</a>
<a class="sourceLine" id="cb70-11" data-line-number="11">    unique_locs.crs <span class="op">=</span> {<span class="st">&#39;init&#39;</span> :<span class="st">&#39;epsg:4326&#39;</span>}</a>
<a class="sourceLine" id="cb70-12" data-line-number="12">    unique_locs <span class="op">=</span> unique_locs.to_crs({<span class="st">&#39;init&#39;</span>: <span class="st">&#39;epsg:32643&#39;</span>})</a>
<a class="sourceLine" id="cb70-13" data-line-number="13">    dists <span class="op">=</span> ckdnearest_point(unique_locs, unique_locs)</a>
<a class="sourceLine" id="cb70-14" data-line-number="14">    unique_locs <span class="op">=</span> pd.DataFrame(unique_locs.drop(columns<span class="op">=</span><span class="st">&#39;geometry&#39;</span>))</a>
<a class="sourceLine" id="cb70-15" data-line-number="15">    unique_locs[<span class="st">&#39;nnb&#39;</span>] <span class="op">=</span> dists</a>
<a class="sourceLine" id="cb70-16" data-line-number="16">    <span class="cf">return</span> unique_locs</a>
<a class="sourceLine" id="cb70-17" data-line-number="17"></a>
<a class="sourceLine" id="cb70-18" data-line-number="18"></a>
<a class="sourceLine" id="cb70-19" data-line-number="19"><span class="co"># apply function to datalist</span></a>
<a class="sourceLine" id="cb70-20" data-line-number="20">datalist <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(convData, datalist))</a></code></pre></div>
</div>
<div id="explicit-spatial-filter" class="section level3">
<h3><span class="header-section-number">9.1.4</span> Explicit spatial filter</h3>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="co"># extract data from python</span></a>
<a class="sourceLine" id="cb71-2" data-line-number="2">chkCovars &lt;-<span class="st"> </span>py<span class="op">$</span>chkCovars</a>
<a class="sourceLine" id="cb71-3" data-line-number="3">chkCovars &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(chkCovars, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb71-4" data-line-number="4"><span class="st">  `</span><span class="dt">st_crs&lt;-</span><span class="st">`</span>(<span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb71-5" data-line-number="5"><span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">32643</span>)</a>
<a class="sourceLine" id="cb71-6" data-line-number="6"></a>
<a class="sourceLine" id="cb71-7" data-line-number="7"><span class="co"># read wg</span></a>
<a class="sourceLine" id="cb71-8" data-line-number="8">wg &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/spatial/hillsShapefile/Nil_Ana_Pal.shp&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb71-9" data-line-number="9"><span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">32643</span>)</a>
<a class="sourceLine" id="cb71-10" data-line-number="10"></a>
<a class="sourceLine" id="cb71-11" data-line-number="11"><span class="co"># spatial subset</span></a>
<a class="sourceLine" id="cb71-12" data-line-number="12">chkCovars &lt;-<span class="st"> </span>chkCovars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb71-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb71-14" data-line-number="14"><span class="st">  </span><span class="kw">filter</span>(id <span class="op">%in%</span><span class="st"> </span><span class="kw">unlist</span>(<span class="kw">st_contains</span>(wg, chkCovars)))</a></code></pre></div>
</div>
<div id="species-specific-filter" class="section level3">
<h3><span class="header-section-number">9.1.5</span> Species specific filter</h3>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="co"># extract values from python</span></a>
<a class="sourceLine" id="cb72-2" data-line-number="2">sp_spec_data &lt;-<span class="st"> </span>py<span class="op">$</span>datalist</a>
<a class="sourceLine" id="cb72-3" data-line-number="3"></a>
<a class="sourceLine" id="cb72-4" data-line-number="4">sp_spec_data &lt;-<span class="st"> </span><span class="kw">map</span>(sp_spec_data, <span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb72-5" data-line-number="5">  df &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(df) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-6" data-line-number="6"><span class="st">    </span><span class="kw">st_as_sf</span>(<span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-7" data-line-number="7"><span class="st">    `</span><span class="dt">st_crs&lt;-</span><span class="st">`</span>(<span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-8" data-line-number="8"><span class="st">    </span><span class="kw">st_transform</span>(<span class="dv">32643</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-9" data-line-number="9"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-10" data-line-number="10"><span class="st">    </span><span class="kw">filter</span>(id <span class="op">%in%</span><span class="st"> </span><span class="kw">unlist</span>(<span class="kw">st_contains</span>(wg, .))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-11" data-line-number="11"><span class="st">    </span><span class="kw">st_drop_geometry</span>()</a>
<a class="sourceLine" id="cb72-12" data-line-number="12">})</a>
<a class="sourceLine" id="cb72-13" data-line-number="13"></a>
<a class="sourceLine" id="cb72-14" data-line-number="14">sp_spec_data &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(sp_spec_data)</a></code></pre></div>
</div>
<div id="plot-histogram-distance-to-roads" class="section level3">
<h3><span class="header-section-number">9.1.6</span> Plot histogram: distance to roads</h3>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="co"># make histogram</span></a>
<a class="sourceLine" id="cb73-2" data-line-number="2">hist_roads &lt;-<span class="st"> </span><span class="kw">ggplot</span>(chkCovars)<span class="op">+</span></a>
<a class="sourceLine" id="cb73-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(dist_road <span class="op">/</span><span class="st"> </span><span class="fl">1e3</span>),</a>
<a class="sourceLine" id="cb73-4" data-line-number="4">                 <span class="dt">bins =</span> <span class="dv">20</span>, <span class="dt">size=</span><span class="fl">0.2</span>, <span class="dt">fill=</span><span class="st">&quot;steelblue&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb73-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;distance to roads (km)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;# checklists&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb73-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">label=</span><span class="kw">label_number</span>(<span class="dt">accuracy =</span> <span class="fl">0.1</span>), </a>
<a class="sourceLine" id="cb73-7" data-line-number="7">                <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb73-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">label=</span><span class="kw">label_number</span>(<span class="dt">scale=</span><span class="fl">0.001</span>, <span class="dt">accuracy =</span> <span class="dv">1</span>, <span class="dt">suffix =</span> <span class="st">&quot;K&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb73-9" data-line-number="9"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb73-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="ot">NA</span>, <span class="dt">colour =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb73-11" data-line-number="11">        <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb73-12" data-line-number="12">        <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.line =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
</div>
<div id="table-distance-to-roads" class="section level3">
<h3><span class="header-section-number">9.1.7</span> Table: Distance to roads</h3>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="co"># write the mean and ci95 to file</span></a>
<a class="sourceLine" id="cb74-2" data-line-number="2">chkCovars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb74-3" data-line-number="3"><span class="st">  </span><span class="kw">st_drop_geometry</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb74-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(dist_road, nnb) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb74-5" data-line-number="5"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">&quot;dist_road&quot;</span>, <span class="st">&quot;nnb&quot;</span>),</a>
<a class="sourceLine" id="cb74-6" data-line-number="6">                      <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb74-7" data-line-number="7"><span class="st">  </span><span class="kw">group_by</span>(variable) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb74-8" data-line-number="8"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(value), </a>
<a class="sourceLine" id="cb74-9" data-line-number="9">               <span class="kw">list</span>(<span class="op">~</span><span class="kw">mean</span>(.), <span class="op">~</span><span class="kw">sd</span>(.), <span class="op">~</span><span class="kw">min</span>(.), <span class="op">~</span><span class="kw">max</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb74-10" data-line-number="10"><span class="st">  </span><span class="kw">write_csv</span>(<span class="st">&quot;data/results/distance_roads_sites.csv&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="co"># read in and show</span></a>
<a class="sourceLine" id="cb75-2" data-line-number="2">readr<span class="op">::</span><span class="kw">read_csv</span>(<span class="st">&quot;data/results/distance_roads_sites.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb75-3" data-line-number="3"><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">min</th>
<th align="right">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dist_road</td>
<td align="right">389.7699</td>
<td align="right">859.1526</td>
<td align="right">0.2791282</td>
<td align="right">7637.243</td>
</tr>
<tr class="even">
<td align="left">nnb</td>
<td align="right">296.8934</td>
<td align="right">552.9132</td>
<td align="right">0.1367772</td>
<td align="right">12849.668</td>
</tr>
</tbody>
</table>
</div>
<div id="plot-histogram-distance-to-nearest-site" class="section level3">
<h3><span class="header-section-number">9.1.8</span> Plot histogram: distance to nearest site</h3>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="co"># get unique locations</span></a>
<a class="sourceLine" id="cb76-2" data-line-number="2">locs &lt;-<span class="st"> </span>py<span class="op">$</span>unique_locs</a>
<a class="sourceLine" id="cb76-3" data-line-number="3"></a>
<a class="sourceLine" id="cb76-4" data-line-number="4"><span class="co"># make histogram of nearest neighbours</span></a>
<a class="sourceLine" id="cb76-5" data-line-number="5">hist_sites &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb76-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(locs)<span class="op">+</span></a>
<a class="sourceLine" id="cb76-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(nnb <span class="op">/</span><span class="st"> </span><span class="fl">1e3</span>),</a>
<a class="sourceLine" id="cb76-8" data-line-number="8">                 <span class="dt">bins =</span> <span class="dv">100</span>, <span class="dt">size=</span><span class="fl">0.2</span>, <span class="dt">fill=</span><span class="st">&quot;steelblue&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb76-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;dist. nearest site (km)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;# sites&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb76-10" data-line-number="10"><span class="st">  </span><span class="co"># scale_x_log10(label=label_number(accuracy = 0.1), </span></a>
<a class="sourceLine" id="cb76-11" data-line-number="11"><span class="st">  </span><span class="co">#               breaks = c(0.1, 1, 10))+</span></a>
<a class="sourceLine" id="cb76-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb76-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">label=</span><span class="kw">label_number</span>(<span class="dt">scale=</span><span class="fl">0.001</span>, <span class="dt">accuracy =</span> <span class="dv">1</span>, <span class="dt">suffix =</span> <span class="st">&quot;K&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb76-14" data-line-number="14"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb76-15" data-line-number="15"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="ot">NA</span>, <span class="dt">colour =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb76-16" data-line-number="16">        <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb76-17" data-line-number="17">        <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.line =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
</div>
<div id="plot-species-specific-histograms-distance-to-nearest-site" class="section level3">
<h3><span class="header-section-number">9.1.9</span> Plot species specific histograms: distance to nearest site</h3>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="co"># plot histograms by species</span></a>
<a class="sourceLine" id="cb77-2" data-line-number="2">hist_sites_sp &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb77-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(sp_spec_data)<span class="op">+</span></a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(nnb <span class="op">/</span><span class="st"> </span><span class="fl">1e3</span>),</a>
<a class="sourceLine" id="cb77-5" data-line-number="5">                 <span class="dt">bins =</span> <span class="dv">100</span>, <span class="dt">size=</span><span class="fl">0.2</span>, <span class="dt">fill=</span><span class="st">&quot;steelblue&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb77-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;dist. nearest site (km)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;# sites&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb77-7" data-line-number="7"><span class="st">  </span><span class="co"># scale_x_log10(label=label_number(accuracy = 0.1), </span></a>
<a class="sourceLine" id="cb77-8" data-line-number="8"><span class="st">  </span><span class="co">#               breaks = c(0.1, 1, 10))+</span></a>
<a class="sourceLine" id="cb77-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>scientific_name)<span class="op">+</span></a>
<a class="sourceLine" id="cb77-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_x_log10</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb77-11" data-line-number="11"><span class="st">  </span><span class="co">#coord_cartesian(xlim=c(0,10))+</span></a>
<a class="sourceLine" id="cb77-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">label=</span><span class="kw">label_number</span>(<span class="dt">scale=</span><span class="fl">0.001</span>, <span class="dt">accuracy =</span> <span class="dv">1</span>, <span class="dt">suffix =</span> <span class="st">&quot;K&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb77-13" data-line-number="13"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb77-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="ot">NA</span>, <span class="dt">colour =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb77-15" data-line-number="15">        <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb77-16" data-line-number="16">        <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.line =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb77-17" data-line-number="17"></a>
<a class="sourceLine" id="cb77-18" data-line-number="18"><span class="kw">ggsave</span>(hist_sites_sp, <span class="dt">filename =</span> <span class="st">&quot;figs/fig_nnb_species.png&quot;</span>)</a></code></pre></div>
</div>
<div id="table-species-specific-nearest-site" class="section level3">
<h3><span class="header-section-number">9.1.10</span> Table: Species specific nearest site</h3>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="co"># write the mean and ci95 to file</span></a>
<a class="sourceLine" id="cb78-2" data-line-number="2">sp_spec_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb78-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(scientific_name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb78-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(nnb), </a>
<a class="sourceLine" id="cb78-5" data-line-number="5">               <span class="kw">list</span>(<span class="op">~</span><span class="kw">mean</span>(.), <span class="op">~</span><span class="kw">sd</span>(.), <span class="op">~</span><span class="kw">ci</span>(.), <span class="op">~</span><span class="kw">min</span>(.), <span class="op">~</span><span class="kw">max</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb78-6" data-line-number="6"><span class="st">  </span><span class="kw">write_csv</span>(<span class="st">&quot;data/results/dist_nnb_species_specific.csv&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="co"># show table of distance to nearest site for each species</span></a>
<a class="sourceLine" id="cb79-2" data-line-number="2">readr<span class="op">::</span><span class="kw">read_csv</span>(<span class="st">&quot;data/results/dist_nnb_species_specific.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb79-3" data-line-number="3"><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">scientific_name</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">ci</th>
<th align="right">min</th>
<th align="right">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alcippe poioicephala</td>
<td align="right">416.7076</td>
<td align="right">808.0633</td>
<td align="right">25.00732</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Carpodacus erythrinus</td>
<td align="right">416.3566</td>
<td align="right">807.9932</td>
<td align="right">25.00515</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Centropus sinensis</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Chalcophaps indica</td>
<td align="right">416.6251</td>
<td align="right">807.9633</td>
<td align="right">25.00111</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Chloropsis aurifrons</td>
<td align="right">417.2270</td>
<td align="right">808.7698</td>
<td align="right">25.02918</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Chrysocolaptes guttacristatus</td>
<td align="right">416.6501</td>
<td align="right">808.0689</td>
<td align="right">25.00749</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Cinnyris asiaticus</td>
<td align="right">416.7731</td>
<td align="right">808.1539</td>
<td align="right">25.01324</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Copsychus fulicatus</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Copsychus saularis</td>
<td align="right">416.6281</td>
<td align="right">808.0744</td>
<td align="right">25.00766</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Culicicapa ceylonensis</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Cyornis tickelliae</td>
<td align="right">416.7184</td>
<td align="right">808.1772</td>
<td align="right">25.01396</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Dicaeum erythrorhynchos</td>
<td align="right">416.4383</td>
<td align="right">807.8246</td>
<td align="right">24.99370</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Eumyias albicaudatus</td>
<td align="right">416.5625</td>
<td align="right">808.0762</td>
<td align="right">25.00772</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Hierococcyx varius</td>
<td align="right">416.5075</td>
<td align="right">807.9157</td>
<td align="right">24.99964</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Hypsipetes ganeesa</td>
<td align="right">416.9883</td>
<td align="right">808.1900</td>
<td align="right">25.01436</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Iole indica</td>
<td align="right">417.5128</td>
<td align="right">809.7107</td>
<td align="right">25.05830</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Irena puella</td>
<td align="right">416.7806</td>
<td align="right">808.0570</td>
<td align="right">25.00712</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Lanius schach</td>
<td align="right">416.9222</td>
<td align="right">808.0495</td>
<td align="right">25.00689</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Leptocoma minima</td>
<td align="right">416.7510</td>
<td align="right">808.1632</td>
<td align="right">25.01353</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Leptocoma zeylonica</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Motacilla maderaspatensis</td>
<td align="right">416.7644</td>
<td align="right">808.1430</td>
<td align="right">25.01290</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Myophonus horsfieldii</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Orthotomus sutorius</td>
<td align="right">416.7268</td>
<td align="right">808.1720</td>
<td align="right">25.01380</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Parus cinereus</td>
<td align="right">416.7780</td>
<td align="right">808.1521</td>
<td align="right">25.01319</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Passer domesticus</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Pellorneum ruficeps</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Pericrocotus cinnamomeus</td>
<td align="right">416.7935</td>
<td align="right">808.1474</td>
<td align="right">25.01304</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Pericrocotus flammeus</td>
<td align="right">416.7258</td>
<td align="right">808.1102</td>
<td align="right">25.01189</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Picus xanthopygaeus</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Pomatorhinus horsfieldii</td>
<td align="right">416.8663</td>
<td align="right">808.1413</td>
<td align="right">25.01285</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Psilopogon viridis</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Psittacula columboides</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Psittacula cyanocephala</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Pycnonotus cafer</td>
<td align="right">416.9760</td>
<td align="right">807.9851</td>
<td align="right">25.00490</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Pycnonotus jocosus</td>
<td align="right">416.7780</td>
<td align="right">808.1521</td>
<td align="right">25.01319</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Saxicola caprata</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Sitta frontalis</td>
<td align="right">417.1803</td>
<td align="right">808.0823</td>
<td align="right">25.00479</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Streptopelia chinensis</td>
<td align="right">416.7387</td>
<td align="right">808.1661</td>
<td align="right">25.01362</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Turdoides striata</td>
<td align="right">418.0558</td>
<td align="right">810.0605</td>
<td align="right">25.06913</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Turdus simillimus</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="odd">
<td align="left">Upupa epops</td>
<td align="right">416.8469</td>
<td align="right">808.2412</td>
<td align="right">25.01906</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
<tr class="even">
<td align="left">Zosterops palpebrosus</td>
<td align="right">416.7707</td>
<td align="right">808.1456</td>
<td align="right">25.01298</td>
<td align="right">0.1367772</td>
<td align="right">16460.7</td>
</tr>
</tbody>
</table>
<p>Histograms showing the species-specific distances to nearest neighbouring site.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_nnb_species.png&quot;</span>)</a></code></pre></div>
<p><img src="figs/fig_nnb_species.png" /><!-- --></p>
</div>
<div id="plot-map-points-on-roads" class="section level3">
<h3><span class="header-section-number">9.1.11</span> Plot map: points on roads</h3>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1">roads &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/spatial/roads_studysite_2019/roads_studysite_2019.shp&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-2" data-line-number="2"><span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">32643</span>)</a>
<a class="sourceLine" id="cb81-3" data-line-number="3">points &lt;-<span class="st"> </span>chkCovars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-4" data-line-number="4"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">as_tibble</span>(<span class="kw">st_coordinates</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-5" data-line-number="5"><span class="st">  </span><span class="kw">st_drop_geometry</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">X =</span> <span class="kw">round_any</span>(X, <span class="dv">2500</span>), <span class="dt">Y =</span> <span class="kw">round_any</span>(Y, <span class="dv">2500</span>))</a>
<a class="sourceLine" id="cb81-7" data-line-number="7"></a>
<a class="sourceLine" id="cb81-8" data-line-number="8">points &lt;-<span class="st"> </span><span class="kw">count</span>(points, X,Y)</a>
<a class="sourceLine" id="cb81-9" data-line-number="9"></a>
<a class="sourceLine" id="cb81-10" data-line-number="10"><span class="co"># add land</span></a>
<a class="sourceLine" id="cb81-11" data-line-number="11"><span class="kw">library</span>(rnaturalearth)</a>
<a class="sourceLine" id="cb81-12" data-line-number="12">land &lt;-<span class="st"> </span><span class="kw">ne_countries</span>(<span class="dt">scale =</span> <span class="dv">50</span>, <span class="dt">type =</span> <span class="st">&quot;countries&quot;</span>, <span class="dt">continent =</span> <span class="st">&quot;asia&quot;</span>,</a>
<a class="sourceLine" id="cb81-13" data-line-number="13">                     <span class="dt">country =</span> <span class="st">&quot;india&quot;</span>,</a>
<a class="sourceLine" id="cb81-14" data-line-number="14">                     <span class="dt">returnclass =</span> <span class="kw">c</span>(<span class="st">&quot;sf&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-15" data-line-number="15"><span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">32643</span>)</a>
<a class="sourceLine" id="cb81-16" data-line-number="16"></a>
<a class="sourceLine" id="cb81-17" data-line-number="17">bbox &lt;-<span class="st"> </span><span class="kw">st_bbox</span>(wg)</a></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1"><span class="co"># plot on maps</span></a>
<a class="sourceLine" id="cb82-2" data-line-number="2"><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb82-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> land, <span class="dt">fill =</span> <span class="st">&quot;grey90&quot;</span>, <span class="dt">col =</span> <span class="ot">NA</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb82-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> wg, <span class="dt">fill=</span> <span class="ot">NA</span>, <span class="dt">col =</span> <span class="dv">1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb82-5" data-line-number="5"><span class="st">  </span><span class="kw">annotation_custom</span>(<span class="dt">grob =</span> hist_roads <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplotGrob</span>(),</a>
<a class="sourceLine" id="cb82-6" data-line-number="6">                    <span class="dt">xmin =</span> bbox[<span class="st">&quot;xmax&quot;</span>] <span class="op">-</span><span class="st"> </span>(bbox[<span class="st">&quot;xmax&quot;</span>] <span class="op">-</span><span class="st"> </span>bbox[<span class="st">&quot;xmin&quot;</span>])<span class="op">/</span><span class="fl">2.5</span>, </a>
<a class="sourceLine" id="cb82-7" data-line-number="7">                    <span class="dt">xmax =</span> bbox[<span class="st">&quot;xmax&quot;</span>], </a>
<a class="sourceLine" id="cb82-8" data-line-number="8">                    <span class="dt">ymin =</span> bbox[<span class="st">&quot;ymax&quot;</span>] <span class="op">-</span><span class="st"> </span>(bbox[<span class="st">&quot;ymax&quot;</span>] <span class="op">-</span><span class="st"> </span>bbox[<span class="st">&quot;ymin&quot;</span>])<span class="op">/</span><span class="dv">3</span>, </a>
<a class="sourceLine" id="cb82-9" data-line-number="9">                    <span class="dt">ymax =</span> bbox[<span class="st">&quot;ymax&quot;</span>])<span class="op">+</span></a>
<a class="sourceLine" id="cb82-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">data=</span>points, <span class="kw">aes</span>(X,Y,<span class="dt">fill=</span>n), <span class="dt">col =</span> <span class="st">&quot;grey90&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb82-11" data-line-number="11"><span class="st">  </span></a>
<a class="sourceLine" id="cb82-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>roads, <span class="dt">size=</span><span class="fl">0.2</span>, <span class="dt">col=</span><span class="st">&quot;steelblue&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb82-13" data-line-number="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb82-14" data-line-number="14"><span class="st">  </span><span class="co"># scale_colour_manual(values = &quot;steelblue&quot;, labels = &quot;roads&quot;)+</span></a>
<a class="sourceLine" id="cb82-15" data-line-number="15"><span class="st">  </span></a>
<a class="sourceLine" id="cb82-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_fill_scico</span>(<span class="dt">trans =</span> <span class="st">&quot;log10&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;lajolla&quot;</span>, <span class="dt">values=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb82-17" data-line-number="17"><span class="st">  </span><span class="kw">annotation_north_arrow</span>(<span class="dt">location =</span> <span class="st">&quot;br&quot;</span>, <span class="dt">which_north =</span> <span class="st">&quot;true&quot;</span>, </a>
<a class="sourceLine" id="cb82-18" data-line-number="18">                         <span class="dt">pad_x =</span> <span class="kw">unit</span>(<span class="fl">0.1</span>, <span class="st">&quot;in&quot;</span>), <span class="dt">pad_y =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;in&quot;</span>),</a>
<a class="sourceLine" id="cb82-19" data-line-number="19">                         <span class="dt">style =</span> north_arrow_fancy_orienteering) <span class="op">+</span></a>
<a class="sourceLine" id="cb82-20" data-line-number="20"><span class="st">  </span><span class="kw">annotation_scale</span>(<span class="dt">location =</span> <span class="st">&quot;br&quot;</span>, <span class="dt">width_hint =</span> <span class="fl">0.4</span>, <span class="dt">text_cex =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb82-21" data-line-number="21"><span class="st">  </span></a>
<a class="sourceLine" id="cb82-22" data-line-number="22"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb82-23" data-line-number="23"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.9</span>,<span class="fl">0.55</span>),</a>
<a class="sourceLine" id="cb82-24" data-line-number="24">        <span class="dt">legend.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb82-25" data-line-number="25">        <span class="dt">legend.key =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="st">&quot;grey90&quot;</span>),</a>
<a class="sourceLine" id="cb82-26" data-line-number="26">        <span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb82-27" data-line-number="27">        <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb82-28" data-line-number="28"><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">expand =</span> <span class="ot">FALSE</span>, <span class="dt">xlim =</span> bbox[<span class="kw">c</span>(<span class="st">&quot;xmin&quot;</span>, <span class="st">&quot;xmax&quot;</span>)], <span class="dt">ylim =</span> bbox[<span class="kw">c</span>(<span class="st">&quot;ymin&quot;</span>, <span class="st">&quot;ymax&quot;</span>)])<span class="op">+</span></a>
<a class="sourceLine" id="cb82-29" data-line-number="29"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;checklists&quot;</span>, <span class="dt">colour=</span><span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb82-30" data-line-number="30"></a>
<a class="sourceLine" id="cb82-31" data-line-number="31"><span class="co"># save figure</span></a>
<a class="sourceLine" id="cb82-32" data-line-number="32"><span class="kw">ggsave</span>(<span class="dt">filename =</span> <span class="st">&quot;figs/fig_distRoads.png&quot;</span>, <span class="dt">device =</span> <span class="kw">png</span>())</a>
<a class="sourceLine" id="cb82-33" data-line-number="33"><span class="kw">dev.off</span>()</a></code></pre></div>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="co"># transform points to utm</span></a>
<a class="sourceLine" id="cb83-2" data-line-number="2">locs &lt;-<span class="st"> </span>locs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb83-3" data-line-number="3"><span class="st">  </span><span class="kw">st_as_sf</span>(<span class="dt">coords=</span><span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb83-4" data-line-number="4"><span class="st">  `</span><span class="dt">st_crs&lt;-</span><span class="st">`</span>(<span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb83-5" data-line-number="5"><span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">32643</span>)</a>
<a class="sourceLine" id="cb83-6" data-line-number="6"></a>
<a class="sourceLine" id="cb83-7" data-line-number="7"><span class="co"># add nnb to locations</span></a>
<a class="sourceLine" id="cb83-8" data-line-number="8"><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb83-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> land, <span class="dt">fill =</span> <span class="st">&quot;grey90&quot;</span>, <span class="dt">col =</span> <span class="ot">NA</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb83-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> wg, <span class="dt">fill=</span> <span class="ot">NA</span>, <span class="dt">col =</span> <span class="dv">1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb83-11" data-line-number="11"><span class="st">  </span><span class="kw">annotation_custom</span>(<span class="dt">grob =</span> hist_sites <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplotGrob</span>(),</a>
<a class="sourceLine" id="cb83-12" data-line-number="12">                    <span class="dt">xmin =</span> bbox[<span class="st">&quot;xmax&quot;</span>] <span class="op">-</span><span class="st"> </span>(bbox[<span class="st">&quot;xmax&quot;</span>] <span class="op">-</span><span class="st"> </span>bbox[<span class="st">&quot;xmin&quot;</span>])<span class="op">/</span><span class="fl">2.5</span>, </a>
<a class="sourceLine" id="cb83-13" data-line-number="13">                    <span class="dt">xmax =</span> bbox[<span class="st">&quot;xmax&quot;</span>], </a>
<a class="sourceLine" id="cb83-14" data-line-number="14">                    <span class="dt">ymin =</span> bbox[<span class="st">&quot;ymax&quot;</span>] <span class="op">-</span><span class="st"> </span>(bbox[<span class="st">&quot;ymax&quot;</span>] <span class="op">-</span><span class="st"> </span>bbox[<span class="st">&quot;ymin&quot;</span>])<span class="op">/</span><span class="dv">3</span>, </a>
<a class="sourceLine" id="cb83-15" data-line-number="15">                    <span class="dt">ymax =</span> bbox[<span class="st">&quot;ymax&quot;</span>])<span class="op">+</span></a>
<a class="sourceLine" id="cb83-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>roads, <span class="dt">size=</span><span class="fl">0.2</span>, <span class="dt">col=</span><span class="st">&quot;steelblue&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb83-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>locs, <span class="kw">aes</span>(<span class="dt">col=</span>nnb<span class="op">/</span><span class="dv">1000</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb83-18" data-line-number="18"><span class="st">  </span></a>
<a class="sourceLine" id="cb83-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_colour_scico</span>(<span class="dt">palette =</span> <span class="st">&quot;oslo&quot;</span>, <span class="dt">values=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">direction =</span> <span class="dv">-1</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb83-20" data-line-number="20">                     <span class="dt">na.value =</span> <span class="st">&quot;indianred&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb83-21" data-line-number="21"></a>
<a class="sourceLine" id="cb83-22" data-line-number="22"><span class="st">  </span><span class="kw">annotation_north_arrow</span>(<span class="dt">location =</span> <span class="st">&quot;br&quot;</span>, <span class="dt">which_north =</span> <span class="st">&quot;true&quot;</span>, </a>
<a class="sourceLine" id="cb83-23" data-line-number="23">                         <span class="dt">pad_x =</span> <span class="kw">unit</span>(<span class="fl">0.1</span>, <span class="st">&quot;in&quot;</span>), <span class="dt">pad_y =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;in&quot;</span>),</a>
<a class="sourceLine" id="cb83-24" data-line-number="24">                         <span class="dt">style =</span> north_arrow_fancy_orienteering) <span class="op">+</span></a>
<a class="sourceLine" id="cb83-25" data-line-number="25"><span class="st">  </span><span class="kw">annotation_scale</span>(<span class="dt">location =</span> <span class="st">&quot;br&quot;</span>, <span class="dt">width_hint =</span> <span class="fl">0.4</span>, <span class="dt">text_cex =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb83-26" data-line-number="26"><span class="st">  </span></a>
<a class="sourceLine" id="cb83-27" data-line-number="27"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb83-28" data-line-number="28"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.9</span>,<span class="fl">0.55</span>),</a>
<a class="sourceLine" id="cb83-29" data-line-number="29">        <span class="dt">legend.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb83-30" data-line-number="30">        <span class="dt">legend.key =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="st">&quot;grey90&quot;</span>),</a>
<a class="sourceLine" id="cb83-31" data-line-number="31">        <span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb83-32" data-line-number="32">        <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb83-33" data-line-number="33"><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">expand =</span> <span class="ot">FALSE</span>, <span class="dt">xlim =</span> bbox[<span class="kw">c</span>(<span class="st">&quot;xmin&quot;</span>, <span class="st">&quot;xmax&quot;</span>)], <span class="dt">ylim =</span> bbox[<span class="kw">c</span>(<span class="st">&quot;ymin&quot;</span>, <span class="st">&quot;ymax&quot;</span>)])<span class="op">+</span></a>
<a class="sourceLine" id="cb83-34" data-line-number="34"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;checklists&quot;</span>, <span class="dt">colour=</span><span class="ot">NULL</span>)</a></code></pre></div>
<div class="figure">
<img src="figs/fig_distRoads.png" alt="Checklist locations across the Nilgiris, Anamalais and the Palani hills. Inset histogram shows checklists' distance to the nearest road, with the X-axis on a log-scale."  />
<p class="caption">
(#fig:plot_figure1)Checklist locations across the Nilgiris, Anamalais and the Palani hills. Inset histogram shows checklists’ distance to the nearest road, with the X-axis on a log-scale.
</p>
</div>

</div>
</div>
<div id="species-observation-distributions" class="section level2">
<h2><span class="header-section-number">9.2</span> Species observation distributions</h2>
<div id="prepare-libraries-5" class="section level3">
<h3><span class="header-section-number">9.2.1</span> Prepare libraries</h3>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="co"># load libraries</span></a>
<a class="sourceLine" id="cb84-2" data-line-number="2"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb84-3" data-line-number="3"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb84-4" data-line-number="4"><span class="kw">library</span>(magrittr)</a>
<a class="sourceLine" id="cb84-5" data-line-number="5"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb84-6" data-line-number="6"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb84-7" data-line-number="7"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb84-8" data-line-number="8"></a>
<a class="sourceLine" id="cb84-9" data-line-number="9"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb84-10" data-line-number="10"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb84-11" data-line-number="11"><span class="kw">library</span>(scico)</a>
<a class="sourceLine" id="cb84-12" data-line-number="12"></a>
<a class="sourceLine" id="cb84-13" data-line-number="13"><span class="co"># round any function</span></a>
<a class="sourceLine" id="cb84-14" data-line-number="14">round_any &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">accuracy =</span> <span class="dv">20000</span>){<span class="kw">round</span>(x<span class="op">/</span>accuracy)<span class="op">*</span>accuracy}</a></code></pre></div>
</div>
<div id="read-species-of-interest" class="section level3">
<h3><span class="header-section-number">9.2.2</span> Read species of interest</h3>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1"><span class="co"># add species of interest</span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2">specieslist &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;data/V2_ListOfSpecies_ChosenForStudy.csv.xlsx&quot;</span>)</a>
<a class="sourceLine" id="cb85-3" data-line-number="3">speciesOfInterest &lt;-<span class="st"> </span>specieslist<span class="op">$</span>scientific_name</a></code></pre></div>
</div>
<div id="load-raw-data-for-locations" class="section level3">
<h3><span class="header-section-number">9.2.3</span> Load raw data for locations</h3>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="co"># read in shapefile of the study area to subset by bounding box</span></a>
<a class="sourceLine" id="cb86-2" data-line-number="2"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb86-3" data-line-number="3">wg &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/spatial/hillsShapefile/Nil_Ana_Pal.shp&quot;</span>); box &lt;-<span class="st"> </span><span class="kw">st_bbox</span>(wg)</a>
<a class="sourceLine" id="cb86-4" data-line-number="4"></a>
<a class="sourceLine" id="cb86-5" data-line-number="5"><span class="co"># read in data and subset</span></a>
<a class="sourceLine" id="cb86-6" data-line-number="6">ebd &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;ebd_Filtered_Jun2019.txt&quot;</span>)</a>
<a class="sourceLine" id="cb86-7" data-line-number="7">ebd &lt;-<span class="st"> </span>ebd[<span class="kw">between</span>(LONGITUDE, box[<span class="st">&quot;xmin&quot;</span>], box[<span class="st">&quot;xmax&quot;</span>]) <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb86-8" data-line-number="8"><span class="st">            </span><span class="kw">between</span>(LATITUDE, box[<span class="st">&quot;ymin&quot;</span>], box[<span class="st">&quot;ymax&quot;</span>]),]</a>
<a class="sourceLine" id="cb86-9" data-line-number="9">ebd &lt;-<span class="st"> </span>ebd[<span class="kw">year</span>(<span class="st">`</span><span class="dt">OBSERVATION DATE</span><span class="st">`</span>) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2013</span>,]</a>
<a class="sourceLine" id="cb86-10" data-line-number="10"></a>
<a class="sourceLine" id="cb86-11" data-line-number="11"><span class="co"># make new column names</span></a>
<a class="sourceLine" id="cb86-12" data-line-number="12">newNames &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(<span class="kw">colnames</span>(ebd), <span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb86-13" data-line-number="13"><span class="st">  </span><span class="kw">str_to_lower</span>()</a>
<a class="sourceLine" id="cb86-14" data-line-number="14"><span class="kw">setnames</span>(ebd, newNames)</a>
<a class="sourceLine" id="cb86-15" data-line-number="15"></a>
<a class="sourceLine" id="cb86-16" data-line-number="16"><span class="co"># keep useful columns</span></a>
<a class="sourceLine" id="cb86-17" data-line-number="17">columnsOfInterest &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;scientific_name&quot;</span>,<span class="st">&quot;observation_count&quot;</span>,<span class="st">&quot;locality&quot;</span>,</a>
<a class="sourceLine" id="cb86-18" data-line-number="18">    <span class="st">&quot;locality_id&quot;</span>,<span class="st">&quot;locality_type&quot;</span>,<span class="st">&quot;latitude&quot;</span>,<span class="st">&quot;longitude&quot;</span>,<span class="st">&quot;observation_date&quot;</span>, <span class="st">&quot;sampling_event_identifier&quot;</span>)</a>
<a class="sourceLine" id="cb86-19" data-line-number="19">ebd &lt;-<span class="st"> </span>ebd[,..columnsOfInterest]</a></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1"><span class="co"># strict spatial filter and assign grid</span></a>
<a class="sourceLine" id="cb87-2" data-line-number="2">locs &lt;-<span class="st"> </span>ebd[,.(longitude, latitude)]</a>
<a class="sourceLine" id="cb87-3" data-line-number="3"></a>
<a class="sourceLine" id="cb87-4" data-line-number="4"><span class="co"># transform to UTM and get 20km boxes</span></a>
<a class="sourceLine" id="cb87-5" data-line-number="5">coords &lt;-<span class="st"> </span><span class="kw">setDF</span>(locs) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-6" data-line-number="6"><span class="st">  </span><span class="kw">st_as_sf</span>(<span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-7" data-line-number="7"><span class="st">  `</span><span class="dt">st_crs&lt;-</span><span class="st">`</span>(<span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-8" data-line-number="8"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">as.data.table</span>(<span class="kw">st_coordinates</span>(.))) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb87-9" data-line-number="9"><span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">32643</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(.))</a>
<a class="sourceLine" id="cb87-11" data-line-number="11"></a>
<a class="sourceLine" id="cb87-12" data-line-number="12"><span class="co"># convert wg to UTM for filter</span></a>
<a class="sourceLine" id="cb87-13" data-line-number="13">wg &lt;-<span class="st"> </span><span class="kw">st_transform</span>(wg, <span class="dv">32643</span>)</a>
<a class="sourceLine" id="cb87-14" data-line-number="14">coords &lt;-<span class="st"> </span>coords <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-15" data-line-number="15"><span class="st">  </span><span class="kw">filter</span>(id <span class="op">%in%</span><span class="st"> </span><span class="kw">unlist</span>(<span class="kw">st_contains</span>(wg, coords))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-16" data-line-number="16"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">longitude =</span> X, <span class="dt">latitude =</span> Y) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-17" data-line-number="17"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">as.data.table</span>(<span class="kw">st_coordinates</span>(.))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-18" data-line-number="18"><span class="st">  </span><span class="kw">st_drop_geometry</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-19" data-line-number="19"><span class="st">  </span><span class="kw">as.data.table</span>()</a>
<a class="sourceLine" id="cb87-20" data-line-number="20"></a>
<a class="sourceLine" id="cb87-21" data-line-number="21"><span class="co"># remove unneeded objs</span></a>
<a class="sourceLine" id="cb87-22" data-line-number="22"><span class="kw">rm</span>(locs); <span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb87-23" data-line-number="23"></a>
<a class="sourceLine" id="cb87-24" data-line-number="24">coords &lt;-<span class="st"> </span>coords[,.N,by=.(longitude, latitude, X, Y)]</a>
<a class="sourceLine" id="cb87-25" data-line-number="25"></a>
<a class="sourceLine" id="cb87-26" data-line-number="26">ebd &lt;-<span class="st"> </span><span class="kw">merge</span>(ebd, coords, <span class="dt">all =</span> <span class="ot">FALSE</span>, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>))</a>
<a class="sourceLine" id="cb87-27" data-line-number="27"></a>
<a class="sourceLine" id="cb87-28" data-line-number="28">ebd &lt;-<span class="st"> </span>ebd[(longitude <span class="op">%in%</span><span class="st"> </span>coords<span class="op">$</span>longitude) <span class="op">&amp;</span><span class="st"> </span>(latitude <span class="op">%in%</span><span class="st"> </span>coords<span class="op">$</span>latitude),]</a></code></pre></div>
</div>
<div id="get-proportional-obs-counts-in-20km-cells" class="section level3">
<h3><span class="header-section-number">9.2.4</span> Get proportional obs counts in 20km cells</h3>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1"><span class="co"># round to 20km cell in UTM coords</span></a>
<a class="sourceLine" id="cb88-2" data-line-number="2">ebd[,<span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(<span class="dt">X =</span> <span class="kw">round_any</span>(X), <span class="dt">Y =</span> <span class="kw">round_any</span>(Y))]</a>
<a class="sourceLine" id="cb88-3" data-line-number="3"></a>
<a class="sourceLine" id="cb88-4" data-line-number="4"><span class="co"># count checklists in cell</span></a>
<a class="sourceLine" id="cb88-5" data-line-number="5">ebd_summary &lt;-<span class="st"> </span>ebd[,nchk <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(sampling_event_identifier)), by=.(X,Y)]</a>
<a class="sourceLine" id="cb88-6" data-line-number="6"></a>
<a class="sourceLine" id="cb88-7" data-line-number="7"><span class="co"># count checklists reporting each species in cell and get proportion</span></a>
<a class="sourceLine" id="cb88-8" data-line-number="8">ebd_summary &lt;-<span class="st"> </span>ebd_summary[,.(<span class="dt">nrep =</span> <span class="kw">length</span>(<span class="kw">unique</span>(sampling_event_identifier))),</a>
<a class="sourceLine" id="cb88-9" data-line-number="9">   by =<span class="st"> </span>.(X,Y,nchk,scientific_name)]</a>
<a class="sourceLine" id="cb88-10" data-line-number="10"></a>
<a class="sourceLine" id="cb88-11" data-line-number="11">ebd_summary[,p_rep <span class="op">:</span><span class="er">=</span><span class="st"> </span>nrep<span class="op">/</span>nchk ]</a>
<a class="sourceLine" id="cb88-12" data-line-number="12"></a>
<a class="sourceLine" id="cb88-13" data-line-number="13"><span class="co"># filter for soi</span></a>
<a class="sourceLine" id="cb88-14" data-line-number="14">ebd_summary &lt;-<span class="st"> </span>ebd_summary[scientific_name <span class="op">%in%</span><span class="st"> </span>speciesOfInterest,]</a>
<a class="sourceLine" id="cb88-15" data-line-number="15"></a>
<a class="sourceLine" id="cb88-16" data-line-number="16"><span class="co"># complete the dataframe for no reports</span></a>
<a class="sourceLine" id="cb88-17" data-line-number="17">ebd_summary &lt;-<span class="st"> </span><span class="kw">setDF</span>(ebd_summary) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb88-18" data-line-number="18"><span class="st">  </span><span class="kw">complete</span>(<span class="kw">nesting</span>(X,Y), scientific_name, <span class="dt">fill =</span> <span class="kw">list</span>(<span class="dt">p_rep =</span> <span class="dv">0</span>))</a></code></pre></div>
</div>
<div id="plot-maps" class="section level3">
<h3><span class="header-section-number">9.2.5</span> Plot maps</h3>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="co"># add land</span></a>
<a class="sourceLine" id="cb89-2" data-line-number="2"><span class="kw">library</span>(rnaturalearth)</a>
<a class="sourceLine" id="cb89-3" data-line-number="3">land &lt;-<span class="st"> </span><span class="kw">ne_countries</span>(<span class="dt">scale =</span> <span class="dv">50</span>, <span class="dt">type =</span> <span class="st">&quot;countries&quot;</span>, <span class="dt">continent =</span> <span class="st">&quot;asia&quot;</span>,</a>
<a class="sourceLine" id="cb89-4" data-line-number="4">                     <span class="dt">country =</span> <span class="st">&quot;india&quot;</span>,</a>
<a class="sourceLine" id="cb89-5" data-line-number="5">                     <span class="dt">returnclass =</span> <span class="kw">c</span>(<span class="st">&quot;sf&quot;</span>))</a>
<a class="sourceLine" id="cb89-6" data-line-number="6"></a>
<a class="sourceLine" id="cb89-7" data-line-number="7"><span class="co"># crop land</span></a>
<a class="sourceLine" id="cb89-8" data-line-number="8">land &lt;-<span class="st"> </span><span class="kw">st_transform</span>(land, <span class="dv">32643</span>)</a></code></pre></div>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="co"># make plot</span></a>
<a class="sourceLine" id="cb90-2" data-line-number="2">wg &lt;-<span class="st"> </span><span class="kw">st_transform</span>(wg, <span class="dv">32643</span>)</a>
<a class="sourceLine" id="cb90-3" data-line-number="3">bbox &lt;-<span class="st"> </span><span class="kw">st_bbox</span>(wg)</a>
<a class="sourceLine" id="cb90-4" data-line-number="4"></a>
<a class="sourceLine" id="cb90-5" data-line-number="5">plotDistributions &lt;-</a>
<a class="sourceLine" id="cb90-6" data-line-number="6"><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb90-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> land, <span class="dt">fill =</span> <span class="st">&quot;grey90&quot;</span>, <span class="dt">col =</span> <span class="ot">NA</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb90-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">data =</span> ebd_summary,</a>
<a class="sourceLine" id="cb90-9" data-line-number="9">            <span class="kw">aes</span>(X, Y, <span class="dt">fill =</span> p_rep), <span class="dt">lwd =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> <span class="st">&quot;grey90&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb90-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> wg, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">lwd =</span> <span class="fl">0.3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb90-11" data-line-number="11"><span class="st">  </span></a>
<a class="sourceLine" id="cb90-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_fill_scico</span>(<span class="dt">palette =</span> <span class="st">&quot;lajolla&quot;</span>, <span class="dt">direction =</span> <span class="dv">1</span>, <span class="dt">label =</span> scales<span class="op">::</span>percent)<span class="op">+</span></a>
<a class="sourceLine" id="cb90-13" data-line-number="13"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>scientific_name, <span class="dt">ncol =</span> <span class="dv">7</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb90-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">xlim =</span> bbox[<span class="kw">c</span>(<span class="st">&quot;xmin&quot;</span>, <span class="st">&quot;xmax&quot;</span>)], <span class="dt">ylim =</span> bbox[<span class="kw">c</span>(<span class="st">&quot;ymin&quot;</span>, <span class="st">&quot;ymax&quot;</span>)])<span class="op">+</span></a>
<a class="sourceLine" id="cb90-15" data-line-number="15"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb90-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;right&quot;</span>, </a>
<a class="sourceLine" id="cb90-17" data-line-number="17">        <span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb90-18" data-line-number="18">        <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>),</a>
<a class="sourceLine" id="cb90-19" data-line-number="19">        <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;lightblue&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb90-20" data-line-number="20"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;prop.</span><span class="ch">\n</span><span class="st">reporting</span><span class="ch">\n</span><span class="st">checklists&quot;</span>)</a>
<a class="sourceLine" id="cb90-21" data-line-number="21">  </a>
<a class="sourceLine" id="cb90-22" data-line-number="22"><span class="co"># export data</span></a>
<a class="sourceLine" id="cb90-23" data-line-number="23"><span class="kw">ggsave</span>(plotDistributions, <span class="dt">filename =</span> <span class="st">&quot;figs/fig_species_distributions.png&quot;</span>, </a>
<a class="sourceLine" id="cb90-24" data-line-number="24">       <span class="dt">height =</span> <span class="dv">12</span>, <span class="dt">width =</span> <span class="dv">17</span>, <span class="dt">device =</span> <span class="kw">png</span>(), <span class="dt">dpi =</span> <span class="dv">300</span>); <span class="kw">dev.off</span>()</a></code></pre></div>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="co"># show exported image</span></a>
<a class="sourceLine" id="cb91-2" data-line-number="2">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_species_distributions.png&quot;</span>)</a></code></pre></div>
<div class="figure">
<img src="figs/fig_species_distributions.png" alt="Proportion of checklists reporting a species in each grid cell (20km side) between 2013 and 2018. Checklists were filtered to be within the boundaries of the Nilgiris, Anamalais and the Palani hills (black outline), but rounding to 20km cells may place cells outside the boundary. Deeper shades of red indicate a higher proportion of checklists reporting a species."  />
<p class="caption">
(#fig:export_fig_obs_dist)Proportion of checklists reporting a species in each grid cell (20km side) between 2013 and 2018. Checklists were filtered to be within the boundaries of the Nilgiris, Anamalais and the Palani hills (black outline), but rounding to 20km cells may place cells outside the boundary. Deeper shades of red indicate a higher proportion of checklists reporting a species.
</p>
</div>

</div>
</div>
<div id="climate-in-relation-to-elevation" class="section level2">
<h2><span class="header-section-number">9.3</span> Climate in relation to elevation</h2>
<div id="prepare-libraries-6" class="section level3">
<h3><span class="header-section-number">9.3.1</span> Prepare libraries</h3>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="co"># load libs</span></a>
<a class="sourceLine" id="cb92-2" data-line-number="2"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb92-3" data-line-number="3"><span class="kw">library</span>(glue)</a>
<a class="sourceLine" id="cb92-4" data-line-number="4"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb92-5" data-line-number="5"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb92-6" data-line-number="6"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb92-7" data-line-number="7"></a>
<a class="sourceLine" id="cb92-8" data-line-number="8"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb92-9" data-line-number="9"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb92-10" data-line-number="10"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb92-11" data-line-number="11"></a>
<a class="sourceLine" id="cb92-12" data-line-number="12"><span class="co"># get ci func</span></a>
<a class="sourceLine" id="cb92-13" data-line-number="13">ci &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="kw">sd</span>(x, <span class="dt">na.rm =</span> T)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">length</span>(x))}</a></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="co"># read landscape prepare for plotting</span></a>
<a class="sourceLine" id="cb93-2" data-line-number="2">landscape &lt;-<span class="st"> </span><span class="kw">stack</span>(<span class="st">&quot;data/spatial/landscape_resamp01km.tif&quot;</span>)</a>
<a class="sourceLine" id="cb93-3" data-line-number="3"></a>
<a class="sourceLine" id="cb93-4" data-line-number="4"><span class="co"># get proper names</span></a>
<a class="sourceLine" id="cb93-5" data-line-number="5">elev_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;elev&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;aspect&quot;</span>)</a>
<a class="sourceLine" id="cb93-6" data-line-number="6">chelsa_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;chelsa_bio10_04&quot;</span>, <span class="st">&quot;chelsa_bio10_17&quot;</span>, <span class="st">&quot;chelsa_bio10_18&quot;</span>,</a>
<a class="sourceLine" id="cb93-7" data-line-number="7">                  <span class="st">&quot;chelsa_prec&quot;</span>, <span class="st">&quot;chelsa_temp&quot;</span>)</a>
<a class="sourceLine" id="cb93-8" data-line-number="8"></a>
<a class="sourceLine" id="cb93-9" data-line-number="9"><span class="kw">names</span>(landscape) &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">glue</span>(<span class="st">&#39;{c(elev_names, chelsa_names, &quot;landcover&quot;)}&#39;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="co"># make duplicate stack</span></a>
<a class="sourceLine" id="cb94-2" data-line-number="2">land_data &lt;-<span class="st"> </span>landscape[[<span class="kw">c</span>(<span class="st">&quot;elev&quot;</span>, chelsa_names)]]</a>
<a class="sourceLine" id="cb94-3" data-line-number="3"></a>
<a class="sourceLine" id="cb94-4" data-line-number="4"><span class="co"># convert to list</span></a>
<a class="sourceLine" id="cb94-5" data-line-number="5">land_data &lt;-<span class="st"> </span><span class="kw">as.list</span>(land_data)</a>
<a class="sourceLine" id="cb94-6" data-line-number="6"></a>
<a class="sourceLine" id="cb94-7" data-line-number="7"><span class="co"># map get values over the stack</span></a>
<a class="sourceLine" id="cb94-8" data-line-number="8">land_data &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(land_data, getValues)</a>
<a class="sourceLine" id="cb94-9" data-line-number="9"><span class="kw">names</span>(land_data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;elev&quot;</span>, chelsa_names)</a>
<a class="sourceLine" id="cb94-10" data-line-number="10"></a>
<a class="sourceLine" id="cb94-11" data-line-number="11"><span class="co"># conver to dataframe and round to 100m</span></a>
<a class="sourceLine" id="cb94-12" data-line-number="12">land_data &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(land_data)</a>
<a class="sourceLine" id="cb94-13" data-line-number="13">land_data &lt;-<span class="st"> </span><span class="kw">drop_na</span>(land_data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb94-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">elev_round  =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(elev, <span class="dv">200</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb94-15" data-line-number="15"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>elev) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb94-16" data-line-number="16"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw">contains</span>(<span class="st">&quot;chelsa&quot;</span>),</a>
<a class="sourceLine" id="cb94-17" data-line-number="17">               <span class="dt">names_to =</span> <span class="st">&quot;clim_var&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb94-18" data-line-number="18"><span class="st">  </span><span class="kw">group_by</span>(elev_round, clim_var) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb94-19" data-line-number="19"><span class="st">  </span><span class="kw">summarise_all</span>(<span class="dt">.funs =</span> <span class="kw">list</span>(<span class="op">~</span><span class="kw">mean</span>(.), <span class="op">~</span><span class="kw">ci</span>(.)))</a></code></pre></div>
</div>
<div id="plot-climatic-variables-over-elevation" class="section level3">
<h3><span class="header-section-number">9.3.2</span> Plot climatic variables over elevation</h3>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="co"># plot in facets</span></a>
<a class="sourceLine" id="cb95-2" data-line-number="2"></a>
<a class="sourceLine" id="cb95-3" data-line-number="3">fig_climate_elev &lt;-<span class="st"> </span><span class="kw">ggplot</span>(land_data)<span class="op">+</span></a>
<a class="sourceLine" id="cb95-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> elev_round, <span class="dt">y =</span> mean),</a>
<a class="sourceLine" id="cb95-5" data-line-number="5">            <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb95-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">x =</span> elev_round, <span class="dt">y =</span> mean, <span class="dt">ymin=</span>mean<span class="op">-</span>ci, <span class="dt">ymax=</span>mean<span class="op">+</span>ci),</a>
<a class="sourceLine" id="cb95-7" data-line-number="7">                  <span class="dt">size =</span> <span class="fl">0.3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb95-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma)<span class="op">+</span></a>
<a class="sourceLine" id="cb95-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma)<span class="op">+</span></a>
<a class="sourceLine" id="cb95-10" data-line-number="10"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>clim_var, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb95-11" data-line-number="11"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb95-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;elevation (m)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;CHELSA variable value&quot;</span>)</a>
<a class="sourceLine" id="cb95-13" data-line-number="13"></a>
<a class="sourceLine" id="cb95-14" data-line-number="14"><span class="co"># save as png</span></a>
<a class="sourceLine" id="cb95-15" data-line-number="15"><span class="kw">ggsave</span>(fig_climate_elev, <span class="dt">filename =</span> <span class="st">&quot;figs/fig_climate_elev.png&quot;</span>, </a>
<a class="sourceLine" id="cb95-16" data-line-number="16">       <span class="dt">height =</span> <span class="dv">4</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">device =</span> <span class="kw">png</span>(), <span class="dt">dpi =</span> <span class="dv">300</span>); <span class="kw">dev.off</span>()</a></code></pre></div>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="co"># show exported image</span></a>
<a class="sourceLine" id="cb96-2" data-line-number="2">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_climate_elev.png&quot;</span>)</a></code></pre></div>
<div class="figure">
<img src="figs/fig_climate_elev.png" alt="CHELSA climatic variables as a function of elevation, in increments of 200m. Points represent means, while vertical lines show 95% confidence intervals."  />
<p class="caption">
(#fig:export_fig_clim_elev)CHELSA climatic variables as a function of elevation, in increments of 200m. Points represent means, while vertical lines show 95% confidence intervals.
</p>
</div>
</div>
</div>
<div id="landcover-in-relation-to-elevation" class="section level2">
<h2><span class="header-section-number">9.4</span> Landcover in relation to elevation</h2>
<div id="get-data-from-landscape-rasters" class="section level3">
<h3><span class="header-section-number">9.4.1</span> Get data from landscape rasters</h3>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="co"># get data from landscape rasters</span></a>
<a class="sourceLine" id="cb97-2" data-line-number="2">lc_elev &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">elev =</span> <span class="kw">getValues</span>(landscape[[<span class="st">&quot;elev&quot;</span>]]),</a>
<a class="sourceLine" id="cb97-3" data-line-number="3">                  <span class="dt">landcover =</span> <span class="kw">getValues</span>(landscape[[<span class="st">&quot;landcover&quot;</span>]]))</a>
<a class="sourceLine" id="cb97-4" data-line-number="4"><span class="co"># process data for proportions</span></a>
<a class="sourceLine" id="cb97-5" data-line-number="5">lc_elev &lt;-<span class="st"> </span>lc_elev <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb97-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(landcover), landcover <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb97-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">elev =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(elev, <span class="dv">100</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb97-8" data-line-number="8"><span class="st">  </span><span class="kw">count</span>(elev, landcover) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb97-9" data-line-number="9"><span class="st">  </span><span class="kw">group_by</span>(elev) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb97-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n<span class="op">/</span><span class="kw">sum</span>(n))</a></code></pre></div>
</div>
<div id="plot-proportional-landcover-in-elevation" class="section level3">
<h3><span class="header-section-number">9.4.2</span> Plot proportional landcover in elevation</h3>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1"><span class="co"># plot figure as tilemap</span></a>
<a class="sourceLine" id="cb98-2" data-line-number="2">fig_lc_elev &lt;-<span class="st"> </span><span class="kw">ggplot</span>(lc_elev)<span class="op">+</span></a>
<a class="sourceLine" id="cb98-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x=</span>elev, <span class="dt">y=</span><span class="kw">factor</span>(landcover), </a>
<a class="sourceLine" id="cb98-4" data-line-number="4">                <span class="dt">fill=</span>prop), </a>
<a class="sourceLine" id="cb98-5" data-line-number="5">            <span class="dt">col=</span><span class="st">&quot;grey99&quot;</span>, <span class="dt">size =</span> <span class="fl">0.6</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb98-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_fill_scico</span>(<span class="dt">palette =</span> <span class="st">&quot;bilbao&quot;</span>, <span class="dt">begin =</span> <span class="fl">0.0</span>, <span class="dt">end =</span> <span class="fl">1.0</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb98-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2500</span>, <span class="dv">500</span>), <span class="dt">labels =</span> comma)<span class="op">+</span></a>
<a class="sourceLine" id="cb98-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_alpha_continuous</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="fl">0.3</span>, <span class="dv">1</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb98-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;elevation (m)&quot;</span>, </a>
<a class="sourceLine" id="cb98-10" data-line-number="10">       <span class="dt">y =</span> <span class="st">&quot;landcover&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb98-11" data-line-number="11"><span class="st">  </span><span class="kw">theme_few</span>()</a>
<a class="sourceLine" id="cb98-12" data-line-number="12"></a>
<a class="sourceLine" id="cb98-13" data-line-number="13"><span class="co"># export figure</span></a>
<a class="sourceLine" id="cb98-14" data-line-number="14"><span class="kw">ggsave</span>(fig_lc_elev, <span class="dt">filename =</span> <span class="st">&quot;figs/fig_lc_elev.png&quot;</span>, </a>
<a class="sourceLine" id="cb98-15" data-line-number="15">       <span class="dt">height =</span> <span class="dv">3</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">device =</span> <span class="kw">png</span>(), <span class="dt">dpi =</span> <span class="dv">300</span>); <span class="kw">dev.off</span>()</a></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="co"># show exported image</span></a>
<a class="sourceLine" id="cb99-2" data-line-number="2">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_lc_elev.png&quot;</span>)</a></code></pre></div>
<div class="figure">
<img src="figs/fig_lc_elev.png" alt="Proportional landcover (low = white, high = dark red), as a function of elevation in the study site. Data represent elevation in increments of 100m."  />
<p class="caption">
(#fig:show_fig_lc_elev)Proportional landcover (low = white, high = dark red), as a function of elevation in the study site. Data represent elevation in increments of 100m.
</p>
</div>

</div>
</div>
<div id="climate-in-relation-to-landcover" class="section level2">
<h2><span class="header-section-number">9.5</span> Climate in relation to landcover</h2>
<div id="prepare-libraries-7" class="section level3">
<h3><span class="header-section-number">9.5.1</span> Prepare libraries</h3>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="co"># load libs</span></a>
<a class="sourceLine" id="cb100-2" data-line-number="2"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb100-3" data-line-number="3"><span class="kw">library</span>(glue)</a>
<a class="sourceLine" id="cb100-4" data-line-number="4"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb100-5" data-line-number="5"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb100-6" data-line-number="6"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb100-7" data-line-number="7"></a>
<a class="sourceLine" id="cb100-8" data-line-number="8"><span class="co"># plotting options</span></a>
<a class="sourceLine" id="cb100-9" data-line-number="9"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb100-10" data-line-number="10"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb100-11" data-line-number="11"><span class="kw">library</span>(scico)</a>
<a class="sourceLine" id="cb100-12" data-line-number="12"></a>
<a class="sourceLine" id="cb100-13" data-line-number="13"><span class="co"># get ci func</span></a>
<a class="sourceLine" id="cb100-14" data-line-number="14">ci &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="kw">sd</span>(x, <span class="dt">na.rm =</span> T)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">length</span>(x))}</a></code></pre></div>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="co"># read landscape prepare for plotting</span></a>
<a class="sourceLine" id="cb101-2" data-line-number="2">landscape &lt;-<span class="st"> </span><span class="kw">stack</span>(<span class="st">&quot;data/spatial/landscape_resamp01km.tif&quot;</span>)</a>
<a class="sourceLine" id="cb101-3" data-line-number="3"></a>
<a class="sourceLine" id="cb101-4" data-line-number="4"><span class="co"># get proper names</span></a>
<a class="sourceLine" id="cb101-5" data-line-number="5">elev_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;elev&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;aspect&quot;</span>)</a>
<a class="sourceLine" id="cb101-6" data-line-number="6">chelsa_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;chelsa_bio10_04&quot;</span>, <span class="st">&quot;chelsa_bio10_17&quot;</span>, <span class="st">&quot;chelsa_bio10_18&quot;</span>,</a>
<a class="sourceLine" id="cb101-7" data-line-number="7">                  <span class="st">&quot;chelsa_prec&quot;</span>, <span class="st">&quot;chelsa_temp&quot;</span>)</a>
<a class="sourceLine" id="cb101-8" data-line-number="8"></a>
<a class="sourceLine" id="cb101-9" data-line-number="9"><span class="kw">names</span>(landscape) &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">glue</span>(<span class="st">&#39;{c(elev_names, chelsa_names, &quot;landcover&quot;)}&#39;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="co"># make duplicate stack</span></a>
<a class="sourceLine" id="cb102-2" data-line-number="2">land_data &lt;-<span class="st"> </span>landscape[[<span class="kw">c</span>(<span class="st">&quot;landcover&quot;</span>, chelsa_names)]]</a>
<a class="sourceLine" id="cb102-3" data-line-number="3"></a>
<a class="sourceLine" id="cb102-4" data-line-number="4"><span class="co"># convert to list</span></a>
<a class="sourceLine" id="cb102-5" data-line-number="5">land_data &lt;-<span class="st"> </span><span class="kw">as.list</span>(land_data)</a>
<a class="sourceLine" id="cb102-6" data-line-number="6"></a>
<a class="sourceLine" id="cb102-7" data-line-number="7"><span class="co"># map get values over the stack</span></a>
<a class="sourceLine" id="cb102-8" data-line-number="8">land_data &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(land_data, raster<span class="op">::</span>getValues)</a>
<a class="sourceLine" id="cb102-9" data-line-number="9"><span class="kw">names</span>(land_data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;landcover&quot;</span>, chelsa_names)</a>
<a class="sourceLine" id="cb102-10" data-line-number="10"></a>
<a class="sourceLine" id="cb102-11" data-line-number="11"><span class="co"># conver to dataframe and round to 100m</span></a>
<a class="sourceLine" id="cb102-12" data-line-number="12">land_data &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(land_data)</a>
<a class="sourceLine" id="cb102-13" data-line-number="13">land_data &lt;-<span class="st"> </span><span class="kw">drop_na</span>(land_data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb102-14" data-line-number="14"><span class="st">  </span><span class="kw">filter</span>(landcover <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb102-15" data-line-number="15"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw">contains</span>(<span class="st">&quot;chelsa&quot;</span>),</a>
<a class="sourceLine" id="cb102-16" data-line-number="16">               <span class="dt">names_to =</span> <span class="st">&quot;clim_var&quot;</span>) <span class="co">#%&gt;% </span></a>
<a class="sourceLine" id="cb102-17" data-line-number="17"><span class="co"># group_by(landcover, clim_var) %&gt;% </span></a>
<a class="sourceLine" id="cb102-18" data-line-number="18"><span class="co"># summarise_all(.funs = list(~mean(.), ~ci(.)))</span></a></code></pre></div>
</div>
<div id="plot-climatic-variables-over-landcover" class="section level3">
<h3><span class="header-section-number">9.5.2</span> Plot climatic variables over landcover</h3>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1"><span class="co"># plot in facets</span></a>
<a class="sourceLine" id="cb103-2" data-line-number="2"></a>
<a class="sourceLine" id="cb103-3" data-line-number="3">fig_climate_lc &lt;-<span class="st"> </span><span class="kw">ggplot</span>(land_data)<span class="op">+</span></a>
<a class="sourceLine" id="cb103-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="kw">aes</span>(<span class="dt">x =</span> landcover<span class="fl">-0.25</span>, <span class="dt">y=</span>value,</a>
<a class="sourceLine" id="cb103-5" data-line-number="5">                  <span class="dt">col =</span> <span class="kw">factor</span>(landcover)),</a>
<a class="sourceLine" id="cb103-6" data-line-number="6">              <span class="dt">width =</span> <span class="fl">0.2</span>,</a>
<a class="sourceLine" id="cb103-7" data-line-number="7">              <span class="dt">size =</span> <span class="fl">0.1</span>, <span class="dt">alpha =</span> <span class="fl">0.1</span>, <span class="dt">shape =</span> <span class="dv">4</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb103-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> landcover<span class="fl">+0.25</span>, <span class="dt">y =</span> value, <span class="dt">group =</span> landcover),</a>
<a class="sourceLine" id="cb103-9" data-line-number="9">               <span class="dt">width =</span> <span class="fl">0.2</span>,</a>
<a class="sourceLine" id="cb103-10" data-line-number="10">               <span class="dt">outlier.size =</span> <span class="fl">0.2</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">fill =</span> <span class="ot">NA</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb103-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_colour_scico_d</span>(<span class="dt">begin=</span><span class="fl">0.2</span>, <span class="dt">end=</span><span class="fl">0.8</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb103-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma)<span class="op">+</span></a>
<a class="sourceLine" id="cb103-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb103-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>clim_var, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb103-15" data-line-number="15"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb103-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb103-17" data-line-number="17"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;landcover class&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;CHELSA variable value&quot;</span>)</a>
<a class="sourceLine" id="cb103-18" data-line-number="18"></a>
<a class="sourceLine" id="cb103-19" data-line-number="19"><span class="co"># save as png</span></a>
<a class="sourceLine" id="cb103-20" data-line-number="20"><span class="kw">ggsave</span>(fig_climate_lc, <span class="dt">filename =</span> <span class="st">&quot;figs/fig_climate_landcover.png&quot;</span>, </a>
<a class="sourceLine" id="cb103-21" data-line-number="21">       <span class="dt">height =</span> <span class="dv">5</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">device =</span> <span class="kw">png</span>(), <span class="dt">dpi =</span> <span class="dv">300</span>); <span class="kw">dev.off</span>()</a></code></pre></div>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1"><span class="co"># show exported image</span></a>
<a class="sourceLine" id="cb104-2" data-line-number="2">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_climate_landcover.png&quot;</span>)</a></code></pre></div>
<div class="figure">
<img src="figs/fig_climate_landcover.png" alt="CHELSA climatic variables as a function of landcover class. Grey points in the background represent raw data."  />
<p class="caption">
(#fig:export_fig_clim_lc)CHELSA climatic variables as a function of landcover class. Grey points in the background represent raw data.
</p>
</div>

</div>
</div>
<div id="obsever-expertise-in-time-and-space" class="section level2">
<h2><span class="header-section-number">9.6</span> Obsever expertise in time and space</h2>
<div id="prepare-libraries-8" class="section level3">
<h3><span class="header-section-number">9.6.1</span> Prepare libraries</h3>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="co"># load libs</span></a>
<a class="sourceLine" id="cb105-2" data-line-number="2"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb105-3" data-line-number="3"><span class="kw">library</span>(glue)</a>
<a class="sourceLine" id="cb105-4" data-line-number="4"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb105-5" data-line-number="5"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb105-6" data-line-number="6"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb105-7" data-line-number="7"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb105-8" data-line-number="8"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb105-9" data-line-number="9"></a>
<a class="sourceLine" id="cb105-10" data-line-number="10"><span class="co"># plotting libs</span></a>
<a class="sourceLine" id="cb105-11" data-line-number="11"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb105-12" data-line-number="12"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb105-13" data-line-number="13"><span class="kw">library</span>(scico)</a>
<a class="sourceLine" id="cb105-14" data-line-number="14"></a>
<a class="sourceLine" id="cb105-15" data-line-number="15"><span class="co"># get ci func</span></a>
<a class="sourceLine" id="cb105-16" data-line-number="16">ci &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="kw">sd</span>(x, <span class="dt">na.rm =</span> T)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">length</span>(x))}</a></code></pre></div>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="co"># read in scores and checklist data and link</span></a>
<a class="sourceLine" id="cb106-2" data-line-number="2">scores &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/dataObsExpScore.csv&quot;</span>)</a>
<a class="sourceLine" id="cb106-3" data-line-number="3">data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/eBirdChecklistVars.csv&quot;</span>)</a>
<a class="sourceLine" id="cb106-4" data-line-number="4"></a>
<a class="sourceLine" id="cb106-5" data-line-number="5">data &lt;-<span class="st"> </span><span class="kw">left_join</span>(data, scores, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;observer&quot;</span> =<span class="st"> &quot;observer&quot;</span>))</a>
<a class="sourceLine" id="cb106-6" data-line-number="6">data &lt;-<span class="st"> </span><span class="kw">select</span>(data, score, nSp, nSoi, landcover, year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb106-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(score))</a></code></pre></div>
</div>
<div id="species-seen-in-relation-to-osberver-expertise" class="section level3">
<h3><span class="header-section-number">9.6.2</span> Species seen in relation to osberver expertise</h3>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1"><span class="co"># summarise data by rounded score and year</span></a>
<a class="sourceLine" id="cb107-2" data-line-number="2">data_summary01 &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb107-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">score =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(score, <span class="fl">0.2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb107-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(score, year, nSp, nSoi) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb107-5" data-line-number="5"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">&quot;nSp&quot;</span>, <span class="st">&quot;nSoi&quot;</span>),</a>
<a class="sourceLine" id="cb107-6" data-line-number="6">               <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb107-7" data-line-number="7"><span class="st">  </span><span class="kw">group_by</span>(score, year, variable) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb107-8" data-line-number="8"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(value), <span class="kw">list</span>(<span class="op">~</span><span class="kw">mean</span>(.), <span class="op">~</span><span class="kw">ci</span>(.)))</a>
<a class="sourceLine" id="cb107-9" data-line-number="9"></a>
<a class="sourceLine" id="cb107-10" data-line-number="10"><span class="co"># make plot and export</span></a>
<a class="sourceLine" id="cb107-11" data-line-number="11">fig_nsp_score &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb107-12" data-line-number="12"><span class="st">  </span><span class="kw">ggplot</span>(data_summary01)<span class="op">+</span></a>
<a class="sourceLine" id="cb107-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">data =</span> data, <span class="kw">aes</span>(<span class="dt">x =</span> score, <span class="dt">y =</span> nSp), </a>
<a class="sourceLine" id="cb107-14" data-line-number="14">             <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb107-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">x =</span> score, <span class="dt">y =</span> mean, </a>
<a class="sourceLine" id="cb107-16" data-line-number="16">                      <span class="dt">ymin=</span>mean<span class="op">-</span>ci, <span class="dt">ymax=</span>mean<span class="op">+</span>ci,</a>
<a class="sourceLine" id="cb107-17" data-line-number="17">                      <span class="dt">col =</span> <span class="kw">as.factor</span>(variable)),</a>
<a class="sourceLine" id="cb107-18" data-line-number="18">                  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.05</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb107-19" data-line-number="19"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year)<span class="op">+</span></a>
<a class="sourceLine" id="cb107-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_y_log10</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb107-21" data-line-number="21"><span class="co">#  coord_cartesian(ylim=c(0,50))+</span></a>
<a class="sourceLine" id="cb107-22" data-line-number="22"><span class="st">  </span><span class="kw">scale_colour_scico_d</span>(<span class="dt">palette =</span> <span class="st">&quot;cork&quot;</span>, <span class="dt">begin =</span> <span class="fl">0.2</span>, <span class="dt">end =</span> <span class="fl">0.8</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb107-23" data-line-number="23"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;expertise score&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;species reported&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb107-24" data-line-number="24"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb107-25" data-line-number="25"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb107-26" data-line-number="26"></a>
<a class="sourceLine" id="cb107-27" data-line-number="27"><span class="co"># export figure</span></a>
<a class="sourceLine" id="cb107-28" data-line-number="28"><span class="kw">ggsave</span>(<span class="dt">filename =</span> <span class="st">&quot;figs/fig_nsp_score.png&quot;</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">device =</span> <span class="kw">png</span>(), <span class="dt">dpi =</span> <span class="dv">300</span>); <span class="kw">dev.off</span>()</a></code></pre></div>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1"><span class="co"># show exported image</span></a>
<a class="sourceLine" id="cb108-2" data-line-number="2">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_nsp_score.png&quot;</span>)</a></code></pre></div>
<div class="figure">
<img src="figs/fig_nsp_score.png" alt="Total number of species (blue) and species of interest to this study (green) reported in checklists from the study area over the years 2013 -- 2018, as a function of the expertise score of the reporting observer. Points represent means, with bars showing the 95% confidence intervals; data shown are for expertise scores rounded to multiples of 0.2, and the y-axis is on a log scale. Raw data are shown in the background (grey points)."  />
<p class="caption">
(#fig:show_fig_nsp_score)Total number of species (blue) and species of interest to this study (green) reported in checklists from the study area over the years 2013 – 2018, as a function of the expertise score of the reporting observer. Points represent means, with bars showing the 95% confidence intervals; data shown are for expertise scores rounded to multiples of 0.2, and the y-axis is on a log scale. Raw data are shown in the background (grey points).
</p>
</div>
</div>
<div id="expertise-in-relation-to-landcover" class="section level3">
<h3><span class="header-section-number">9.6.3</span> Expertise in relation to landcover</h3>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="co"># plot histograms of expertise scores in different landcover classes</span></a>
<a class="sourceLine" id="cb109-2" data-line-number="2">data &lt;-<span class="st"> </span><span class="kw">filter</span>(data, <span class="op">!</span><span class="kw">is.na</span>(landcover))</a>
<a class="sourceLine" id="cb109-3" data-line-number="3"></a>
<a class="sourceLine" id="cb109-4" data-line-number="4"><span class="co"># make plot</span></a>
<a class="sourceLine" id="cb109-5" data-line-number="5">fig_exp_lc &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data)<span class="op">+</span></a>
<a class="sourceLine" id="cb109-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> score), <span class="dt">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="dt">bins =</span> <span class="dv">20</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb109-7" data-line-number="7"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>landcover, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="dt">labeller =</span> label_both, <span class="dt">nrow =</span> <span class="dv">2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb109-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> comma)<span class="op">+</span></a>
<a class="sourceLine" id="cb109-9" data-line-number="9"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb109-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb109-11" data-line-number="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;expertise score&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;count&quot;</span>)</a>
<a class="sourceLine" id="cb109-12" data-line-number="12"></a>
<a class="sourceLine" id="cb109-13" data-line-number="13"><span class="co"># export figure</span></a>
<a class="sourceLine" id="cb109-14" data-line-number="14"></a>
<a class="sourceLine" id="cb109-15" data-line-number="15"><span class="kw">ggsave</span>(<span class="dt">filename =</span> <span class="st">&quot;figs/fig_exp_lc.png&quot;</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">4</span>, <span class="dt">device =</span> <span class="kw">png</span>(), <span class="dt">dpi =</span> <span class="dv">300</span>); <span class="kw">dev.off</span>()</a></code></pre></div>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="co"># show exported image</span></a>
<a class="sourceLine" id="cb110-2" data-line-number="2">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_exp_lc.png&quot;</span>)</a></code></pre></div>
<div class="figure">
<img src="figs/fig_exp_lc.png" alt="Distribution of expertise scores in the seven landcover classes present in the study site."  />
<p class="caption">
(#fig:show_fig_exp_lc)Distribution of expertise scores in the seven landcover classes present in the study site.
</p>
</div>

</div>
</div>
<div id="spatial-autocorrelation-in-climatic-predictors" class="section level2">
<h2><span class="header-section-number">9.7</span> Spatial autocorrelation in climatic predictors</h2>
<div id="load-libs-and-prep-data" class="section level3">
<h3><span class="header-section-number">9.7.1</span> Load libs and prep data</h3>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1"><span class="co"># load libs</span></a>
<a class="sourceLine" id="cb111-2" data-line-number="2"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb111-3" data-line-number="3"><span class="kw">library</span>(gstat)</a>
<a class="sourceLine" id="cb111-4" data-line-number="4"><span class="kw">library</span>(stars)</a>
<a class="sourceLine" id="cb111-5" data-line-number="5"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb111-6" data-line-number="6"><span class="kw">library</span>(tibble)</a>
<a class="sourceLine" id="cb111-7" data-line-number="7"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb111-8" data-line-number="8"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb111-9" data-line-number="9"><span class="kw">library</span>(glue)</a>
<a class="sourceLine" id="cb111-10" data-line-number="10"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb111-11" data-line-number="11"><span class="kw">library</span>(gdalUtils)</a>
<a class="sourceLine" id="cb111-12" data-line-number="12"></a>
<a class="sourceLine" id="cb111-13" data-line-number="13"><span class="co"># plot libs</span></a>
<a class="sourceLine" id="cb111-14" data-line-number="14"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb111-15" data-line-number="15"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb111-16" data-line-number="16"><span class="kw">library</span>(scico)</a>
<a class="sourceLine" id="cb111-17" data-line-number="17"><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb111-18" data-line-number="18"><span class="kw">library</span>(cowplot)</a>
<a class="sourceLine" id="cb111-19" data-line-number="19"><span class="kw">library</span>(ggspatial)</a>
<a class="sourceLine" id="cb111-20" data-line-number="20"></a>
<a class="sourceLine" id="cb111-21" data-line-number="21"><span class="co">#&#39;make custom functiont to convert matrix to df</span></a>
<a class="sourceLine" id="cb111-22" data-line-number="22">raster_to_df &lt;-<span class="st"> </span><span class="cf">function</span>(inp) {</a>
<a class="sourceLine" id="cb111-23" data-line-number="23">  </a>
<a class="sourceLine" id="cb111-24" data-line-number="24">  <span class="co"># assert is a raster obj</span></a>
<a class="sourceLine" id="cb111-25" data-line-number="25">  assertthat<span class="op">::</span><span class="kw">assert_that</span>(<span class="st">&quot;RasterLayer&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">class</span>(inp),</a>
<a class="sourceLine" id="cb111-26" data-line-number="26">                          <span class="dt">msg =</span> <span class="st">&quot;input is not a raster&quot;</span>)</a>
<a class="sourceLine" id="cb111-27" data-line-number="27">  </a>
<a class="sourceLine" id="cb111-28" data-line-number="28">  coords &lt;-<span class="st"> </span><span class="kw">coordinates</span>(inp)</a>
<a class="sourceLine" id="cb111-29" data-line-number="29">  vals &lt;-<span class="st"> </span><span class="kw">getValues</span>(inp)</a>
<a class="sourceLine" id="cb111-30" data-line-number="30">  </a>
<a class="sourceLine" id="cb111-31" data-line-number="31">  data &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> coords[,<span class="dv">1</span>], <span class="dt">y =</span> coords[,<span class="dv">2</span>], <span class="dt">value =</span> vals)</a>
<a class="sourceLine" id="cb111-32" data-line-number="32">  </a>
<a class="sourceLine" id="cb111-33" data-line-number="33">  <span class="kw">return</span>(data)</a>
<a class="sourceLine" id="cb111-34" data-line-number="34">}</a></code></pre></div>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="co"># list landscape covariate stacks</span></a>
<a class="sourceLine" id="cb112-2" data-line-number="2">landscape_files &lt;-<span class="st"> &quot;data/spatial/landscape_resamp01km.tif&quot;</span></a>
<a class="sourceLine" id="cb112-3" data-line-number="3">landscape_data &lt;-<span class="st"> </span><span class="kw">stack</span>(landscape_files)</a>
<a class="sourceLine" id="cb112-4" data-line-number="4"></a>
<a class="sourceLine" id="cb112-5" data-line-number="5"><span class="co"># get proper names</span></a>
<a class="sourceLine" id="cb112-6" data-line-number="6">{</a>
<a class="sourceLine" id="cb112-7" data-line-number="7">  elev_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;elev&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;aspect&quot;</span>)</a>
<a class="sourceLine" id="cb112-8" data-line-number="8">  chelsa_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;chelsa_bio10_04&quot;</span>, <span class="st">&quot;chelsa_bio10_17&quot;</span>, <span class="st">&quot;chelsa_bio10_18&quot;</span>,<span class="st">&quot;chelsa_prec&quot;</span>, <span class="st">&quot;chelsa_temp&quot;</span>)</a>
<a class="sourceLine" id="cb112-9" data-line-number="9">  <span class="kw">names</span>(landscape_data) &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">glue</span>(<span class="st">&#39;{c(elev_names, chelsa_names, &quot;landcover&quot;)}&#39;</span>))</a>
<a class="sourceLine" id="cb112-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb112-11" data-line-number="11"></a>
<a class="sourceLine" id="cb112-12" data-line-number="12"><span class="co"># get chelsa rasters</span></a>
<a class="sourceLine" id="cb112-13" data-line-number="13">chelsa &lt;-<span class="st"> </span>landscape_data[[chelsa_names]]</a>
<a class="sourceLine" id="cb112-14" data-line-number="14">chelsa &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(<span class="kw">as.list</span>(chelsa), raster_to_df)</a></code></pre></div>
</div>
<div id="calculate-variograms" class="section level3">
<h3><span class="header-section-number">9.7.2</span> Calculate variograms</h3>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="co"># prep variograms</span></a>
<a class="sourceLine" id="cb113-2" data-line-number="2">vgrams &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(chelsa, <span class="cf">function</span>(z){</a>
<a class="sourceLine" id="cb113-3" data-line-number="3">  z &lt;-<span class="st"> </span><span class="kw">drop_na</span>(z)</a>
<a class="sourceLine" id="cb113-4" data-line-number="4">  vgram &lt;-<span class="st"> </span>gstat<span class="op">::</span><span class="kw">variogram</span>(value<span class="op">~</span><span class="dv">1</span>, <span class="dt">loc=</span><span class="op">~</span>x<span class="op">+</span>y, <span class="dt">data =</span> z)</a>
<a class="sourceLine" id="cb113-5" data-line-number="5">  <span class="kw">return</span>(vgram)</a>
<a class="sourceLine" id="cb113-6" data-line-number="6">})</a>
<a class="sourceLine" id="cb113-7" data-line-number="7"></a>
<a class="sourceLine" id="cb113-8" data-line-number="8"><span class="co"># save temp</span></a>
<a class="sourceLine" id="cb113-9" data-line-number="9"><span class="kw">save</span>(vgrams, <span class="dt">file =</span> <span class="st">&quot;data/chelsa/chelsaVariograms.rdata&quot;</span>)</a>
<a class="sourceLine" id="cb113-10" data-line-number="10"></a>
<a class="sourceLine" id="cb113-11" data-line-number="11"><span class="co"># get variogram data</span></a>
<a class="sourceLine" id="cb113-12" data-line-number="12">vgrams &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(vgrams, <span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb113-13" data-line-number="13">  df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(dist, gamma)</a>
<a class="sourceLine" id="cb113-14" data-line-number="14">})</a>
<a class="sourceLine" id="cb113-15" data-line-number="15">vgrams &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">variable =</span> chelsa_names,</a>
<a class="sourceLine" id="cb113-16" data-line-number="16">                 <span class="dt">data =</span> vgrams)</a></code></pre></div>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">wg &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/spatial/hillsShapefile/Nil_Ana_Pal.shp&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb114-2" data-line-number="2"><span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">32643</span>)</a>
<a class="sourceLine" id="cb114-3" data-line-number="3">bbox &lt;-<span class="st"> </span><span class="kw">st_bbox</span>(wg)</a>
<a class="sourceLine" id="cb114-4" data-line-number="4"></a>
<a class="sourceLine" id="cb114-5" data-line-number="5"><span class="co"># add lamd</span></a>
<a class="sourceLine" id="cb114-6" data-line-number="6"><span class="kw">library</span>(rnaturalearth)</a>
<a class="sourceLine" id="cb114-7" data-line-number="7">land &lt;-<span class="st"> </span><span class="kw">ne_countries</span>(<span class="dt">scale =</span> <span class="dv">50</span>, <span class="dt">type =</span> <span class="st">&quot;countries&quot;</span>, <span class="dt">continent =</span> <span class="st">&quot;asia&quot;</span>,</a>
<a class="sourceLine" id="cb114-8" data-line-number="8">                     <span class="dt">country =</span> <span class="st">&quot;india&quot;</span>,</a>
<a class="sourceLine" id="cb114-9" data-line-number="9">                     <span class="dt">returnclass =</span> <span class="kw">c</span>(<span class="st">&quot;sf&quot;</span>))</a>
<a class="sourceLine" id="cb114-10" data-line-number="10"></a>
<a class="sourceLine" id="cb114-11" data-line-number="11"><span class="co"># crop land</span></a>
<a class="sourceLine" id="cb114-12" data-line-number="12">land &lt;-<span class="st"> </span><span class="kw">st_transform</span>(land, <span class="dv">32643</span>)</a></code></pre></div>
</div>
<div id="plot-chelsa-data-and-variograms" class="section level3">
<h3><span class="header-section-number">9.7.3</span> Plot CHELSA data and variograms</h3>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1"><span class="co"># make ggplot of variograms</span></a>
<a class="sourceLine" id="cb115-2" data-line-number="2">yaxis &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;semivariance&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb115-3" data-line-number="3">xaxis &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;distance (km)&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb115-4" data-line-number="4">fig_vgrams &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">pmap</span>(<span class="kw">list</span>(vgrams<span class="op">$</span>data, yaxis, xaxis), <span class="cf">function</span>(df, ya, xa){</a>
<a class="sourceLine" id="cb115-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb115-6" data-line-number="6">  <span class="kw">ggplot</span>(df)<span class="op">+</span></a>
<a class="sourceLine" id="cb115-7" data-line-number="7"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dist<span class="op">/</span><span class="dv">1000</span>, <span class="dt">y =</span> gamma), <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb115-8" data-line-number="8"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dist<span class="op">/</span><span class="dv">1000</span>, <span class="dt">y =</span> gamma), <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb115-9" data-line-number="9"><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> comma, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">25</span>)))<span class="op">+</span></a>
<a class="sourceLine" id="cb115-10" data-line-number="10"><span class="st">    </span><span class="kw">scale_y_log10</span>(<span class="dt">labels =</span> comma)<span class="op">+</span></a>
<a class="sourceLine" id="cb115-11" data-line-number="11"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> xa, <span class="dt">y =</span> ya)<span class="op">+</span></a>
<a class="sourceLine" id="cb115-12" data-line-number="12"><span class="st">    </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb115-13" data-line-number="13"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb115-14" data-line-number="14">          <span class="dt">strip.text =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb115-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb115-16" data-line-number="16">})</a>
<a class="sourceLine" id="cb115-17" data-line-number="17">fig_vgrams &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(fig_vgrams, as_grob)</a>
<a class="sourceLine" id="cb115-18" data-line-number="18"></a>
<a class="sourceLine" id="cb115-19" data-line-number="19"><span class="co"># make ggplot of chelsa data</span></a>
<a class="sourceLine" id="cb115-20" data-line-number="20">chelsa &lt;-<span class="st"> </span><span class="kw">as.list</span>(landscape_data[[chelsa_names]]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb115-21" data-line-number="21"><span class="st">  </span>purrr<span class="op">::</span><span class="kw">map</span>(st_as_stars)</a>
<a class="sourceLine" id="cb115-22" data-line-number="22"></a>
<a class="sourceLine" id="cb115-23" data-line-number="23"><span class="co"># colour palettes</span></a>
<a class="sourceLine" id="cb115-24" data-line-number="24">pal &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;bilbao&quot;</span>, <span class="st">&quot;davos&quot;</span>, <span class="st">&quot;davos&quot;</span>, <span class="st">&quot;nuuk&quot;</span>, <span class="st">&quot;bilbao&quot;</span>)</a>
<a class="sourceLine" id="cb115-25" data-line-number="25">title &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a Temp. seasonality&quot;</span>,</a>
<a class="sourceLine" id="cb115-26" data-line-number="26">           <span class="st">&quot;b Ppt. driest qtr.&quot;</span>,</a>
<a class="sourceLine" id="cb115-27" data-line-number="27">           <span class="st">&quot;c Ppt. warmest qtr.&quot;</span>,</a>
<a class="sourceLine" id="cb115-28" data-line-number="28">           <span class="st">&quot;d Variation ppt.&quot;</span>,</a>
<a class="sourceLine" id="cb115-29" data-line-number="29">           <span class="st">&quot;e Variation temp.&quot;</span>)</a>
<a class="sourceLine" id="cb115-30" data-line-number="30">direction &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb115-31" data-line-number="31">lims &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">range</span>(chelsa[[<span class="dv">1</span>]]<span class="op">$</span>chelsa_bio10_<span class="dv">04</span>, <span class="dt">na.rm =</span> T), </a>
<a class="sourceLine" id="cb115-32" data-line-number="32">             <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">500</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">500</span>),</a>
<a class="sourceLine" id="cb115-33" data-line-number="33">             <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">500</span>),<span class="co">#range(chelsa[[4]]$chelsa_prec, na.rm = T),</span></a>
<a class="sourceLine" id="cb115-34" data-line-number="34">             <span class="kw">range</span>(chelsa[[<span class="dv">5</span>]]<span class="op">$</span>chelsa_temp, <span class="dt">na.rm =</span> T))</a>
<a class="sourceLine" id="cb115-35" data-line-number="35">fig_list_chelsa &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb115-36" data-line-number="36"><span class="st">  </span>purrr<span class="op">::</span><span class="kw">pmap</span>(<span class="kw">list</span>(chelsa, pal, title, direction, lims), </a>
<a class="sourceLine" id="cb115-37" data-line-number="37">              <span class="cf">function</span>(df, pal, t, d, l){</a>
<a class="sourceLine" id="cb115-38" data-line-number="38">                <span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb115-39" data-line-number="39"><span class="st">                  </span><span class="kw">geom_stars</span>(<span class="dt">data =</span> df)<span class="op">+</span></a>
<a class="sourceLine" id="cb115-40" data-line-number="40"><span class="st">                  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> land, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb115-41" data-line-number="41"><span class="st">                  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> wg, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="fl">0.3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb115-42" data-line-number="42"><span class="st">                  </span><span class="kw">scale_fill_scico</span>(<span class="dt">palette =</span> pal, <span class="dt">direction =</span> d, </a>
<a class="sourceLine" id="cb115-43" data-line-number="43">                                   <span class="dt">label =</span> comma, <span class="dt">na.value =</span> <span class="ot">NA</span>, <span class="dt">limits =</span> l)<span class="op">+</span></a>
<a class="sourceLine" id="cb115-44" data-line-number="44"><span class="st">                  </span><span class="kw">coord_sf</span>(<span class="dt">xlim =</span> bbox[<span class="kw">c</span>(<span class="st">&quot;xmin&quot;</span>, <span class="st">&quot;xmax&quot;</span>)], </a>
<a class="sourceLine" id="cb115-45" data-line-number="45">                           <span class="dt">ylim =</span> bbox[<span class="kw">c</span>(<span class="st">&quot;ymin&quot;</span>, <span class="st">&quot;ymax&quot;</span>)])<span class="op">+</span></a>
<a class="sourceLine" id="cb115-46" data-line-number="46"><span class="st">                  </span><span class="kw">annotation_scale</span>(<span class="dt">location =</span> <span class="st">&quot;tr&quot;</span>, <span class="dt">width_hint =</span> <span class="fl">0.4</span>, <span class="dt">text_cex =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb115-47" data-line-number="47"><span class="st">                  </span></a>
<a class="sourceLine" id="cb115-48" data-line-number="48"><span class="st">                  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb115-49" data-line-number="49"><span class="st">                  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>,</a>
<a class="sourceLine" id="cb115-50" data-line-number="50">                        <span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">size =</span> <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb115-51" data-line-number="51">                        <span class="dt">legend.key.height =</span> <span class="kw">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>),</a>
<a class="sourceLine" id="cb115-52" data-line-number="52">                        <span class="dt">legend.key.width =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>),</a>
<a class="sourceLine" id="cb115-53" data-line-number="53">                        <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb115-54" data-line-number="54">                        <span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb115-55" data-line-number="55">                        <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>),</a>
<a class="sourceLine" id="cb115-56" data-line-number="56">                        <span class="co"># panel.background = element_rect(fill = &quot;lightblue&quot;),</span></a>
<a class="sourceLine" id="cb115-57" data-line-number="57">                        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>())<span class="op">+</span></a>
<a class="sourceLine" id="cb115-58" data-line-number="58"><span class="st">                  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="ot">NULL</span>, <span class="dt">y=</span><span class="ot">NULL</span>, <span class="dt">title =</span> t)</a>
<a class="sourceLine" id="cb115-59" data-line-number="59">              })</a>
<a class="sourceLine" id="cb115-60" data-line-number="60">fig_list_chelsa &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(fig_list_chelsa, as_grob)</a></code></pre></div>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1">fig_list_chelsa &lt;-<span class="st"> </span><span class="kw">append</span>(fig_list_chelsa, fig_vgrams)</a>
<a class="sourceLine" id="cb116-2" data-line-number="2">lmatrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>)), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> T)</a>
<a class="sourceLine" id="cb116-3" data-line-number="3">plot_grid &lt;-<span class="st"> </span><span class="kw">grid.arrange</span>(<span class="dt">grobs =</span> fig_list_chelsa, <span class="dt">layout_matrix =</span> lmatrix)</a>
<a class="sourceLine" id="cb116-4" data-line-number="4"></a>
<a class="sourceLine" id="cb116-5" data-line-number="5"><span class="kw">ggsave</span>(<span class="dt">plot =</span> plot_grid, <span class="dt">filename =</span> <span class="st">&quot;figs/fig_chelsa_variograms.png&quot;</span>, <span class="dt">dpi =</span> <span class="dv">300</span>, <span class="dt">width =</span> <span class="dv">12</span>, <span class="dt">height =</span> <span class="dv">6</span>)</a></code></pre></div>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1"><span class="co"># show exported image</span></a>
<a class="sourceLine" id="cb117-2" data-line-number="2">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_chelsa_variograms.png&quot;</span>)</a></code></pre></div>
<div class="figure">
<img src="figs/fig_chelsa_variograms.png" alt="CHELSA rasters with study area outline, and associated semivariograms. Semivariograms are on a log-transformed y-axis."  />
<p class="caption">
(#fig:show_fig_chelsa)CHELSA rasters with study area outline, and associated semivariograms. Semivariograms are on a log-transformed y-axis.
</p>
</div>
</div>
</div>
<div id="climatic-raster-resampling" class="section level2">
<h2><span class="header-section-number">9.8</span> Climatic raster resampling</h2>
<div id="prepare-landcover-1" class="section level3">
<h3><span class="header-section-number">9.8.1</span> Prepare landcover</h3>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1"><span class="co"># read in landcover raster location</span></a>
<a class="sourceLine" id="cb118-2" data-line-number="2">landcover &lt;-<span class="st"> &quot;data/landUseClassification/Reprojected Image_26thJan2020_UTM_Ghats.tif&quot;</span></a>
<a class="sourceLine" id="cb118-3" data-line-number="3"><span class="co"># get extent</span></a>
<a class="sourceLine" id="cb118-4" data-line-number="4">e =<span class="st"> </span><span class="kw">bbox</span>(<span class="kw">raster</span>(landcover))</a>
<a class="sourceLine" id="cb118-5" data-line-number="5"></a>
<a class="sourceLine" id="cb118-6" data-line-number="6"><span class="co"># init resolution</span></a>
<a class="sourceLine" id="cb118-7" data-line-number="7">res_init &lt;-<span class="st"> </span><span class="kw">res</span>(<span class="kw">raster</span>(landcover))</a>
<a class="sourceLine" id="cb118-8" data-line-number="8"><span class="co"># res to transform to 1000m</span></a>
<a class="sourceLine" id="cb118-9" data-line-number="9">res_final &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">250</span>, <span class="dv">500</span>, <span class="fl">1e3</span>, <span class="fl">2.5e3</span>), <span class="cf">function</span>(x){x<span class="op">*</span>res_init})</a>
<a class="sourceLine" id="cb118-10" data-line-number="10"></a>
<a class="sourceLine" id="cb118-11" data-line-number="11"><span class="co"># use gdalutils gdalwarp for resampling transform</span></a>
<a class="sourceLine" id="cb118-12" data-line-number="12"><span class="co"># to 1km from 10m</span></a>
<a class="sourceLine" id="cb118-13" data-line-number="13"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(res_final)) {</a>
<a class="sourceLine" id="cb118-14" data-line-number="14">  this_res &lt;-<span class="st"> </span>res_final[[i]]</a>
<a class="sourceLine" id="cb118-15" data-line-number="15">  this_res_char &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_pad</span>(this_res[<span class="dv">1</span>], <span class="dv">5</span>, <span class="dt">pad =</span> <span class="st">&quot;0&quot;</span>)</a>
<a class="sourceLine" id="cb118-16" data-line-number="16">  <span class="kw">gdalwarp</span>(<span class="dt">srcfile =</span> landcover, </a>
<a class="sourceLine" id="cb118-17" data-line-number="17">          <span class="dt">dstfile =</span> <span class="kw">as.character</span>(<span class="kw">glue</span>(<span class="st">&#39;data/landUseClassification/lc_{this_res_char}m.tif&#39;</span>)), </a>
<a class="sourceLine" id="cb118-18" data-line-number="18">          <span class="dt">tr=</span><span class="kw">c</span>(this_res), <span class="dt">r=</span><span class="st">&#39;mode&#39;</span>, <span class="dt">te=</span><span class="kw">c</span>(e))</a>
<a class="sourceLine" id="cb118-19" data-line-number="19">}</a></code></pre></div>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1"><span class="co"># read in resampled landcover raster files as a list</span></a>
<a class="sourceLine" id="cb119-2" data-line-number="2">lc_files &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;data/landUseClassification/&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;lc&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb119-3" data-line-number="3">lc_data &lt;-<span class="st"> </span><span class="kw">map</span>(lc_files, raster)</a></code></pre></div>
</div>
<div id="prepare-spatial-extent-1" class="section level3">
<h3><span class="header-section-number">9.8.2</span> Prepare spatial extent</h3>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1"><span class="co"># load hills</span></a>
<a class="sourceLine" id="cb120-2" data-line-number="2"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb120-3" data-line-number="3">hills &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/spatial/hillsShapefile/Nil_Ana_Pal.shp&quot;</span>)</a>
<a class="sourceLine" id="cb120-4" data-line-number="4">hills &lt;-<span class="st"> </span><span class="kw">st_transform</span>(hills, <span class="dv">32643</span>)</a>
<a class="sourceLine" id="cb120-5" data-line-number="5">buffer &lt;-<span class="st"> </span><span class="kw">st_buffer</span>(hills, <span class="fl">3e4</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb120-6" data-line-number="6"><span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">4326</span>)</a>
<a class="sourceLine" id="cb120-7" data-line-number="7">bbox &lt;-<span class="st"> </span><span class="kw">st_bbox</span>(hills)</a></code></pre></div>
</div>
<div id="prepare-chelsa-rasters-1" class="section level3">
<h3><span class="header-section-number">9.8.3</span> Prepare CHELSA rasters</h3>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="co"># list chelsa files</span></a>
<a class="sourceLine" id="cb121-2" data-line-number="2">chelsaFiles &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;data/chelsa/&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>, <span class="dt">pattern =</span> <span class="st">&quot;*.tif&quot;</span>)</a>
<a class="sourceLine" id="cb121-3" data-line-number="3"></a>
<a class="sourceLine" id="cb121-4" data-line-number="4"><span class="co"># gather chelsa rasters</span></a>
<a class="sourceLine" id="cb121-5" data-line-number="5">chelsaData &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(chelsaFiles, <span class="cf">function</span>(chr){</a>
<a class="sourceLine" id="cb121-6" data-line-number="6">  a &lt;-<span class="st"> </span><span class="kw">raster</span>(chr)</a>
<a class="sourceLine" id="cb121-7" data-line-number="7">  <span class="kw">crs</span>(a) &lt;-<span class="st"> </span><span class="kw">crs</span>(buffer)</a>
<a class="sourceLine" id="cb121-8" data-line-number="8">  a &lt;-<span class="st"> </span><span class="kw">crop</span>(a, <span class="kw">as</span>(buffer, <span class="st">&quot;Spatial&quot;</span>))</a>
<a class="sourceLine" id="cb121-9" data-line-number="9">  <span class="kw">return</span>(a)</a>
<a class="sourceLine" id="cb121-10" data-line-number="10">})</a>
<a class="sourceLine" id="cb121-11" data-line-number="11"></a>
<a class="sourceLine" id="cb121-12" data-line-number="12"><span class="co"># stack chelsa data</span></a>
<a class="sourceLine" id="cb121-13" data-line-number="13">chelsaData &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">stack</span>(chelsaData)</a>
<a class="sourceLine" id="cb121-14" data-line-number="14"><span class="kw">names</span>(chelsaData) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;chelsa_bio10_04&quot;</span>, <span class="st">&quot;chelsa_bio10_17&quot;</span>, <span class="st">&quot;chelsa_bio10_18&quot;</span>,<span class="st">&quot;chelsa_prec&quot;</span>, <span class="st">&quot;chelsa_temp&quot;</span>)</a></code></pre></div>
</div>
<div id="resample-prepared-rasters" class="section level3">
<h3><span class="header-section-number">9.8.4</span> Resample prepared rasters</h3>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1"><span class="co"># make resampled data</span></a>
<a class="sourceLine" id="cb122-2" data-line-number="2">resamp_data &lt;-<span class="st"> </span><span class="kw">map</span>(lc_data, <span class="cf">function</span>(this_scale){</a>
<a class="sourceLine" id="cb122-3" data-line-number="3">  rr &lt;-<span class="st"> </span><span class="kw">projectRaster</span>(<span class="dt">from =</span> chelsaData, <span class="dt">to =</span> this_scale, </a>
<a class="sourceLine" id="cb122-4" data-line-number="4">                      <span class="dt">crs =</span> <span class="kw">crs</span>(this_scale), <span class="dt">res =</span> <span class="kw">res</span>(this_scale))</a>
<a class="sourceLine" id="cb122-5" data-line-number="5">})</a>
<a class="sourceLine" id="cb122-6" data-line-number="6"></a>
<a class="sourceLine" id="cb122-7" data-line-number="7"><span class="co"># make a stars list</span></a>
<a class="sourceLine" id="cb122-8" data-line-number="8">resamp_data &lt;-<span class="st"> </span><span class="kw">map2</span>(resamp_data, lc_data, <span class="cf">function</span>(z1,z2){</a>
<a class="sourceLine" id="cb122-9" data-line-number="9">  z2[z2 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb122-10" data-line-number="10">  z2 &lt;-<span class="st"> </span><span class="kw">append</span>(z2, <span class="kw">as.list</span>(z1)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(st_as_stars)</a>
<a class="sourceLine" id="cb122-11" data-line-number="11">}) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb122-12" data-line-number="12"><span class="st">  </span><span class="kw">flatten</span>()</a></code></pre></div>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="co"># colour palettes</span></a>
<a class="sourceLine" id="cb123-2" data-line-number="2">pal &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;batlow&quot;</span>, <span class="st">&quot;bilbao&quot;</span>, <span class="st">&quot;davos&quot;</span>, <span class="st">&quot;davos&quot;</span>, <span class="st">&quot;nuuk&quot;</span>, <span class="st">&quot;bilbao&quot;</span>)</a>
<a class="sourceLine" id="cb123-3" data-line-number="3">title &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a landcover&quot;</span>,</a>
<a class="sourceLine" id="cb123-4" data-line-number="4">           <span class="st">&quot;b Temp. seasonality&quot;</span>,</a>
<a class="sourceLine" id="cb123-5" data-line-number="5">           <span class="st">&quot;c Ppt. driest qtr.&quot;</span>,</a>
<a class="sourceLine" id="cb123-6" data-line-number="6">           <span class="st">&quot;d Ppt. warmest qtr.&quot;</span>,</a>
<a class="sourceLine" id="cb123-7" data-line-number="7">           <span class="st">&quot;e Variation ppt.&quot;</span>,</a>
<a class="sourceLine" id="cb123-8" data-line-number="8">           <span class="st">&quot;f Variation temp.&quot;</span>)</a>
<a class="sourceLine" id="cb123-9" data-line-number="9">title &lt;-<span class="st"> </span><span class="kw">c</span>(title, <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, <span class="dv">24</span>))</a>
<a class="sourceLine" id="cb123-10" data-line-number="10">direction &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb123-11" data-line-number="11"></a>
<a class="sourceLine" id="cb123-12" data-line-number="12">scales &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">c</span>(<span class="st">&quot;1.0km&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, <span class="dv">5</span>)), <span class="kw">c</span>(<span class="st">&quot;2.5km&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, <span class="dv">5</span>)), </a>
<a class="sourceLine" id="cb123-13" data-line-number="13">            <span class="kw">c</span>(<span class="st">&quot;5.0km&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, <span class="dv">5</span>)), <span class="kw">c</span>(<span class="st">&quot;10km&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, <span class="dv">5</span>)), </a>
<a class="sourceLine" id="cb123-14" data-line-number="14">            <span class="kw">c</span>(<span class="st">&quot;25km&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, <span class="dv">5</span>)))</a>
<a class="sourceLine" id="cb123-15" data-line-number="15"></a>
<a class="sourceLine" id="cb123-16" data-line-number="16"><span class="co"># make figures across the list</span></a>
<a class="sourceLine" id="cb123-17" data-line-number="17">fig_list_chelsa_resamp &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb123-18" data-line-number="18"><span class="st">  </span>purrr<span class="op">::</span><span class="kw">pmap</span>(<span class="kw">list</span>(resamp_data, scales, <span class="kw">rep</span>(pal, <span class="dv">5</span>), title, <span class="kw">rep</span>(direction, <span class="dv">5</span>)), </a>
<a class="sourceLine" id="cb123-19" data-line-number="19">              <span class="cf">function</span>(df, scale, pal, t, d){</a>
<a class="sourceLine" id="cb123-20" data-line-number="20">                <span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb123-21" data-line-number="21"><span class="st">                  </span><span class="kw">geom_stars</span>(<span class="dt">data =</span> df)<span class="op">+</span></a>
<a class="sourceLine" id="cb123-22" data-line-number="22"><span class="st">                  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> hills, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="fl">0.3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb123-23" data-line-number="23"><span class="st">                  </span><span class="kw">scale_fill_scico</span>(<span class="dt">palette =</span> pal, <span class="dt">direction =</span> d,</a>
<a class="sourceLine" id="cb123-24" data-line-number="24">                                   <span class="dt">label =</span> comma, <span class="dt">na.value =</span> <span class="ot">NA</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb123-25" data-line-number="25"><span class="st">                  </span><span class="kw">coord_sf</span>(<span class="dt">xlim =</span> bbox[<span class="kw">c</span>(<span class="st">&quot;xmin&quot;</span>, <span class="st">&quot;xmax&quot;</span>)],</a>
<a class="sourceLine" id="cb123-26" data-line-number="26">                           <span class="dt">ylim =</span> bbox[<span class="kw">c</span>(<span class="st">&quot;ymin&quot;</span>, <span class="st">&quot;ymax&quot;</span>)])<span class="op">+</span></a>
<a class="sourceLine" id="cb123-27" data-line-number="27"><span class="st">                  </span><span class="kw">theme_void</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb123-28" data-line-number="28"><span class="st">                  </span><span class="kw">theme</span>(<span class="co">#legend.position = &quot;top&quot;,</span></a>
<a class="sourceLine" id="cb123-29" data-line-number="29">                    <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(),</a>
<a class="sourceLine" id="cb123-30" data-line-number="30">                        <span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">size =</span> <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb123-31" data-line-number="31">                        <span class="co"># legend.key.height = unit(0.1, &quot;cm&quot;),</span></a>
<a class="sourceLine" id="cb123-32" data-line-number="32">                        <span class="co"># legend.key.width = unit(0.6, &quot;cm&quot;),</span></a>
<a class="sourceLine" id="cb123-33" data-line-number="33">                        <span class="co"># legend.text = element_text(size = 8),</span></a>
<a class="sourceLine" id="cb123-34" data-line-number="34">                        <span class="dt">axis.title =</span> <span class="kw">element_text</span>(),</a>
<a class="sourceLine" id="cb123-35" data-line-number="35">                        <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>),</a>
<a class="sourceLine" id="cb123-36" data-line-number="36">                        <span class="co"># axis.text.y = element_text(angle = 90, hjust = 0.5),</span></a>
<a class="sourceLine" id="cb123-37" data-line-number="37">                        <span class="co"># panel.background = element_rect(fill = &quot;lightblue&quot;),</span></a>
<a class="sourceLine" id="cb123-38" data-line-number="38">                        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>())<span class="op">+</span></a>
<a class="sourceLine" id="cb123-39" data-line-number="39"><span class="st">                  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="ot">NULL</span>, <span class="dt">y=</span>scale, <span class="dt">title =</span> t)</a>
<a class="sourceLine" id="cb123-40" data-line-number="40">              })</a>
<a class="sourceLine" id="cb123-41" data-line-number="41">fig_list_chelsa_resamp &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(fig_list_chelsa_resamp, as_grob)</a>
<a class="sourceLine" id="cb123-42" data-line-number="42"></a>
<a class="sourceLine" id="cb123-43" data-line-number="43">fig_chelsa_resamp &lt;-<span class="st"> </span><span class="kw">grid.arrange</span>(<span class="dt">grobs =</span> fig_list_chelsa_resamp, <span class="dt">ncol=</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb123-44" data-line-number="44"><span class="kw">ggsave</span>(<span class="dt">plot =</span> fig_chelsa_resamp, <span class="dt">filename =</span> <span class="st">&quot;figs/fig_chelsa_resamp.png&quot;</span>, <span class="dt">dpi =</span> <span class="dv">100</span>, <span class="dt">width =</span> <span class="dv">24</span>, <span class="dt">height =</span> <span class="dv">12</span>, <span class="dt">device =</span> <span class="kw">png</span>(), <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>)</a>
<a class="sourceLine" id="cb123-45" data-line-number="45"></a>
<a class="sourceLine" id="cb123-46" data-line-number="46"><span class="co"># use magick to convert</span></a>
<a class="sourceLine" id="cb123-47" data-line-number="47"><span class="kw">library</span>(magick)</a>
<a class="sourceLine" id="cb123-48" data-line-number="48">pl &lt;-<span class="st"> </span><span class="kw">image_read_pdf</span>(<span class="st">&quot;figs/fig_chelsa_resamp.pdf&quot;</span>)</a>
<a class="sourceLine" id="cb123-49" data-line-number="49"><span class="kw">image_write</span>(pl, <span class="dt">path =</span> <span class="st">&quot;figs/fig_chelsa_resamp.png&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1"><span class="co"># show exported image</span></a>
<a class="sourceLine" id="cb124-2" data-line-number="2">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_chelsa_resamp.png&quot;</span>)</a></code></pre></div>
<div class="figure">
<img src="figs/fig_chelsa_resamp.png" alt="CHELSA rasters with study area outline, at different scales. Semivariograms are on a log-transformed y-axis."  />
<p class="caption">
(#fig:show_fig_chelsa_resamp)CHELSA rasters with study area outline, at different scales. Semivariograms are on a log-transformed y-axis.
</p>
</div>

</div>
</div>
<div id="matching-effort-with-spatial-independence" class="section level2">
<h2><span class="header-section-number">9.9</span> Matching effort with spatial independence</h2>
<p>How many sites would be lost if effort distance was restricted based on spatial independence?</p>
<div id="load-librarires" class="section level3">
<h3><span class="header-section-number">9.9.1</span> Load librarires</h3>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1"><span class="co"># load data packagaes</span></a>
<a class="sourceLine" id="cb125-2" data-line-number="2"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb125-3" data-line-number="3"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb125-4" data-line-number="4"></a>
<a class="sourceLine" id="cb125-5" data-line-number="5"><span class="co"># load plotting packages</span></a>
<a class="sourceLine" id="cb125-6" data-line-number="6"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb125-7" data-line-number="7"><span class="kw">library</span>(scico)</a>
<a class="sourceLine" id="cb125-8" data-line-number="8"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb125-9" data-line-number="9"><span class="kw">library</span>(scales)</a></code></pre></div>
</div>
<div id="load-data" class="section level3">
<h3><span class="header-section-number">9.9.2</span> Load data</h3>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="co"># load checklist covariates</span></a>
<a class="sourceLine" id="cb126-2" data-line-number="2">data &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/eBirdChecklistVars.csv&quot;</span>)</a>
<a class="sourceLine" id="cb126-3" data-line-number="3"></a>
<a class="sourceLine" id="cb126-4" data-line-number="4">effort_distance_summary &lt;-<span class="st"> </span>data[, effort_distance_class <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">cut</span>(distance, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.001</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">2.5</span>, <span class="dv">5</span>, <span class="ot">Inf</span>), <span class="dt">ordered_result =</span> T)</a>
<a class="sourceLine" id="cb126-5" data-line-number="5">     ][,.N, by =<span class="st"> </span>effort_distance_class</a>
<a class="sourceLine" id="cb126-6" data-line-number="6">       ][<span class="kw">order</span>(effort_distance_class)]</a>
<a class="sourceLine" id="cb126-7" data-line-number="7"></a>
<a class="sourceLine" id="cb126-8" data-line-number="8">effort_distance_summary[,prop_effort<span class="op">:</span><span class="er">=</span><span class="kw">cumsum</span>(effort_distance_summary<span class="op">$</span>N)<span class="op">/</span><span class="kw">nrow</span>(data)]</a></code></pre></div>
</div>
<div id="plot-distance-exclusion-effect" class="section level3">
<h3><span class="header-section-number">9.9.3</span> Plot distance exclusion effect</h3>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1"><span class="co"># plot effort distance class cumulative sum</span></a>
<a class="sourceLine" id="cb127-2" data-line-number="2">fig_dist_exclusion &lt;-<span class="st"> </span><span class="kw">ggplot</span>(effort_distance_summary)<span class="op">+</span></a>
<a class="sourceLine" id="cb127-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(effort_distance_class, prop_effort), <span class="dt">size =</span> <span class="dv">3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb127-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(effort_distance_class, prop_effort, <span class="dt">group =</span> <span class="ot">NA</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb127-5" data-line-number="5"><span class="st">  </span><span class="co"># scale_y_continuous(label=label_number(scale=0.001, accuracy = 1, suffix = &quot;K&quot;))+</span></a>
<a class="sourceLine" id="cb127-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;stationary&quot;</span>, <span class="st">&quot;100m&quot;</span>, <span class="st">&quot;250m&quot;</span>, <span class="st">&quot;500m&quot;</span>, <span class="st">&quot;1 km&quot;</span>, <span class="st">&quot;2.5 km&quot;</span>, <span class="st">&quot;5 km&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb127-7" data-line-number="7"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb127-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_line</span>(<span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="st">&quot;grey&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb127-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;effort distance cutoff&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;proportion of checklists&quot;</span>)</a>
<a class="sourceLine" id="cb127-10" data-line-number="10"></a>
<a class="sourceLine" id="cb127-11" data-line-number="11"><span class="kw">ggsave</span>(<span class="dt">plot =</span> fig_dist_exclusion, <span class="st">&quot;figs/fig_cutoff_effort.png&quot;</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">dpi =</span> <span class="dv">300</span>)</a>
<a class="sourceLine" id="cb127-12" data-line-number="12"><span class="kw">dev.off</span>()</a></code></pre></div>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_cutoff_effort.png&quot;</span>)</a></code></pre></div>
<p><img src="figs/fig_cutoff_effort.png" /><!-- --></p>

</div>
</div>
<div id="spatial-thinning-a-comparison-of-approaches" class="section level2">
<h2><span class="header-section-number">9.10</span> Spatial thinning: A comparison of approaches</h2>
<div id="prepare-libraries-9" class="section level3">
<h3><span class="header-section-number">9.10.1</span> Prepare libraries</h3>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1"><span class="co"># load libraries</span></a>
<a class="sourceLine" id="cb129-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb129-3" data-line-number="3"><span class="kw">library</span>(glue)</a>
<a class="sourceLine" id="cb129-4" data-line-number="4"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb129-5" data-line-number="5"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb129-6" data-line-number="6"></a>
<a class="sourceLine" id="cb129-7" data-line-number="7"><span class="co"># plotting</span></a>
<a class="sourceLine" id="cb129-8" data-line-number="8"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb129-9" data-line-number="9"><span class="kw">library</span>(scico)</a>
<a class="sourceLine" id="cb129-10" data-line-number="10"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb129-11" data-line-number="11"></a>
<a class="sourceLine" id="cb129-12" data-line-number="12"><span class="co"># ci func</span></a>
<a class="sourceLine" id="cb129-13" data-line-number="13">ci &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span><span class="kw">sd</span>(x, <span class="dt">na.rm =</span> T)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">length</span>(x))}</a>
<a class="sourceLine" id="cb129-14" data-line-number="14"></a>
<a class="sourceLine" id="cb129-15" data-line-number="15"><span class="co"># load python libs here</span></a>
<a class="sourceLine" id="cb129-16" data-line-number="16"><span class="kw">library</span>(reticulate)</a>
<a class="sourceLine" id="cb129-17" data-line-number="17"><span class="co"># set python path</span></a>
<a class="sourceLine" id="cb129-18" data-line-number="18"><span class="kw">use_python</span>(<span class="st">&quot;/usr/bin/python3&quot;</span>)</a></code></pre></div>
</div>
<div id="traditional-grid-based-thinning" class="section level3">
<h3><span class="header-section-number">9.10.2</span> Traditional grid-based thinning</h3>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1"><span class="co"># load the shapefile of the study area</span></a>
<a class="sourceLine" id="cb130-2" data-line-number="2">wg &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/spatial/hillsShapefile/Nil_Ana_Pal.shp&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-3" data-line-number="3"><span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">32643</span>)</a>
<a class="sourceLine" id="cb130-4" data-line-number="4"></a>
<a class="sourceLine" id="cb130-5" data-line-number="5"><span class="co"># get scales</span></a>
<a class="sourceLine" id="cb130-6" data-line-number="6"><span class="co"># load checklist data and select one per rounded 500m coordinates</span></a>
<a class="sourceLine" id="cb130-7" data-line-number="7">{</a>
<a class="sourceLine" id="cb130-8" data-line-number="8">  data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/eBirdChecklistVars.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-9" data-line-number="9"><span class="st">    </span><span class="kw">count</span>(longitude, latitude, <span class="dt">name =</span> <span class="st">&quot;tot_effort&quot;</span>)</a>
<a class="sourceLine" id="cb130-10" data-line-number="10">    </a>
<a class="sourceLine" id="cb130-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb130-12" data-line-number="12">  <span class="co"># how many unique points</span></a>
<a class="sourceLine" id="cb130-13" data-line-number="13">  n_all_points &lt;-<span class="st"> </span><span class="kw">nrow</span>(data)</a>
<a class="sourceLine" id="cb130-14" data-line-number="14">  d_all_effort &lt;-<span class="st"> </span><span class="kw">sum</span>(data<span class="op">$</span>tot_effort)</a>
<a class="sourceLine" id="cb130-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb130-16" data-line-number="16">  <span class="co"># round to different scales</span></a>
<a class="sourceLine" id="cb130-17" data-line-number="17">  scale &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">250</span>, <span class="dv">500</span>, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb130-18" data-line-number="18">  </a>
<a class="sourceLine" id="cb130-19" data-line-number="19">  <span class="co"># group data by scale</span></a>
<a class="sourceLine" id="cb130-20" data-line-number="20">  data &lt;-<span class="st"> </span><span class="kw">crossing</span>(scale, data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-21" data-line-number="21"><span class="st">    </span><span class="kw">group_by</span>(scale) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-22" data-line-number="22"><span class="st">    </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-23" data-line-number="23"><span class="st">    </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb130-24" data-line-number="24">}</a>
<a class="sourceLine" id="cb130-25" data-line-number="25"></a>
<a class="sourceLine" id="cb130-26" data-line-number="26"><span class="co"># select one point per grid cell</span></a>
<a class="sourceLine" id="cb130-27" data-line-number="27">data &lt;-<span class="st"> </span><span class="kw">mutate</span>(data, <span class="dt">data =</span> <span class="kw">map2</span>(scale, data, <span class="cf">function</span>(sc, df){</a>
<a class="sourceLine" id="cb130-28" data-line-number="28">  <span class="co"># transform the data</span></a>
<a class="sourceLine" id="cb130-29" data-line-number="29">  df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-30" data-line-number="30"><span class="st">    </span><span class="kw">st_as_sf</span>(<span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-31" data-line-number="31"><span class="st">    `</span><span class="dt">st_crs&lt;-</span><span class="st">`</span>(<span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-32" data-line-number="32"><span class="st">    </span><span class="kw">st_transform</span>(<span class="dv">32643</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-33" data-line-number="33"><span class="st">    </span><span class="kw">bind_cols</span>(<span class="kw">as_tibble</span>(<span class="kw">st_coordinates</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-34" data-line-number="34"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">coordId =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(.),</a>
<a class="sourceLine" id="cb130-35" data-line-number="35">           <span class="dt">X_round =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(X, sc),</a>
<a class="sourceLine" id="cb130-36" data-line-number="36">           <span class="dt">Y_round =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(Y, sc))</a>
<a class="sourceLine" id="cb130-37" data-line-number="37">  </a>
<a class="sourceLine" id="cb130-38" data-line-number="38">  <span class="co"># make a grid</span></a>
<a class="sourceLine" id="cb130-39" data-line-number="39">  grid &lt;-<span class="st"> </span><span class="kw">st_make_grid</span>(wg, <span class="dt">cellsize =</span> sc)</a>
<a class="sourceLine" id="cb130-40" data-line-number="40">  </a>
<a class="sourceLine" id="cb130-41" data-line-number="41">  <span class="co"># which cell contains which points</span></a>
<a class="sourceLine" id="cb130-42" data-line-number="42">  grid_contents &lt;-<span class="st"> </span><span class="kw">st_contains</span>(grid, df) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-43" data-line-number="43"><span class="st">    </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-44" data-line-number="44"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">cell =</span> row.id, <span class="dt">coordId =</span> col.id)</a>
<a class="sourceLine" id="cb130-45" data-line-number="45">  </a>
<a class="sourceLine" id="cb130-46" data-line-number="46">  <span class="kw">rm</span>(grid)</a>
<a class="sourceLine" id="cb130-47" data-line-number="47">  </a>
<a class="sourceLine" id="cb130-48" data-line-number="48">  <span class="co"># what&#39;s the max point in each grid</span></a>
<a class="sourceLine" id="cb130-49" data-line-number="49">  points_max &lt;-<span class="st"> </span><span class="kw">left_join</span>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_drop_geometry</span>(),</a>
<a class="sourceLine" id="cb130-50" data-line-number="50">                   grid_contents, <span class="dt">by =</span> <span class="st">&quot;coordId&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-51" data-line-number="51"><span class="st">    </span><span class="kw">group_by</span>(cell) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-52" data-line-number="52"><span class="st">    </span><span class="kw">filter</span>(tot_effort <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(tot_effort))</a>
<a class="sourceLine" id="cb130-53" data-line-number="53">  </a>
<a class="sourceLine" id="cb130-54" data-line-number="54">  <span class="co"># get summary for max</span></a>
<a class="sourceLine" id="cb130-55" data-line-number="55">  max_sites &lt;-<span class="st"> </span>points_max <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-56" data-line-number="56"><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-57" data-line-number="57"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">prop_points=</span> <span class="kw">length</span>(coordId)<span class="op">/</span>n_all_points,</a>
<a class="sourceLine" id="cb130-58" data-line-number="58">              <span class="dt">prop_effort =</span> <span class="kw">sum</span>(tot_effort)<span class="op">/</span>d_all_effort) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-59" data-line-number="59"><span class="st">    </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw">everything</span>(),</a>
<a class="sourceLine" id="cb130-60" data-line-number="60">                 <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>)</a>
<a class="sourceLine" id="cb130-61" data-line-number="61">  </a>
<a class="sourceLine" id="cb130-62" data-line-number="62">  <span class="co"># select a random point in each grid</span></a>
<a class="sourceLine" id="cb130-63" data-line-number="63">  points_rand &lt;-<span class="st"> </span><span class="kw">left_join</span>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_drop_geometry</span>(),</a>
<a class="sourceLine" id="cb130-64" data-line-number="64">                   grid_contents, <span class="dt">by =</span> <span class="st">&quot;coordId&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-65" data-line-number="65"><span class="st">    </span><span class="kw">group_by</span>(cell) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-66" data-line-number="66"><span class="st">    </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb130-67" data-line-number="67">  </a>
<a class="sourceLine" id="cb130-68" data-line-number="68">  <span class="co"># get summary for rand</span></a>
<a class="sourceLine" id="cb130-69" data-line-number="69">  rand_sites &lt;-<span class="st"> </span>points_rand <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-70" data-line-number="70"><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-71" data-line-number="71"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">prop_points =</span> <span class="kw">length</span>(coordId)<span class="op">/</span>n_all_points,</a>
<a class="sourceLine" id="cb130-72" data-line-number="72">              <span class="dt">prop_effort =</span> <span class="kw">sum</span>(tot_effort)<span class="op">/</span>d_all_effort) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-73" data-line-number="73"><span class="st">    </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw">everything</span>(),</a>
<a class="sourceLine" id="cb130-74" data-line-number="74">                 <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>)</a>
<a class="sourceLine" id="cb130-75" data-line-number="75">  </a>
<a class="sourceLine" id="cb130-76" data-line-number="76">  df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">grid_rand =</span> <span class="kw">list</span>(rand_sites), <span class="dt">grid_max =</span> <span class="kw">list</span>(max_sites),</a>
<a class="sourceLine" id="cb130-77" data-line-number="77">               <span class="dt">points_rand =</span> <span class="kw">list</span>(points_rand), <span class="dt">points_max =</span> <span class="kw">list</span>(points_max))</a>
<a class="sourceLine" id="cb130-78" data-line-number="78">}))</a>
<a class="sourceLine" id="cb130-79" data-line-number="79"></a>
<a class="sourceLine" id="cb130-80" data-line-number="80"><span class="co"># unnest data</span></a>
<a class="sourceLine" id="cb130-81" data-line-number="81">data &lt;-<span class="st"> </span><span class="kw">unnest</span>(data, <span class="dt">cols =</span> data)</a>
<a class="sourceLine" id="cb130-82" data-line-number="82"></a>
<a class="sourceLine" id="cb130-83" data-line-number="83"><span class="co"># save summary as another object</span></a>
<a class="sourceLine" id="cb130-84" data-line-number="84">data_thin_trad &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-85" data-line-number="85"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">contains</span>(<span class="st">&quot;points&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-86" data-line-number="86"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="op">-</span><span class="kw">contains</span>(<span class="st">&quot;scale&quot;</span>),</a>
<a class="sourceLine" id="cb130-87" data-line-number="87">               <span class="dt">names_to =</span> <span class="st">&quot;method&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;somedata&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-88" data-line-number="88"><span class="st">  </span><span class="kw">unnest</span>(<span class="dt">cols =</span> somedata)</a>
<a class="sourceLine" id="cb130-89" data-line-number="89"></a>
<a class="sourceLine" id="cb130-90" data-line-number="90"><span class="co"># save points for later comparison</span></a>
<a class="sourceLine" id="cb130-91" data-line-number="91">points_thin_trad &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-92" data-line-number="92"><span class="st">  </span><span class="kw">select</span>(<span class="kw">contains</span>(<span class="st">&quot;points&quot;</span>), scale)</a>
<a class="sourceLine" id="cb130-93" data-line-number="93"></a>
<a class="sourceLine" id="cb130-94" data-line-number="94"><span class="kw">rm</span>(data)</a></code></pre></div>
</div>
<div id="network-based-thinning" class="section level3">
<h3><span class="header-section-number">9.10.3</span> Network-based thinning</h3>
<p>Load python libraries.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb131-1" data-line-number="1"><span class="co"># import classic python libs</span></a>
<a class="sourceLine" id="cb131-2" data-line-number="2"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb131-3" data-line-number="3"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
<a class="sourceLine" id="cb131-4" data-line-number="4"></a>
<a class="sourceLine" id="cb131-5" data-line-number="5"><span class="co"># libs for dataframes</span></a>
<a class="sourceLine" id="cb131-6" data-line-number="6"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb131-7" data-line-number="7"></a>
<a class="sourceLine" id="cb131-8" data-line-number="8"><span class="co"># network lib</span></a>
<a class="sourceLine" id="cb131-9" data-line-number="9"><span class="im">import</span> networkx <span class="im">as</span> nx</a>
<a class="sourceLine" id="cb131-10" data-line-number="10"></a>
<a class="sourceLine" id="cb131-11" data-line-number="11"><span class="co"># import libs for geodata</span></a>
<a class="sourceLine" id="cb131-12" data-line-number="12"><span class="im">import</span> geopandas <span class="im">as</span> gpd</a>
<a class="sourceLine" id="cb131-13" data-line-number="13"></a>
<a class="sourceLine" id="cb131-14" data-line-number="14"><span class="co"># import ckdtree</span></a>
<a class="sourceLine" id="cb131-15" data-line-number="15"><span class="im">from</span> scipy.spatial <span class="im">import</span> cKDTree</a></code></pre></div>
<div id="finding-modularity-in-proximity-networks" class="section level4">
<h4><span class="header-section-number">9.10.3.1</span> Finding modularity in proximity networks</h4>
<div class="sourceCode" id="cb132"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb132-1" data-line-number="1"><span class="co"># read in checklist covariates for conversion to gpd</span></a>
<a class="sourceLine" id="cb132-2" data-line-number="2"><span class="co"># get unique coordinates, assign them to the df</span></a>
<a class="sourceLine" id="cb132-3" data-line-number="3"><span class="co"># convert df to geo-df</span></a>
<a class="sourceLine" id="cb132-4" data-line-number="4">chkCovars <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/eBirdChecklistVars.csv&quot;</span>)</a>
<a class="sourceLine" id="cb132-5" data-line-number="5">ul <span class="op">=</span> chkCovars[[<span class="st">&#39;longitude&#39;</span>, <span class="st">&#39;latitude&#39;</span>]].drop_duplicates(subset<span class="op">=</span>[<span class="st">&#39;longitude&#39;</span>, <span class="st">&#39;latitude&#39;</span>])</a>
<a class="sourceLine" id="cb132-6" data-line-number="6">ul[<span class="st">&#39;coordId&#39;</span>] <span class="op">=</span> np.arange(<span class="dv">0</span>, ul.shape[<span class="dv">0</span>])</a>
<a class="sourceLine" id="cb132-7" data-line-number="7"></a>
<a class="sourceLine" id="cb132-8" data-line-number="8"><span class="co"># get effort at each coordinate</span></a>
<a class="sourceLine" id="cb132-9" data-line-number="9">effort <span class="op">=</span> chkCovars.groupby([<span class="st">&#39;longitude&#39;</span>, <span class="st">&#39;latitude&#39;</span>]).size().to_frame(<span class="st">&#39;tot_effort&#39;</span>)</a>
<a class="sourceLine" id="cb132-10" data-line-number="10">effort <span class="op">=</span> effort.reset_index()</a>
<a class="sourceLine" id="cb132-11" data-line-number="11"></a>
<a class="sourceLine" id="cb132-12" data-line-number="12"><span class="co"># merge effort on ul</span></a>
<a class="sourceLine" id="cb132-13" data-line-number="13">ul <span class="op">=</span> pd.merge(ul, effort, on<span class="op">=</span>[<span class="st">&#39;longitude&#39;</span>, <span class="st">&#39;latitude&#39;</span>])</a>
<a class="sourceLine" id="cb132-14" data-line-number="14"></a>
<a class="sourceLine" id="cb132-15" data-line-number="15"><span class="co"># make gpd and drop col from ul</span></a>
<a class="sourceLine" id="cb132-16" data-line-number="16">ulgpd <span class="op">=</span> gpd.GeoDataFrame(ul, geometry<span class="op">=</span>gpd.points_from_xy(ul.longitude, ul.latitude))</a>
<a class="sourceLine" id="cb132-17" data-line-number="17">ulgpd.crs <span class="op">=</span> {<span class="st">&#39;init&#39;</span> :<span class="st">&#39;epsg:4326&#39;</span>}</a>
<a class="sourceLine" id="cb132-18" data-line-number="18"><span class="co"># reproject spatials to 43n epsg 32643</span></a>
<a class="sourceLine" id="cb132-19" data-line-number="19">ulgpd <span class="op">=</span> ulgpd.to_crs({<span class="st">&#39;init&#39;</span>: <span class="st">&#39;epsg:32643&#39;</span>})</a>
<a class="sourceLine" id="cb132-20" data-line-number="20">ul <span class="op">=</span> pd.DataFrame(ul.drop(columns<span class="op">=</span><span class="st">&quot;geometry&quot;</span>))</a>
<a class="sourceLine" id="cb132-21" data-line-number="21"></a>
<a class="sourceLine" id="cb132-22" data-line-number="22"><span class="co"># function to use ckdtrees for nearest point finding</span></a>
<a class="sourceLine" id="cb132-23" data-line-number="23"><span class="kw">def</span> ckd_pairs(gdfA, dist_indep):</a>
<a class="sourceLine" id="cb132-24" data-line-number="24">    A <span class="op">=</span> np.concatenate([np.array(geom.coords) <span class="cf">for</span> geom <span class="kw">in</span> gdfA.geometry.to_list()])</a>
<a class="sourceLine" id="cb132-25" data-line-number="25">    ckd_tree <span class="op">=</span> cKDTree(A)</a>
<a class="sourceLine" id="cb132-26" data-line-number="26">    dist <span class="op">=</span> ckd_tree.query_pairs(r<span class="op">=</span>dist_indep, output_type<span class="op">=</span><span class="st">&#39;ndarray&#39;</span>)</a>
<a class="sourceLine" id="cb132-27" data-line-number="27">    <span class="cf">return</span> dist</a>
<a class="sourceLine" id="cb132-28" data-line-number="28"></a>
<a class="sourceLine" id="cb132-29" data-line-number="29"><span class="co"># define scales in metres</span></a>
<a class="sourceLine" id="cb132-30" data-line-number="30">scales <span class="op">=</span> [<span class="dv">100</span>, <span class="dv">250</span>, <span class="dv">500</span>, <span class="dv">1000</span>]</a>
<a class="sourceLine" id="cb132-31" data-line-number="31"></a>
<a class="sourceLine" id="cb132-32" data-line-number="32"></a>
<a class="sourceLine" id="cb132-33" data-line-number="33"><span class="co"># function to process ckd_pairs</span></a>
<a class="sourceLine" id="cb132-34" data-line-number="34"><span class="kw">def</span> make_modules(scale):</a>
<a class="sourceLine" id="cb132-35" data-line-number="35">    site_pairs <span class="op">=</span> ckd_pairs(gdfA<span class="op">=</span>ulgpd, dist_indep<span class="op">=</span>scale)</a>
<a class="sourceLine" id="cb132-36" data-line-number="36">    site_pairs <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>site_pairs, columns<span class="op">=</span>[<span class="st">&#39;p1&#39;</span>, <span class="st">&#39;p2&#39;</span>])</a>
<a class="sourceLine" id="cb132-37" data-line-number="37">    site_pairs[<span class="st">&#39;scale&#39;</span>] <span class="op">=</span> scale</a>
<a class="sourceLine" id="cb132-38" data-line-number="38">    <span class="co"># get site ids</span></a>
<a class="sourceLine" id="cb132-39" data-line-number="39">    site_id <span class="op">=</span> np.concatenate((site_pairs.p1.unique(), site_pairs.p2.unique()))</a>
<a class="sourceLine" id="cb132-40" data-line-number="40">    site_id <span class="op">=</span> np.unique(site_id)</a>
<a class="sourceLine" id="cb132-41" data-line-number="41">    <span class="co"># make network</span></a>
<a class="sourceLine" id="cb132-42" data-line-number="42">    network <span class="op">=</span> nx.from_pandas_edgelist(site_pairs, <span class="st">&#39;p1&#39;</span>, <span class="st">&#39;p2&#39;</span>)</a>
<a class="sourceLine" id="cb132-43" data-line-number="43">    <span class="co"># get modules</span></a>
<a class="sourceLine" id="cb132-44" data-line-number="44">    modules <span class="op">=</span> <span class="bu">list</span>(nx.algorithms.community.greedy_modularity_communities(network))</a>
<a class="sourceLine" id="cb132-45" data-line-number="45">    <span class="co"># get modules as df</span></a>
<a class="sourceLine" id="cb132-46" data-line-number="46">    m <span class="op">=</span> []</a>
<a class="sourceLine" id="cb132-47" data-line-number="47">    <span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="bu">len</span>(modules)):</a>
<a class="sourceLine" id="cb132-48" data-line-number="48">        module_number <span class="op">=</span> [i] <span class="op">*</span> <span class="bu">len</span>(modules[i])</a>
<a class="sourceLine" id="cb132-49" data-line-number="49">        module_coords <span class="op">=</span> <span class="bu">list</span>(modules[i])</a>
<a class="sourceLine" id="cb132-50" data-line-number="50">        m <span class="op">=</span> m <span class="op">+</span> <span class="bu">list</span>(<span class="bu">zip</span>(module_number, module_coords))</a>
<a class="sourceLine" id="cb132-51" data-line-number="51">    <span class="co"># add location and summed sampling duration</span></a>
<a class="sourceLine" id="cb132-52" data-line-number="52">    unique_locs <span class="op">=</span> ul[ul.coordId.isin(site_id)]</a>
<a class="sourceLine" id="cb132-53" data-line-number="53">    module_data <span class="op">=</span> pd.DataFrame(m, columns<span class="op">=</span>[<span class="st">&#39;module&#39;</span>, <span class="st">&#39;coordId&#39;</span>])</a>
<a class="sourceLine" id="cb132-54" data-line-number="54">    module_data <span class="op">=</span> pd.merge(module_data, unique_locs, on<span class="op">=</span><span class="st">&#39;coordId&#39;</span>)</a>
<a class="sourceLine" id="cb132-55" data-line-number="55">    <span class="co"># add scale</span></a>
<a class="sourceLine" id="cb132-56" data-line-number="56">    module_data[<span class="st">&#39;scale&#39;</span>] <span class="op">=</span> scale</a>
<a class="sourceLine" id="cb132-57" data-line-number="57">    <span class="cf">return</span> [site_pairs, module_data]</a>
<a class="sourceLine" id="cb132-58" data-line-number="58"></a>
<a class="sourceLine" id="cb132-59" data-line-number="59"></a>
<a class="sourceLine" id="cb132-60" data-line-number="60"><span class="co"># run make modules on ulgpd at scales</span></a>
<a class="sourceLine" id="cb132-61" data-line-number="61">data <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(make_modules, scales))</a>
<a class="sourceLine" id="cb132-62" data-line-number="62"></a>
<a class="sourceLine" id="cb132-63" data-line-number="63"><span class="co"># extract data for output</span></a>
<a class="sourceLine" id="cb132-64" data-line-number="64">tot_pair_data <span class="op">=</span> []</a>
<a class="sourceLine" id="cb132-65" data-line-number="65">tot_module_data <span class="op">=</span> []</a>
<a class="sourceLine" id="cb132-66" data-line-number="66"><span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="bu">len</span>(data)):</a>
<a class="sourceLine" id="cb132-67" data-line-number="67">    tot_pair_data.append(data[i][<span class="dv">0</span>])</a>
<a class="sourceLine" id="cb132-68" data-line-number="68">    tot_module_data.append(data[i][<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb132-69" data-line-number="69"></a>
<a class="sourceLine" id="cb132-70" data-line-number="70">tot_pair_data <span class="op">=</span> pd.concat(tot_pair_data, ignore_index<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb132-71" data-line-number="71">tot_module_data <span class="op">=</span> pd.concat(tot_module_data, ignore_index<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb132-72" data-line-number="72"></a>
<a class="sourceLine" id="cb132-73" data-line-number="73"><span class="co"># make dict of positions and array of coordinates</span></a>
<a class="sourceLine" id="cb132-74" data-line-number="74"><span class="co"># site_id = np.concatenate((site_pairs.p1.unique(), site_pairs.p2.unique()))</span></a>
<a class="sourceLine" id="cb132-75" data-line-number="75"><span class="co"># site_id = np.unique(site_id)</span></a>
<a class="sourceLine" id="cb132-76" data-line-number="76"><span class="co"># locations_df = ul[ul.coordId.isin(site_id)][[&#39;longitude&#39;, &#39;latitude&#39;]].to_numpy()</span></a>
<a class="sourceLine" id="cb132-77" data-line-number="77"><span class="co"># pos_dict = dict(zip(site_id, locations_df))</span></a>
<a class="sourceLine" id="cb132-78" data-line-number="78"></a>
<a class="sourceLine" id="cb132-79" data-line-number="79"><span class="co"># output data</span></a>
<a class="sourceLine" id="cb132-80" data-line-number="80">tot_module_data.to_csv(path_or_buf<span class="op">=</span><span class="st">&quot;data/site_modules.csv&quot;</span>, index<span class="op">=</span><span class="va">False</span>)</a>
<a class="sourceLine" id="cb132-81" data-line-number="81">tot_pair_data.to_csv(path_or_buf<span class="op">=</span><span class="st">&quot;data/site_pairs.csv&quot;</span>, index<span class="op">=</span><span class="va">False</span>)</a>
<a class="sourceLine" id="cb132-82" data-line-number="82"></a>
<a class="sourceLine" id="cb132-83" data-line-number="83"><span class="co"># ends here</span></a></code></pre></div>
</div>
<div id="process-proximity-networks-in-r" class="section level4">
<h4><span class="header-section-number">9.10.3.2</span> Process proximity networks in R</h4>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1"><span class="co"># read in pair and module data</span></a>
<a class="sourceLine" id="cb133-2" data-line-number="2">pairs &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/site_pairs.csv&quot;</span>)</a>
<a class="sourceLine" id="cb133-3" data-line-number="3">mods &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/site_modules.csv&quot;</span>)</a>
<a class="sourceLine" id="cb133-4" data-line-number="4"></a>
<a class="sourceLine" id="cb133-5" data-line-number="5"><span class="co"># count pairs at each scale</span></a>
<a class="sourceLine" id="cb133-6" data-line-number="6"><span class="kw">count</span>(pairs, scale)</a>
<a class="sourceLine" id="cb133-7" data-line-number="7">pairs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb133-8" data-line-number="8"><span class="st">  </span><span class="kw">group_by</span>(scale) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb133-9" data-line-number="9"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">non_indep_pairs =</span> <span class="kw">length</span>(<span class="kw">unique</span>(<span class="kw">c</span>(p1, p2)))<span class="op">/</span>n_all_points)</a>
<a class="sourceLine" id="cb133-10" data-line-number="10"><span class="kw">count</span>(mods, scale)</a>
<a class="sourceLine" id="cb133-11" data-line-number="11"></a>
<a class="sourceLine" id="cb133-12" data-line-number="12"><span class="co"># nest by scale and add module data</span></a>
<a class="sourceLine" id="cb133-13" data-line-number="13">data &lt;-<span class="st"> </span><span class="kw">nest</span>(pairs, <span class="dt">data =</span> <span class="kw">c</span>(p1, p2))</a>
<a class="sourceLine" id="cb133-14" data-line-number="14">modules &lt;-<span class="st"> </span><span class="kw">group_by</span>(mods, scale) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb133-15" data-line-number="15"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb133-16" data-line-number="16"></a>
<a class="sourceLine" id="cb133-17" data-line-number="17"><span class="co"># add module data</span></a>
<a class="sourceLine" id="cb133-18" data-line-number="18">data &lt;-<span class="st"> </span><span class="kw">mutate</span>(data, </a>
<a class="sourceLine" id="cb133-19" data-line-number="19">               <span class="dt">modules =</span> modules<span class="op">$</span>data,</a>
<a class="sourceLine" id="cb133-20" data-line-number="20">               <span class="dt">data =</span> <span class="kw">map2</span>(data, modules, <span class="cf">function</span>(df, m){</a>
<a class="sourceLine" id="cb133-21" data-line-number="21">                 df &lt;-<span class="st"> </span><span class="kw">left_join</span>(df, m, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;p1&quot;</span> =<span class="st"> &quot;coordId&quot;</span>))</a>
<a class="sourceLine" id="cb133-22" data-line-number="22">                 df &lt;-<span class="st"> </span><span class="kw">left_join</span>(df, m, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;p2&quot;</span> =<span class="st"> &quot;coordId&quot;</span>))</a>
<a class="sourceLine" id="cb133-23" data-line-number="23">                 </a>
<a class="sourceLine" id="cb133-24" data-line-number="24">                 df &lt;-<span class="st"> </span><span class="kw">filter</span>(df, module.x <span class="op">==</span><span class="st"> </span>module.y)  </a>
<a class="sourceLine" id="cb133-25" data-line-number="25">                 <span class="kw">return</span>(df)</a>
<a class="sourceLine" id="cb133-26" data-line-number="26">               })) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb133-27" data-line-number="27"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>modules)</a>
<a class="sourceLine" id="cb133-28" data-line-number="28"></a>
<a class="sourceLine" id="cb133-29" data-line-number="29"><span class="co"># split by module</span></a>
<a class="sourceLine" id="cb133-30" data-line-number="30">data<span class="op">$</span>data &lt;-<span class="st"> </span><span class="kw">map</span>(data<span class="op">$</span>data, <span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb133-31" data-line-number="31">  df &lt;-<span class="st"> </span><span class="kw">group_by</span>(df, module.x, module.y) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb133-32" data-line-number="32"><span class="st">    </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb133-33" data-line-number="33"><span class="st">    </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb133-34" data-line-number="34">  <span class="kw">return</span>(df)</a>
<a class="sourceLine" id="cb133-35" data-line-number="35">})</a></code></pre></div>
</div>
<div id="a-function-that-removes-sites" class="section level4">
<h4><span class="header-section-number">9.10.3.3</span> A function that removes sites</h4>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1"><span class="co"># a function to remove sites</span></a>
<a class="sourceLine" id="cb134-2" data-line-number="2">remove_which_sites &lt;-<span class="st"> </span><span class="cf">function</span>(pair_data){</a>
<a class="sourceLine" id="cb134-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb134-4" data-line-number="4">  {</a>
<a class="sourceLine" id="cb134-5" data-line-number="5">    a =<span class="st"> </span>pair_data <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb134-6" data-line-number="6"><span class="st">      </span><span class="kw">select</span>(p1, p2)</a>
<a class="sourceLine" id="cb134-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb134-8" data-line-number="8">    nodes_a_init =<span class="st"> </span><span class="kw">unique</span>(<span class="kw">c</span>(a<span class="op">$</span>p1, a<span class="op">$</span>p2))</a>
<a class="sourceLine" id="cb134-9" data-line-number="9">    </a>
<a class="sourceLine" id="cb134-10" data-line-number="10">    i_n_d =<span class="st"> </span><span class="kw">filter</span>(mods, coordId <span class="op">%in%</span><span class="st"> </span>nodes_a_init) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb134-11" data-line-number="11"><span class="st">      </span><span class="kw">select</span>(<span class="dt">node =</span> coordId, tot_effort) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb134-12" data-line-number="12"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">s_f_r =</span> <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb134-13" data-line-number="13">    </a>
<a class="sourceLine" id="cb134-14" data-line-number="14">    nodes_keep =<span class="st"> </span><span class="kw">c</span>()</a>
<a class="sourceLine" id="cb134-15" data-line-number="15">    nodes_removed =<span class="st"> </span><span class="kw">c</span>()</a>
<a class="sourceLine" id="cb134-16" data-line-number="16">  }</a>
<a class="sourceLine" id="cb134-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb134-18" data-line-number="18">  <span class="cf">while</span>(<span class="kw">nrow</span>(a) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>){</a>
<a class="sourceLine" id="cb134-19" data-line-number="19">    </a>
<a class="sourceLine" id="cb134-20" data-line-number="20">    <span class="co"># how many nodes in a</span></a>
<a class="sourceLine" id="cb134-21" data-line-number="21">    nodes_a =<span class="st"> </span><span class="kw">unique</span>(<span class="kw">c</span>(a<span class="op">$</span>p1, a<span class="op">$</span>p2))</a>
<a class="sourceLine" id="cb134-22" data-line-number="22">    </a>
<a class="sourceLine" id="cb134-23" data-line-number="23">    <span class="co"># get node or site efforts and arrange in ascending order</span></a>
<a class="sourceLine" id="cb134-24" data-line-number="24">    b =<span class="st"> </span>i_n_d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(node <span class="op">%in%</span><span class="st"> </span>nodes_a)</a>
<a class="sourceLine" id="cb134-25" data-line-number="25">    </a>
<a class="sourceLine" id="cb134-26" data-line-number="26">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(b)){</a>
<a class="sourceLine" id="cb134-27" data-line-number="27">      <span class="co"># which node to remove</span></a>
<a class="sourceLine" id="cb134-28" data-line-number="28">      node_out =<span class="st"> </span>b<span class="op">$</span>node[i]</a>
<a class="sourceLine" id="cb134-29" data-line-number="29">      <span class="co"># how much tot_effort lost</span></a>
<a class="sourceLine" id="cb134-30" data-line-number="30">      d_n_o =<span class="st"> </span>b<span class="op">$</span>tot_effort[i]</a>
<a class="sourceLine" id="cb134-31" data-line-number="31">      </a>
<a class="sourceLine" id="cb134-32" data-line-number="32">      <span class="co"># how many rows remain in a if node_out is removed?</span></a>
<a class="sourceLine" id="cb134-33" data-line-number="33">      a_n_o =<span class="st"> </span><span class="kw">filter</span>(a, p1 <span class="op">!=</span><span class="st"> </span>node_out, p2 <span class="op">!=</span><span class="st"> </span>node_out)</a>
<a class="sourceLine" id="cb134-34" data-line-number="34">      indep_nodes =<span class="st"> </span><span class="kw">setdiff</span>(nodes_a, <span class="kw">unique</span>(<span class="kw">c</span>(a_n_o<span class="op">$</span>p1, a_n_o<span class="op">$</span>p2, node_out)))</a>
<a class="sourceLine" id="cb134-35" data-line-number="35">      </a>
<a class="sourceLine" id="cb134-36" data-line-number="36">      <span class="co"># how much sampling effort made spatially independent</span></a>
<a class="sourceLine" id="cb134-37" data-line-number="37">      indep_sampling =<span class="st"> </span><span class="kw">filter</span>(b, node <span class="op">%in%</span><span class="st"> </span>indep_nodes) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb134-38" data-line-number="38"><span class="st">        </span><span class="kw">summarise</span>(<span class="dt">tot_effort =</span> <span class="kw">sum</span>(tot_effort)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb134-39" data-line-number="39"><span class="st">        </span>.<span class="op">$</span>tot_effort</a>
<a class="sourceLine" id="cb134-40" data-line-number="40">      </a>
<a class="sourceLine" id="cb134-41" data-line-number="41">      <span class="co"># message(glue::glue(&#39;{node_out} removal frees {indep_sampling} m&#39;))</span></a>
<a class="sourceLine" id="cb134-42" data-line-number="42">      <span class="co"># sampling freed by sampling lost</span></a>
<a class="sourceLine" id="cb134-43" data-line-number="43">      b<span class="op">$</span>s_f_r[i] =<span class="st"> </span>indep_sampling<span class="op">/</span>d_n_o</a>
<a class="sourceLine" id="cb134-44" data-line-number="44">    }</a>
<a class="sourceLine" id="cb134-45" data-line-number="45">    </a>
<a class="sourceLine" id="cb134-46" data-line-number="46">    <span class="co"># arrange node data by decreasing sfr and increasing tot_effort</span></a>
<a class="sourceLine" id="cb134-47" data-line-number="47">    <span class="co"># highest tot_effort nodes are processed last</span></a>
<a class="sourceLine" id="cb134-48" data-line-number="48">    b =<span class="st"> </span><span class="kw">arrange</span>(b, <span class="op">-</span>s_f_r, tot_effort)</a>
<a class="sourceLine" id="cb134-49" data-line-number="49">    </a>
<a class="sourceLine" id="cb134-50" data-line-number="50">    nodes_removed =<span class="st"> </span><span class="kw">c</span>(nodes_removed, b<span class="op">$</span>node[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb134-51" data-line-number="51">    </a>
<a class="sourceLine" id="cb134-52" data-line-number="52">    <span class="co"># remove pairs of nodes containing the highest sfr node in b</span></a>
<a class="sourceLine" id="cb134-53" data-line-number="53">    a =<span class="st"> </span><span class="kw">filter</span>(a, p1 <span class="op">!=</span><span class="st"> </span>b<span class="op">$</span>node[<span class="dv">1</span>], p2 <span class="op">!=</span><span class="st"> </span>b<span class="op">$</span>node[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb134-54" data-line-number="54">    </a>
<a class="sourceLine" id="cb134-55" data-line-number="55">    nodes_keep =<span class="st"> </span><span class="kw">c</span>(nodes_keep, <span class="kw">setdiff</span>(nodes_a, <span class="kw">unique</span>(<span class="kw">c</span>(a<span class="op">$</span>p1, a<span class="op">$</span>p2, nodes_removed))))</a>
<a class="sourceLine" id="cb134-56" data-line-number="56">    </a>
<a class="sourceLine" id="cb134-57" data-line-number="57">  }</a>
<a class="sourceLine" id="cb134-58" data-line-number="58">  </a>
<a class="sourceLine" id="cb134-59" data-line-number="59">  <span class="kw">message</span>(glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&#39;keeping {length(nodes_keep)} of {length(nodes_a_init)}&#39;</span>))</a>
<a class="sourceLine" id="cb134-60" data-line-number="60">  </a>
<a class="sourceLine" id="cb134-61" data-line-number="61">  <span class="co"># node_status &lt;- tibble(nodes = c(nodes_keep, nodes_removed),</span></a>
<a class="sourceLine" id="cb134-62" data-line-number="62">  <span class="co">#                       status = c(rep(TRUE, length(nodes_keep)),</span></a>
<a class="sourceLine" id="cb134-63" data-line-number="63">  <span class="co">#                                  rep(FALSE, length(nodes_removed))))</span></a>
<a class="sourceLine" id="cb134-64" data-line-number="64">  </a>
<a class="sourceLine" id="cb134-65" data-line-number="65">  <span class="kw">return</span>(<span class="kw">as.integer</span>(nodes_removed))</a>
<a class="sourceLine" id="cb134-66" data-line-number="66">}</a></code></pre></div>
</div>
<div id="removing-non-independent-sites" class="section level4">
<h4><span class="header-section-number">9.10.3.4</span> Removing non-independent sites</h4>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="co"># remove 5km and 2.5km scale</span></a>
<a class="sourceLine" id="cb135-2" data-line-number="2">data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(scale <span class="op">&lt;=</span><span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb135-3" data-line-number="3"><span class="co"># run select sites on the various modules</span></a>
<a class="sourceLine" id="cb135-4" data-line-number="4">sites_removed &lt;-<span class="st"> </span><span class="kw">map</span>(data<span class="op">$</span>data, <span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb135-5" data-line-number="5">  remove_sites &lt;-<span class="st"> </span><span class="kw">unlist</span>(purrr<span class="op">::</span><span class="kw">map</span>(df<span class="op">$</span>data, remove_which_sites))</a>
<a class="sourceLine" id="cb135-6" data-line-number="6">})</a>
<a class="sourceLine" id="cb135-7" data-line-number="7"></a>
<a class="sourceLine" id="cb135-8" data-line-number="8"><span class="co"># save as rdata</span></a>
<a class="sourceLine" id="cb135-9" data-line-number="9"><span class="kw">save</span>(sites_removed, <span class="dt">file =</span> <span class="st">&quot;data/data_network_sites_removed.rdata&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1"><span class="co"># get python sites</span></a>
<a class="sourceLine" id="cb136-2" data-line-number="2">ul =<span class="st"> </span>py<span class="op">$</span>ul</a>
<a class="sourceLine" id="cb136-3" data-line-number="3"></a>
<a class="sourceLine" id="cb136-4" data-line-number="4"><span class="kw">load</span>(<span class="st">&quot;data/data_network_sites_removed.rdata&quot;</span>)</a>
<a class="sourceLine" id="cb136-5" data-line-number="5"></a>
<a class="sourceLine" id="cb136-6" data-line-number="6"><span class="co"># subset sites</span></a>
<a class="sourceLine" id="cb136-7" data-line-number="7">data &lt;-<span class="st"> </span><span class="kw">mutate</span>(data,</a>
<a class="sourceLine" id="cb136-8" data-line-number="8">               <span class="dt">data =</span> <span class="kw">map</span>(sites_removed, <span class="cf">function</span>(site_id){</a>
<a class="sourceLine" id="cb136-9" data-line-number="9">                 <span class="kw">as_tibble</span>(<span class="kw">filter</span>(ul, <span class="op">!</span>coordId <span class="op">%in%</span><span class="st"> </span>site_id))</a>
<a class="sourceLine" id="cb136-10" data-line-number="10">               }))</a>
<a class="sourceLine" id="cb136-11" data-line-number="11"></a>
<a class="sourceLine" id="cb136-12" data-line-number="12"><span class="co"># which points are kept</span></a>
<a class="sourceLine" id="cb136-13" data-line-number="13">points_thin_net &lt;-<span class="st"> </span><span class="kw">mutate</span>(data,</a>
<a class="sourceLine" id="cb136-14" data-line-number="14">                          <span class="dt">data =</span> <span class="kw">map</span>(data,<span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb136-15" data-line-number="15">                            df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-16" data-line-number="16"><span class="st">                              </span><span class="kw">select</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-17" data-line-number="17"><span class="st">                              </span><span class="kw">st_as_sf</span>(<span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-18" data-line-number="18"><span class="st">                              `</span><span class="dt">st_crs&lt;-</span><span class="st">`</span>(<span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-19" data-line-number="19"><span class="st">                              </span><span class="kw">st_transform</span>(<span class="dv">32643</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-20" data-line-number="20"><span class="st">                              </span><span class="kw">bind_cols</span>(<span class="kw">as_tibble</span>(<span class="kw">st_coordinates</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-21" data-line-number="21"><span class="st">                              </span><span class="kw">st_drop_geometry</span>()</a>
<a class="sourceLine" id="cb136-22" data-line-number="22">                          }))</a>
<a class="sourceLine" id="cb136-23" data-line-number="23"></a>
<a class="sourceLine" id="cb136-24" data-line-number="24"><span class="co"># get metrics for method</span></a>
<a class="sourceLine" id="cb136-25" data-line-number="25">data_thin_net &lt;-<span class="st"> </span><span class="kw">unnest</span>(data, <span class="dt">cols =</span> <span class="st">&quot;data&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-26" data-line-number="26"><span class="st">  </span><span class="kw">group_by</span>(scale) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-27" data-line-number="27"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prop_points =</span> <span class="kw">length</span>(coordId)<span class="op">/</span>n_all_points,</a>
<a class="sourceLine" id="cb136-28" data-line-number="28">            <span class="dt">prop_effort =</span> <span class="kw">sum</span>(tot_effort)<span class="op">/</span>d_all_effort) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-29" data-line-number="29"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">method =</span> <span class="st">&quot;network&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-30" data-line-number="30"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="op">-</span><span class="kw">one_of</span>(<span class="kw">c</span>(<span class="st">&quot;method&quot;</span>, <span class="st">&quot;scale&quot;</span>)),</a>
<a class="sourceLine" id="cb136-31" data-line-number="31">               <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="measuring-method-fallibility" class="section level3">
<h3><span class="header-section-number">9.10.4</span> Measuring method fallibility</h3>
<p>How many points, at different spatial scales, remain after the application of each method?</p>
<div id="prepare-data-for-python" class="section level4">
<h4><span class="header-section-number">9.10.4.1</span> Prepare data for Python</h4>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1"><span class="co"># get points by each method</span></a>
<a class="sourceLine" id="cb137-2" data-line-number="2">points_list &lt;-<span class="st"> </span><span class="kw">append</span>(points_thin_net<span class="op">$</span>data, <span class="dt">values =</span> <span class="kw">append</span>(points_thin_trad<span class="op">$</span>points_rand,</a>
<a class="sourceLine" id="cb137-3" data-line-number="3">                                                            points_thin_trad<span class="op">$</span>points_max))</a>
<a class="sourceLine" id="cb137-4" data-line-number="4"></a>
<a class="sourceLine" id="cb137-5" data-line-number="5"><span class="co"># get scales as list</span></a>
<a class="sourceLine" id="cb137-6" data-line-number="6">scales_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">100</span>,<span class="dv">250</span>,<span class="dv">500</span>,<span class="dv">1000</span>, <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">100</span>,<span class="dv">250</span>, <span class="dv">500</span>,<span class="dv">1000</span>), <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">flatten</span>()</a>
<a class="sourceLine" id="cb137-7" data-line-number="7"></a>
<a class="sourceLine" id="cb137-8" data-line-number="8"><span class="co"># send to python</span></a>
<a class="sourceLine" id="cb137-9" data-line-number="9">py<span class="op">$</span>points_list =<span class="st"> </span>points_list</a>
<a class="sourceLine" id="cb137-10" data-line-number="10">py<span class="op">$</span>scales_list =<span class="st"> </span>scales_list</a></code></pre></div>
</div>
<div id="count-props-under-threshold-in-python" class="section level4">
<h4><span class="header-section-number">9.10.4.2</span> Count props under threshold in Python</h4>
<div class="sourceCode" id="cb138"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb138-1" data-line-number="1"><span class="co"># transform each element to gpd</span></a>
<a class="sourceLine" id="cb138-2" data-line-number="2"></a>
<a class="sourceLine" id="cb138-3" data-line-number="3"></a>
<a class="sourceLine" id="cb138-4" data-line-number="4"><span class="co"># a function to convert to gpd</span></a>
<a class="sourceLine" id="cb138-5" data-line-number="5"><span class="kw">def</span> make_gpd(df):</a>
<a class="sourceLine" id="cb138-6" data-line-number="6">    df <span class="op">=</span> gpd.GeoDataFrame(df, geometry<span class="op">=</span>gpd.points_from_xy(df.X, df.Y))</a>
<a class="sourceLine" id="cb138-7" data-line-number="7">    df.crs <span class="op">=</span> {<span class="st">&#39;init&#39;</span> :<span class="st">&#39;epsg:32643&#39;</span>}</a>
<a class="sourceLine" id="cb138-8" data-line-number="8">    <span class="cf">return</span> df</a>
<a class="sourceLine" id="cb138-9" data-line-number="9"></a>
<a class="sourceLine" id="cb138-10" data-line-number="10"></a>
<a class="sourceLine" id="cb138-11" data-line-number="11"><span class="co"># function for mean nnd</span></a>
<a class="sourceLine" id="cb138-12" data-line-number="12"><span class="co"># function to use ckdtrees for nearest point finding</span></a>
<a class="sourceLine" id="cb138-13" data-line-number="13"><span class="kw">def</span> ckd_test(gdfA, gdfB, dist_indep):</a>
<a class="sourceLine" id="cb138-14" data-line-number="14">    A <span class="op">=</span> np.concatenate([np.array(geom.coords) <span class="cf">for</span> geom <span class="kw">in</span> gdfA.geometry.to_list()])</a>
<a class="sourceLine" id="cb138-15" data-line-number="15">    <span class="co">#simplified_features = simplify_roads(gdfB)</span></a>
<a class="sourceLine" id="cb138-16" data-line-number="16">    B <span class="op">=</span> np.concatenate([np.array(geom.coords) <span class="cf">for</span> geom <span class="kw">in</span> gdfB.geometry.to_list()])</a>
<a class="sourceLine" id="cb138-17" data-line-number="17">    <span class="co">#B = np.concatenate(B)</span></a>
<a class="sourceLine" id="cb138-18" data-line-number="18">    ckd_tree <span class="op">=</span> cKDTree(B)</a>
<a class="sourceLine" id="cb138-19" data-line-number="19">    dist, idx <span class="op">=</span> ckd_tree.query(A, k<span class="op">=</span>[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb138-20" data-line-number="20">    dist_diff <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: x <span class="op">-</span> dist_indep, dist))</a>
<a class="sourceLine" id="cb138-21" data-line-number="21">    mean_dist_diff <span class="op">=</span> np.asarray(dist_diff).mean()</a>
<a class="sourceLine" id="cb138-22" data-line-number="22">    <span class="cf">return</span> mean_dist_diff</a>
<a class="sourceLine" id="cb138-23" data-line-number="23"></a>
<a class="sourceLine" id="cb138-24" data-line-number="24"></a>
<a class="sourceLine" id="cb138-25" data-line-number="25"><span class="co"># apply to all data</span></a>
<a class="sourceLine" id="cb138-26" data-line-number="26">points_list <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(make_gpd, points_list))</a>
<a class="sourceLine" id="cb138-27" data-line-number="27"></a>
<a class="sourceLine" id="cb138-28" data-line-number="28"><span class="co"># get nnb all data</span></a>
<a class="sourceLine" id="cb138-29" data-line-number="29">mean_dist_diff <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(ckd_test, points_list, points_list, scales_list))</a>
<a class="sourceLine" id="cb138-30" data-line-number="30"></a>
<a class="sourceLine" id="cb138-31" data-line-number="31"><span class="co"># count points above threshold</span></a>
<a class="sourceLine" id="cb138-32" data-line-number="32"><span class="co"># n_non_indep = []</span></a>
<a class="sourceLine" id="cb138-33" data-line-number="33"><span class="co"># for i in np.arange(len(points_list)):</span></a>
<a class="sourceLine" id="cb138-34" data-line-number="34"><span class="co">#     ni_pairs = ckd_test(gdfA=points_list[i],gdfB=points_list[i], dist_indep=scales_list[i])</span></a>
<a class="sourceLine" id="cb138-35" data-line-number="35"><span class="co">#     ni_pairs = pd.DataFrame(data=ni_pairs, columns=[&#39;p1&#39;, &#39;p2&#39;])</span></a>
<a class="sourceLine" id="cb138-36" data-line-number="36"><span class="co">#     site_id = np.concatenate((ni_pairs.p1.unique(), ni_pairs.p2.unique()))</span></a>
<a class="sourceLine" id="cb138-37" data-line-number="37"><span class="co">#     ni_sites = len(np.unique(site_id))/points_list[i].shape[0]</span></a>
<a class="sourceLine" id="cb138-38" data-line-number="38"><span class="co">#     n_non_indep.append(ni_sites)</span></a></code></pre></div>
</div>
</div>
<div id="plot-metrics-for-different-methods" class="section level3">
<h3><span class="header-section-number">9.10.5</span> Plot metrics for different methods</h3>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1"><span class="co"># combine the thinning metrics data</span></a>
<a class="sourceLine" id="cb139-2" data-line-number="2">data_plot &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(data_thin_net, data_thin_trad)</a>
<a class="sourceLine" id="cb139-3" data-line-number="3"></a>
<a class="sourceLine" id="cb139-4" data-line-number="4"><span class="co"># get data for mean distance</span></a>
<a class="sourceLine" id="cb139-5" data-line-number="5">data_thin_compare &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">scale =</span> <span class="kw">unlist</span>(scales_list),</a>
<a class="sourceLine" id="cb139-6" data-line-number="6">                            <span class="dt">method =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;network&quot;</span>, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb139-7" data-line-number="7">                                       <span class="kw">rep</span>(<span class="st">&quot;grid_rand&quot;</span>, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb139-8" data-line-number="8">                                       <span class="kw">rep</span>(<span class="st">&quot;grid_max&quot;</span>, <span class="dv">4</span>)),</a>
<a class="sourceLine" id="cb139-9" data-line-number="9">                            <span class="st">`</span><span class="dt">mean NND - buffer (m)</span><span class="st">`</span> =<span class="st"> </span><span class="kw">unlist</span>(py<span class="op">$</span>mean_dist_diff)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb139-10" data-line-number="10"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="st">&quot;mean NND - buffer (m)&quot;</span>,</a>
<a class="sourceLine" id="cb139-11" data-line-number="11">               <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>)</a>
<a class="sourceLine" id="cb139-12" data-line-number="12"></a>
<a class="sourceLine" id="cb139-13" data-line-number="13"><span class="co"># bind rows with other data</span></a>
<a class="sourceLine" id="cb139-14" data-line-number="14">data_plot &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(data_plot, data_thin_compare)</a>
<a class="sourceLine" id="cb139-15" data-line-number="15"></a>
<a class="sourceLine" id="cb139-16" data-line-number="16"><span class="co"># plot results</span></a>
<a class="sourceLine" id="cb139-17" data-line-number="17">fig_spatial_thinning &lt;-</a>
<a class="sourceLine" id="cb139-18" data-line-number="18"><span class="st">  </span><span class="kw">ggplot</span>(data_plot)<span class="op">+</span></a>
<a class="sourceLine" id="cb139-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> scale, <span class="dt">lty =</span> <span class="dv">3</span>, <span class="dt">colour=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.4</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb139-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> scale, <span class="dt">y=</span> value, <span class="dt">col =</span>method))<span class="op">+</span></a>
<a class="sourceLine" id="cb139-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> scale, <span class="dt">y=</span> value, <span class="dt">col =</span>method, <span class="dt">shape =</span> method))<span class="op">+</span></a>
<a class="sourceLine" id="cb139-22" data-line-number="22"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>variable, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb139-23" data-line-number="23"><span class="st">  </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb139-24" data-line-number="24"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> scale)<span class="op">+</span></a>
<a class="sourceLine" id="cb139-25" data-line-number="25"><span class="st">  </span><span class="kw">scale_y_continuous</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb139-26" data-line-number="26"><span class="st">  </span><span class="kw">scale_colour_scico_d</span>(<span class="dt">palette =</span> <span class="st">&quot;batlow&quot;</span>, <span class="dt">begin=</span><span class="fl">0.2</span>, <span class="dt">end=</span><span class="fl">0.8</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb139-27" data-line-number="27"><span class="st">  </span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb139-28" data-line-number="28"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb139-29" data-line-number="29"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span> <span class="st">&quot;buffer distance (m)&quot;</span>)</a>
<a class="sourceLine" id="cb139-30" data-line-number="30"></a>
<a class="sourceLine" id="cb139-31" data-line-number="31"><span class="co"># save</span></a>
<a class="sourceLine" id="cb139-32" data-line-number="32"><span class="kw">ggsave</span>(fig_spatial_thinning, <span class="dt">filename =</span> <span class="st">&quot;figs/fig_spatial_thinning_02.png&quot;</span>, <span class="dt">width =</span> <span class="dv">10</span>, <span class="dt">height =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb139-33" data-line-number="33">       <span class="dt">dpi=</span><span class="dv">300</span>); <span class="kw">dev.off</span>()</a></code></pre></div>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_spatial_thinning_02.png&quot;</span>)</a></code></pre></div>
<p><img src="figs/fig_spatial_thinning_02.png" /><!-- --></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="results-occupancy-predictors.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pratikunterwegs/eBirdOccupancy/edit/master/08_supplement01.rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
